<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>material.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body bgcolor="#ffffff">
<!-- Generated by Doxygen 1.2.11 -->
<center>
<a class="qindex" href="main.html">Main Page</a> &nbsp; <a class="qindex" href="modules.html">Modules</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>material.cpp</h1><a href="material_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <font class="comment">/*        Copyright (C) 2000,2001,2002  Sony Computer Entertainment America</font>
00002           
00003           This file is subject to the terms and conditions of the GNU Lesser
00004           General Public License Version 2.1. See the file "COPYING" in the
00005           main directory of this archive for more details.                             */
00006 
00007 <font class="preprocessor">#include "<a class="code" href="material_8h.html">ps2gl/material.h</a>"</font>
00008 <font class="preprocessor">#include "<a class="code" href="glcontext_8h.html">ps2gl/glcontext.h</a>"</font>
00009 <font class="preprocessor">#include "<a class="code" href="dlist_8h.html">ps2gl/dlist.h</a>"</font>
00010 <font class="preprocessor">#include "<a class="code" href="lighting_8h.html">ps2gl/lighting.h</a>"</font>
00011 
00012 <font class="comment">/********************************************</font>
00013  * CImmMaterial
00014  */
00015 
<a name="l00016"></a><a class="code" href="classCImmMaterial.html#a0">00016</a> <a class="code" href="classCImmMaterial.html#a0">CImmMaterial::CImmMaterial</a>( <a class="code" href="classCGLContext.html">CGLContext</a> &amp;context )
00017    : <a class="code" href="classCMaterial.html">CMaterial</a>(context),
00018      Ambient( 0.2f, 0.2f, 0.2f, 1.0f ),
00019      Diffuse( 0.8f, 0.8f, 0.8f, 1.0f ),
00020      Specular( 0.0f, 0.0f, 0.0f, 1.0f ),
00021      Emission( 0.0f, 0.0f, 0.0f, 1.0f ),
00022      Shininess(0.0f)
00023 {
00024 }
00025 
00026 <font class="keywordtype">void</font>
<a name="l00027"></a><a class="code" href="classCImmMaterial.html#a3">00027</a> <a class="code" href="classCImmMaterial.html#a3">CImmMaterial::SetSpecular</a>( cpu_vec_xyzw specular )<font class="keyword"></font>
00028 {
00029    TellRendererMaterialChanged();
00030    Specular = specular;
00031 
00032    <font class="keywordflow">if</font> ( Specular != cpu_vec_4(0,0,0,0) )
00033       GLContext.GetImmLighting().MaterialHasSpecular();
00034    <font class="keywordflow">else</font> {
00035       GLContext.SpecularEnabledChanged();
00036       GLContext.GetImmGeomManager().GetRendererManager().SpecularEnabledChanged(<font class="keyword">false</font>);
00037    }
00038 }
00039 
00040 <font class="keywordtype">void</font>
<a name="l00041"></a><a class="code" href="classCImmMaterial.html#a11">00041</a> <a class="code" href="classCImmMaterial.html#a11">CImmMaterial::LightsHaveSpecular</a>()<font class="keyword"></font>
00042 {
00043    <font class="keywordflow">if</font> ( Specular != cpu_vec_4(0,0,0,0) )<font class="keyword"> </font>{
00044       GLContext.SpecularEnabledChanged();
00045       GLContext.GetImmGeomManager().GetRendererManager().SpecularEnabledChanged(<font class="keyword">true</font>);
00046    }
00047 }
00048 
00049 <font class="comment">/********************************************</font>
00050  * CDListMaterial
00051  */
00052 
<a name="l00053"></a><a class="code" href="classCSetMaterialPropCmd.html">00053</a> <font class="keyword">class </font><a class="code" href="classCSetMaterialPropCmd.html">CSetMaterialPropCmd</a> : <font class="keyword">public</font> <a class="code" href="classCDListCmd.html">CDListCmd</a> {
00054       cpu_vec_xyzw      Value;
00055       <a class="code" href="gl_8h.html#a687">GLenum</a>    Property;
00056    <font class="keyword">public</font>:
<a name="l00057"></a><a class="code" href="classCSetMaterialPropCmd.html#a0">00057</a>       <a class="code" href="classCSetMaterialPropCmd.html#a0">CSetMaterialPropCmd</a>( <a class="code" href="gl_8h.html#a687">GLenum</a> prop, cpu_vec_xyzw value )
00058          : Value(value), Property(prop) {}
<a name="l00059"></a><a class="code" href="classCSetMaterialPropCmd.html#a1">00059</a>       <a class="code" href="classCDListCmd.html">CDListCmd</a>* <a class="code" href="classCDListCmd.html#a1">Play</a>()<font class="keyword"> </font>{
00060          <a class="code" href="gl_8h.html#a942">glMaterialfv</a>( <a class="code" href="gl_8h.html#a84">GL_FRONT</a>, Property, reinterpret_cast&lt;float*&gt;(&amp;Value) );
00061          <font class="keywordflow">return</font> <a class="code" href="classCDListCmd.html#d1">CDListCmd::GetNextCmd</a>( <font class="keyword">this</font> );
00062       }
00063 };
00064 
00065 <font class="keywordtype">void</font>
<a name="l00066"></a><a class="code" href="classCDListMaterial.html#a1">00066</a> <a class="code" href="classCDListMaterial.html#a1">CDListMaterial::SetAmbient</a>( cpu_vec_xyzw ambient )<font class="keyword"></font>
00067 {
00068    <a class="code" href="classCDList.html">CDList</a> &amp;dlist = pGLContext-&gt;GetDListManager().GetOpenDList();
00069    dlist += CSetMaterialPropCmd( <a class="code" href="gl_8h.html#a132">GL_AMBIENT</a>, ambient );
00070    TellRendererMaterialChanged();
00071 }
00072 
00073 <font class="keywordtype">void</font>
<a name="l00074"></a><a class="code" href="classCDListMaterial.html#a2">00074</a> <a class="code" href="classCDListMaterial.html#a2">CDListMaterial::SetDiffuse</a>( cpu_vec_xyzw diffuse )<font class="keyword"></font>
00075 {
00076    <a class="code" href="classCDList.html">CDList</a> &amp;dlist = pGLContext-&gt;GetDListManager().GetOpenDList();
00077    dlist += CSetMaterialPropCmd( <a class="code" href="gl_8h.html#a133">GL_DIFFUSE</a>, diffuse );
00078    TellRendererMaterialChanged();
00079 }
00080 
00081 <font class="keywordtype">void</font>
<a name="l00082"></a><a class="code" href="classCDListMaterial.html#a3">00082</a> <a class="code" href="classCDListMaterial.html#a3">CDListMaterial::SetSpecular</a>( cpu_vec_xyzw specular )<font class="keyword"></font>
00083 {
00084    <a class="code" href="classCDList.html">CDList</a> &amp;dlist = pGLContext-&gt;GetDListManager().GetOpenDList();
00085    dlist += CSetMaterialPropCmd( <a class="code" href="gl_8h.html#a134">GL_SPECULAR</a>, specular );
00086    TellRendererMaterialChanged();
00087    GLContext.SpecularEnabledChanged(); <font class="comment">// maybe</font>
00088 }
00089 
00090 <font class="keywordtype">void</font>
<a name="l00091"></a><a class="code" href="classCDListMaterial.html#a4">00091</a> <a class="code" href="classCDListMaterial.html#a4">CDListMaterial::SetEmission</a>( cpu_vec_xyzw emission )<font class="keyword"></font>
00092 {
00093    <a class="code" href="classCDList.html">CDList</a> &amp;dlist = pGLContext-&gt;GetDListManager().GetOpenDList();
00094    dlist += CSetMaterialPropCmd( <a class="code" href="gl_8h.html#a136">GL_EMISSION</a>, emission );
00095    TellRendererMaterialChanged();
00096 }
00097 
00098 <font class="keywordtype">void</font>
<a name="l00099"></a><a class="code" href="classCDListMaterial.html#a5">00099</a> <a class="code" href="classCDListMaterial.html#a5">CDListMaterial::SetShininess</a>( <font class="keywordtype">float</font> shine )<font class="keyword"></font>
00100 {
00101    <a class="code" href="classCDList.html">CDList</a> &amp;dlist = pGLContext-&gt;GetDListManager().GetOpenDList();
00102    dlist += CSetMaterialPropCmd( <a class="code" href="gl_8h.html#a135">GL_SHININESS</a>, cpu_vec_xyzw(shine, 0, 0, 0) );
00103    TellRendererMaterialChanged();
00104 }
00105 
00106 <font class="comment">/********************************************</font>
00107  * CMaterialManager
00108  */
00109 
00110 <font class="keywordtype">void</font>
<a name="l00111"></a><a class="code" href="classCMaterialManager.html#a7">00111</a> <a class="code" href="classCMaterialManager.html#a7">CMaterialManager::Color</a>( cpu_vec_xyzw color )<font class="keyword"></font>
00112 {
00113    CurColor = color;
00114 
00115    <font class="keywordflow">if</font> ( UseColorMaterial ) {
00116       <font class="keywordflow">switch</font>( ColorMaterialMode ) {
00117          <font class="keywordflow">case</font> <a class="code" href="gl_8h.html#a136">GL_EMISSION</a>:      CurMaterial-&gt;<a class="code" href="classCMaterial.html#a4">SetEmission</a>( color ); <font class="keywordflow">break</font>;
00118          <font class="keywordflow">case</font> <a class="code" href="gl_8h.html#a132">GL_AMBIENT</a>:       CurMaterial-&gt;<a class="code" href="classCMaterial.html#a1">SetAmbient</a>( color ); <font class="keywordflow">break</font>;
00119          <font class="keywordflow">case</font> <a class="code" href="gl_8h.html#a133">GL_DIFFUSE</a>:       CurMaterial-&gt;<a class="code" href="classCMaterial.html#a2">SetDiffuse</a>( color ); <font class="keywordflow">break</font>;
00120          <font class="keywordflow">case</font> <a class="code" href="gl_8h.html#a134">GL_SPECULAR</a>:      CurMaterial-&gt;<a class="code" href="classCMaterial.html#a3">SetSpecular</a>( color ); <font class="keywordflow">break</font>;
00121          <font class="keywordflow">case</font> <a class="code" href="gl_8h.html#a139">GL_AMBIENT_AND_DIFFUSE</a>:
00122             CurMaterial-&gt;<a class="code" href="classCMaterial.html#a1">SetAmbient</a>( color );
00123             CurMaterial-&gt;<a class="code" href="classCMaterial.html#a2">SetDiffuse</a>( color );
00124             <font class="keywordflow">break</font>;
00125       }
00126    }
00127    GLContext.<a class="code" href="classCGLContext.html#a38">CurMaterialChanged</a>();
00128 }
00129 
<a name="l00130"></a><a class="code" href="classCSetUseColorMaterialCmd.html">00130</a> <font class="keyword">class </font><a class="code" href="classCSetUseColorMaterialCmd.html">CSetUseColorMaterialCmd</a> : <font class="keyword">public</font> <a class="code" href="classCDListCmd.html">CDListCmd</a> {
00131       <font class="keywordtype">bool</font>      UseCM;
00132    <font class="keyword">public</font>:
<a name="l00133"></a><a class="code" href="classCSetUseColorMaterialCmd.html#a0">00133</a>       <a class="code" href="classCSetUseColorMaterialCmd.html#a0">CSetUseColorMaterialCmd</a>( <font class="keywordtype">bool</font> use ) : UseCM(use) {}
<a name="l00134"></a><a class="code" href="classCSetUseColorMaterialCmd.html#a1">00134</a>       <a class="code" href="classCDListCmd.html">CDListCmd</a>* <a class="code" href="classCDListCmd.html#a1">Play</a>()<font class="keyword"> </font>{
00135          pGLContext-&gt;GetMaterialManager().SetUseColorMaterial(UseCM);
00136          <font class="keywordflow">return</font> <a class="code" href="classCDListCmd.html#d1">CDListCmd::GetNextCmd</a>(<font class="keyword">this</font>);
00137       }
00138 };
00139 
00140 <font class="keywordtype">void</font>
<a name="l00141"></a><a class="code" href="classCMaterialManager.html#a8">00141</a> <a class="code" href="classCMaterialManager.html#a8">CMaterialManager::SetUseColorMaterial</a>( <font class="keywordtype">bool</font> yesNo )<font class="keyword"></font>
00142 {
00143    <font class="keywordflow">if</font> ( ! InDListDef ) {
00144       UseColorMaterial = yesNo;
00145       <font class="keywordflow">if</font> ( yesNo ) <a class="code" href="classCMaterialManager.html#a7">Color</a>( CurColor );
00146       GLContext.<a class="code" href="classCGLContext.html#a38">CurMaterialChanged</a>();
00147    }
00148    <font class="keywordflow">else</font> {
00149       <a class="code" href="classCDList.html">CDList</a> &amp;dlist = GLContext.<a class="code" href="classCGLContext.html#a13">GetDListManager</a>().<a class="code" href="classCDListManager.html#a8">GetOpenDList</a>();
00150       dlist += CSetUseColorMaterialCmd(yesNo);
00151       GLContext.<a class="code" href="classCGLContext.html#a38">CurMaterialChanged</a>();
00152    }
00153 }
00154 
<a name="l00155"></a><a class="code" href="classCSetColorMatModeCmd.html">00155</a> <font class="keyword">class </font><a class="code" href="classCSetColorMatModeCmd.html">CSetColorMatModeCmd</a> : <font class="keyword">public</font> <a class="code" href="classCDListCmd.html">CDListCmd</a> {
00156       <a class="code" href="gl_8h.html#a687">GLenum</a>    Mode;
00157    <font class="keyword">public</font>:
<a name="l00158"></a><a class="code" href="classCSetColorMatModeCmd.html#a0">00158</a>       <a class="code" href="classCSetColorMatModeCmd.html#a0">CSetColorMatModeCmd</a>( <a class="code" href="gl_8h.html#a687">GLenum</a> mode ) : Mode(mode) {}
<a name="l00159"></a><a class="code" href="classCSetColorMatModeCmd.html#a1">00159</a>       <a class="code" href="classCDListCmd.html">CDListCmd</a>* <a class="code" href="classCDListCmd.html#a1">Play</a>()<font class="keyword"> </font>{
00160          pGLContext-&gt;GetMaterialManager().SetColorMaterialMode(Mode);
00161          <font class="keywordflow">return</font> <a class="code" href="classCDListCmd.html#d1">CDListCmd::GetNextCmd</a>(<font class="keyword">this</font>);
00162       }
00163 };
00164 
00165 <font class="keywordtype">void</font>
<a name="l00166"></a><a class="code" href="classCMaterialManager.html#a9">00166</a> <a class="code" href="classCMaterialManager.html#a9">CMaterialManager::SetColorMaterialMode</a>( <a class="code" href="gl_8h.html#a687">GLenum</a> mode )<font class="keyword"></font>
00167 {
00168    <font class="keywordflow">if</font> ( ! InDListDef ) {
00169       ColorMaterialMode = mode;
00170       <a class="code" href="classCMaterialManager.html#a7">Color</a>(CurColor);
00171       GLContext.<a class="code" href="classCGLContext.html#a38">CurMaterialChanged</a>();
00172    }
00173    <font class="keywordflow">else</font> {
00174       <a class="code" href="classCDList.html">CDList</a> &amp;dlist = GLContext.<a class="code" href="classCGLContext.html#a13">GetDListManager</a>().<a class="code" href="classCDListManager.html#a8">GetOpenDList</a>();
00175       dlist += CSetColorMatModeCmd(mode);
00176       GLContext.<a class="code" href="classCGLContext.html#a38">CurMaterialChanged</a>();
00177    }
00178 }
00179 
00180 
00181 <font class="comment">/********************************************</font>
00182  * gl interface
00183  */
00184 
<a name="l00185"></a><a class="code" href="material_8cpp.html#a942">00185</a> <font class="keywordtype">void</font> <a class="code" href="gl_8h.html#a942">glMaterialfv</a>( <a class="code" href="gl_8h.html#a687">GLenum</a> face, <a class="code" href="gl_8h.html#a687">GLenum</a> pname, <font class="keyword">const</font> <a class="code" href="gl_8h.html#a698">GLfloat</a> *params )<font class="keyword"></font>
00186 {
00187    <a class="code" href="classCMaterial.html">CMaterial</a>&amp; material = pGLContext-&gt;GetMaterialManager().GetCurMaterial();
00188 
00189    <font class="keywordflow">switch</font> (face) {
00190       <font class="keywordflow">case</font> <a class="code" href="gl_8h.html#a85">GL_BACK</a>:
00191          <a class="code" href="debug_8h.html#a1">mNotImplemented</a>( <font class="stringliteral">"GL_BACK - only front material is available"</font> );
00192          <font class="keywordflow">break</font>;
00193       <font class="keywordflow">case</font> <a class="code" href="gl_8h.html#a144">GL_FRONT_AND_BACK</a>:
00194          <a class="code" href="debug_8h.html#a1">mNotImplemented</a>( <font class="stringliteral">"GL_FRONT_AND_BACK - only front material is available"</font> );
00195       <font class="keywordflow">case</font> <a class="code" href="gl_8h.html#a84">GL_FRONT</a>:
00196          <font class="keywordflow">switch</font> (pname) {
00197             <font class="keywordflow">case</font> <a class="code" href="gl_8h.html#a132">GL_AMBIENT</a>:
00198                material.<a class="code" href="classCMaterial.html#a1">SetAmbient</a>( cpu_vec_xyzw(params[0], params[1], params[2], params[3]) );
00199                <font class="keywordflow">break</font>;
00200             <font class="keywordflow">case</font> <a class="code" href="gl_8h.html#a133">GL_DIFFUSE</a>:
00201                material.<a class="code" href="classCMaterial.html#a2">SetDiffuse</a>( cpu_vec_xyzw(params[0], params[1], params[2], params[3]) );
00202                <font class="keywordflow">break</font>;
00203             <font class="keywordflow">case</font> <a class="code" href="gl_8h.html#a134">GL_SPECULAR</a>:
00204                material.<a class="code" href="classCMaterial.html#a3">SetSpecular</a>( cpu_vec_xyzw(params[0], params[1], params[2], params[3]) );
00205                <font class="keywordflow">break</font>;
00206             <font class="keywordflow">case</font> <a class="code" href="gl_8h.html#a136">GL_EMISSION</a>:
00207                material.<a class="code" href="classCMaterial.html#a4">SetEmission</a>( cpu_vec_xyzw(params[0], params[1], params[2], params[3]) );
00208                <font class="keywordflow">break</font>;
00209             <font class="keywordflow">case</font> <a class="code" href="gl_8h.html#a135">GL_SHININESS</a>:
00210                material.<a class="code" href="classCMaterial.html#a5">SetShininess</a>( *params );
00211                <font class="keywordflow">break</font>;
00212             <font class="keywordflow">case</font> <a class="code" href="gl_8h.html#a139">GL_AMBIENT_AND_DIFFUSE</a>:
00213                material.<a class="code" href="classCMaterial.html#a1">SetAmbient</a>( cpu_vec_xyzw(params[0], params[1], params[2], params[3]) );
00214                material.<a class="code" href="classCMaterial.html#a2">SetDiffuse</a>( cpu_vec_xyzw(params[0], params[1], params[2], params[3]) );
00215                <font class="keywordflow">break</font>;
00216             <font class="keywordflow">default</font>:
00217                mError( <font class="stringliteral">"shouldn't get here"</font> );
00218          }
00219          <font class="keywordflow">break</font>;
00220       <font class="keywordflow">default</font>:
00221          mError( <font class="stringliteral">"shouldn't get here"</font> );
00222    }
00223 }
00224 
<a name="l00225"></a><a class="code" href="material_8cpp.html#a940">00225</a> <font class="keywordtype">void</font> <a class="code" href="gl_8h.html#a940">glMaterialf</a>( <a class="code" href="gl_8h.html#a687">GLenum</a> face, <a class="code" href="gl_8h.html#a687">GLenum</a> pname, <a class="code" href="gl_8h.html#a698">GLfloat</a> param )<font class="keyword"></font>
00226 {
00227    <a class="code" href="classCMaterial.html">CMaterial</a>&amp; material = pGLContext-&gt;GetMaterialManager().GetCurMaterial();
00228 
00229    <font class="keywordflow">switch</font> (face) {
00230       <font class="keywordflow">case</font> <a class="code" href="gl_8h.html#a85">GL_BACK</a>:
00231          <a class="code" href="debug_8h.html#a1">mNotImplemented</a>( <font class="stringliteral">"GL_BACK - only front material is available"</font> );
00232          <font class="keywordflow">break</font>;
00233       <font class="keywordflow">case</font> <a class="code" href="gl_8h.html#a144">GL_FRONT_AND_BACK</a>:
00234          <a class="code" href="debug_8h.html#a1">mNotImplemented</a>( <font class="stringliteral">"GL_FRONT_AND_BACK - only front material is available"</font> );
00235       <font class="keywordflow">case</font> <a class="code" href="gl_8h.html#a84">GL_FRONT</a>:
00236          <font class="keywordflow">if</font> ( pname == <a class="code" href="gl_8h.html#a135">GL_SHININESS</a> )
00237                material.<a class="code" href="classCMaterial.html#a5">SetShininess</a>( param );
00238          <font class="keywordflow">else</font> { mError(<font class="stringliteral">"shoudn't get here"</font>); }
00239          <font class="keywordflow">break</font>;
00240       <font class="keywordflow">default</font>:
00241          mError( <font class="stringliteral">"shouldn't get here"</font> );
00242    }
00243 }
00244 
<a name="l00245"></a><a class="code" href="material_8cpp.html#a946">00245</a> <font class="keywordtype">void</font> <a class="code" href="gl_8h.html#a946">glColorMaterial</a>( <a class="code" href="gl_8h.html#a687">GLenum</a> face, <a class="code" href="gl_8h.html#a687">GLenum</a> mode )<font class="keyword"></font>
00246 {
00247    pGLContext-&gt;GetMaterialManager().SetColorMaterialMode( mode );
00248 }
00249 
</pre></div><hr><address><small>ps2gl version cvs</small></address>
