<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>texture.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body bgcolor="#ffffff">
<!-- Generated by Doxygen 1.2.11 -->
<center>
<a class="qindex" href="main.html">Main Page</a> &nbsp; <a class="qindex" href="modules.html">Modules</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>texture.cpp</h1><a href="texture_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <font class="comment">/*        Copyright (C) 2000,2001,2002  Sony Computer Entertainment America</font>
00002           
00003           This file is subject to the terms and conditions of the GNU Lesser
00004           General Public License Version 2.1. See the file "COPYING" in the
00005           main directory of this archive for more details.                             */
00006 
00007 <font class="preprocessor">#include "<a class="code" href="texture_8h.html">ps2gl/texture.h</a>"</font>
00008 
00009 <font class="preprocessor">#include "<a class="code" href="ps2gl_8h.html">GL/ps2gl.h</a>"</font>
00010 
00011 <font class="preprocessor">#include "<a class="code" href="debug_8h.html">ps2gl/debug.h</a>"</font>
00012 <font class="preprocessor">#include "<a class="code" href="glcontext_8h.html">ps2gl/glcontext.h</a>"</font>
00013 <font class="preprocessor">#include "<a class="code" href="dlist_8h.html">ps2gl/dlist.h</a>"</font>
00014 <font class="preprocessor">#include "<a class="code" href="immgmanager_8h.html">ps2gl/immgmanager.h</a>"</font>
00015 <font class="preprocessor">#include "<a class="code" href="dlgmanager_8h.html">ps2gl/dlgmanager.h</a>"</font>
00016 <font class="preprocessor">#include "<a class="code" href="metrics_8h.html">ps2gl/metrics.h</a>"</font>
00017 
00018 <font class="comment">/********************************************</font>
00019  * CTexManager
00020  */
00021 
<a name="l00022"></a><a class="code" href="classCTexManager.html#a0">00022</a> <a class="code" href="classCTexManager.html#a0">CTexManager::CTexManager</a>( <a class="code" href="classCGLContext.html">CGLContext</a> &amp;context )
00023    : GLContext(context), IsTexEnabled(false), InsideDListDef(false),
00024      Cursor(0), LastTexSent(NULL),
00025      CurClut(NULL),
00026      TexMode(GS::TexMode::kModulate)
00027 {
00028    <font class="comment">// clear the texture name entries</font>
00029    <font class="keywordflow">for</font> ( <font class="keywordtype">int</font> i = 0; i &lt; NumTexNames; i++ )
00030       TexNames[i] = NULL;
00031 
00032    <font class="comment">// create the default texture</font>
00033    DefaultTex = <font class="keyword">new</font> CMMTexture( GS::kContext1 );
00034    CurTexture = DefaultTex;
00035 }
00036 
<a name="l00037"></a><a class="code" href="classCTexManager.html#a1">00037</a> <a class="code" href="classCTexManager.html#a1">CTexManager::~CTexManager</a>()<font class="keyword"></font>
00038 {
00039    <font class="keyword">delete</font> DefaultTex;
00040    <font class="keywordflow">if</font> ( CurClut ) <font class="keyword">delete</font> CurClut;
00041 
00042    <font class="keywordflow">for</font> ( <font class="keywordtype">int</font> i = 0; i &lt; NumTexNames; i++ ) {
00043       <font class="keywordflow">if</font> (TexNames[i]) <font class="keyword">delete</font> TexNames[i];
00044    }
00045 }
00046 
<a name="l00047"></a><a class="code" href="classCSetTexEnabledCmd.html">00047</a> <font class="keyword">class </font><a class="code" href="classCSetTexEnabledCmd.html">CSetTexEnabledCmd</a> : <font class="keyword">public</font> <a class="code" href="classCDListCmd.html">CDListCmd</a> {
00048       <font class="keywordtype">bool</font>      IsEnabled;
00049    <font class="keyword">public</font>:
<a name="l00050"></a><a class="code" href="classCSetTexEnabledCmd.html#a0">00050</a>       <a class="code" href="classCSetTexEnabledCmd.html#a0">CSetTexEnabledCmd</a>( <font class="keywordtype">bool</font> enabled ) : IsEnabled(enabled) {}
<a name="l00051"></a><a class="code" href="classCSetTexEnabledCmd.html#a1">00051</a>       <a class="code" href="classCDListCmd.html">CDListCmd</a>* <a class="code" href="classCDListCmd.html#a1">Play</a>()<font class="keyword"> </font>{
00052          pGLContext-&gt;GetTexManager().SetTexEnabled(IsEnabled);
00053          <font class="keywordflow">return</font> <a class="code" href="classCDListCmd.html#d1">CDListCmd::GetNextCmd</a>(<font class="keyword">this</font>);
00054       }
00055 };
00056 
00057 <font class="keywordtype">void</font>
<a name="l00058"></a><a class="code" href="classCTexManager.html#a2">00058</a> <a class="code" href="classCTexManager.html#a2">CTexManager::SetTexEnabled</a>( <font class="keywordtype">bool</font> yesNo )<font class="keyword"></font>
00059 {
00060    <font class="keywordflow">if</font> (! InsideDListDef) {
00061       <font class="keywordflow">if</font> ( IsTexEnabled != yesNo ) {
00062          GLContext.<a class="code" href="classCGLContext.html#a42">TexEnabledChanged</a>();
00063          GLContext.<a class="code" href="classCGLContext.html#a10">GetImmGeomManager</a>().<a class="code" href="classCImmGeomManager.html#a2">GetRendererManager</a>().TexEnabledChanged(yesNo);
00064          IsTexEnabled = yesNo;
00065       }
00066    }
00067    <font class="keywordflow">else</font> {
00068       <a class="code" href="classCDList.html">CDList</a> &amp;dlist = GLContext.<a class="code" href="classCGLContext.html#a13">GetDListManager</a>().<a class="code" href="classCDListManager.html#a8">GetOpenDList</a>();
00069       dlist += CSetTexEnabledCmd( yesNo );
00070       GLContext.<a class="code" href="classCGLContext.html#a42">TexEnabledChanged</a>();
00071    }
00072 }
00073 
<a name="l00074"></a><a class="code" href="classCSetTexModeCmd.html">00074</a> <font class="keyword">class </font><a class="code" href="classCSetTexModeCmd.html">CSetTexModeCmd</a> : <font class="keyword">public</font> <a class="code" href="classCDListCmd.html">CDListCmd</a> {
00075       GS::tTexMode Mode;
00076    <font class="keyword">public</font>:
<a name="l00077"></a><a class="code" href="classCSetTexModeCmd.html#a0">00077</a>       <a class="code" href="classCSetTexModeCmd.html#a0">CSetTexModeCmd</a>( GS::tTexMode mode ) : Mode(mode) {}
<a name="l00078"></a><a class="code" href="classCSetTexModeCmd.html#a1">00078</a>       <a class="code" href="classCDListCmd.html">CDListCmd</a>* <a class="code" href="classCDListCmd.html#a1">Play</a>()<font class="keyword"> </font>{
00079          pGLContext-&gt;GetTexManager().SetTexMode(Mode);
00080          <font class="keywordflow">return</font> <a class="code" href="classCDListCmd.html#d1">CDListCmd::GetNextCmd</a>(<font class="keyword">this</font>);
00081       }
00082 };
00083 
00084 <font class="keywordtype">void</font>
<a name="l00085"></a><a class="code" href="classCTexManager.html#a10">00085</a> <a class="code" href="classCTexManager.html#a10">CTexManager::SetTexMode</a>( GS::tTexMode mode )<font class="keyword"></font>
00086 {
00087    <font class="keywordflow">if</font> ( ! InsideDListDef )
00088       TexMode = mode;
00089    <font class="keywordflow">else</font> {
00090       <a class="code" href="classCDList.html">CDList</a> &amp;dlist = GLContext.<a class="code" href="classCGLContext.html#a13">GetDListManager</a>().<a class="code" href="classCDListManager.html#a8">GetOpenDList</a>();
00091       dlist += CSetTexModeCmd( mode );
00092    }
00093 }
00094 
00095 <font class="keywordtype">void</font>
<a name="l00096"></a><a class="code" href="classCTexManager.html#a4">00096</a> <a class="code" href="classCTexManager.html#a4">CTexManager::GenTextures</a>( <a class="code" href="gl_8h.html#a697">GLsizei</a> numNewTexNames, <a class="code" href="gl_8h.html#a696">GLuint</a> *newTexNames )<font class="keyword"></font>
00097 {
00098    <font class="keywordflow">for</font> ( <font class="keywordtype">int</font> curTexName = 0; curTexName &lt; numNewTexNames; curTexName++ ) {
00099       <font class="comment">// find the next free tex name and assign it</font>
00100       <font class="keywordtype">int</font> i;
00101       <font class="keywordflow">for</font> ( i = 0; i &lt; NumTexNames; i++ ) {
00102          <font class="comment">// 0 is a reserved tex name in OGL -- don't alloc it</font>
00103          <font class="keywordflow">if</font> ( Cursor != 0 &amp;&amp; TexNames[Cursor] == NULL ) <font class="keywordflow">break</font>;
00104 
00105          IncCursor();
00106       }
00107       <font class="comment">// did we go through all the names without finding any free ones?</font>
00108       <font class="keywordflow">if</font> ( i == NumTexNames ) {
00109             mError(<font class="stringliteral">"No free texture names.  Time to write a less braindead tex manager."</font>);
00110 
00111         <font class="comment">// In release build, return sensible names on failure</font>
00112         <font class="keywordflow">while</font>(i &lt; NumTexNames) {
00113             newTexNames[i] = 0;
00114             ++i;
00115         }
00116       } <font class="keywordflow">else</font> {
00117             newTexNames[curTexName] = Cursor;
00118             IncCursor();
00119       }
00120    }
00121 }
00122 
00123 <font class="keywordtype">void</font>
<a name="l00124"></a><a class="code" href="classCTexManager.html#a9">00124</a> <a class="code" href="classCTexManager.html#a9">CTexManager::UseCurTexture</a>( CVifSCDmaPacket &amp;renderPacket )<font class="keyword"></font>
00125 {
00126    <font class="keywordflow">if</font> ( IsTexEnabled ) {
00127       GS::tPSM psm = CurTexture-&gt;GetPSM();
00128       <font class="comment">// do we need to send the clut?</font>
00129       <font class="keywordflow">if</font> ( psm == GS::kPsm8 || psm == GS::kPsm8h ) {
00130          mErrorIf( CurClut == NULL,
00131                    <font class="stringliteral">"Trying to use an indexed-color texture with no color table given!"</font> );
00132          CurClut-&gt;<a class="code" href="classCMMClut.html#a2">Load</a>( renderPacket );
00133       }
00134       <font class="comment">// use the texture</font>
00135       CurTexture-&gt;SetTexMode( TexMode );
00136       <font class="keywordflow">if</font> ( CurTexture-&gt;GetPSM() == GS::kPsm8
00137            || CurTexture-&gt;GetPSM() == GS::kPsm8h )
00138          CurTexture-&gt;<a class="code" href="classCMMTexture.html#a4">SetClut</a>( *CurClut );
00139       CurTexture-&gt;<a class="code" href="classCMMTexture.html#a7">Use</a>( renderPacket );
00140    }
00141 }
00142 
<a name="l00143"></a><a class="code" href="classCBindTextureCmd.html">00143</a> <font class="keyword">class </font><a class="code" href="classCBindTextureCmd.html">CBindTextureCmd</a> : <font class="keyword">public</font> <a class="code" href="classCDListCmd.html">CDListCmd</a> {
00144       <font class="keywordtype">unsigned</font> <font class="keywordtype">int</font> TexName;
00145    <font class="keyword">public</font>:
<a name="l00146"></a><a class="code" href="classCBindTextureCmd.html#a0">00146</a>       <a class="code" href="classCBindTextureCmd.html#a0">CBindTextureCmd</a>( <font class="keywordtype">unsigned</font> <font class="keywordtype">int</font> name ) : TexName(name) {}
<a name="l00147"></a><a class="code" href="classCBindTextureCmd.html#a1">00147</a>       <a class="code" href="classCDListCmd.html">CDListCmd</a>* <a class="code" href="classCDListCmd.html#a1">Play</a>()<font class="keyword"> </font>{
00148          pGLContext-&gt;GetTexManager().BindTexture(TexName);
00149          <font class="keywordflow">return</font> <a class="code" href="classCDListCmd.html#d1">CDListCmd::GetNextCmd</a>(<font class="keyword">this</font>);
00150       }
00151 };
00152 
00153 <font class="keywordtype">void</font>
<a name="l00154"></a><a class="code" href="classCTexManager.html#a5">00154</a> <a class="code" href="classCTexManager.html#a5">CTexManager::BindTexture</a>( <a class="code" href="gl_8h.html#a696">GLuint</a> texNameToBind )<font class="keyword"></font>
00155 {
00156    GLContext.<a class="code" href="classCGLContext.html#a52">TextureChanged</a>();
00157 
00158    <font class="keywordflow">if</font> ( ! InsideDListDef ) {
00159       <font class="keywordflow">if</font> ( texNameToBind == 0 ) {
00160          <font class="comment">// default texture</font>
00161          CurTexture = DefaultTex;
00162       }
00163       <font class="keywordflow">else</font> {
00164          <font class="keywordflow">if</font> ( TexNames[texNameToBind] == NULL )
00165             TexNames[texNameToBind] = <font class="keyword">new</font> CMMTexture( GS::kContext1 );
00166          CurTexture = TexNames[texNameToBind];
00167       }
00168 
00169       <a class="code" href="metrics_8h.html#a12">pglAddToMetric</a>(<a class="code" href="metrics_8h.html#a13a7">kMetricsBindTexture</a>);
00170    }
00171    <font class="keywordflow">else</font> {
00172       <a class="code" href="classCDList.html">CDList</a> &amp;dlist = GLContext.<a class="code" href="classCGLContext.html#a13">GetDListManager</a>().<a class="code" href="classCDListManager.html#a8">GetOpenDList</a>();
00173       dlist += CBindTextureCmd( texNameToBind );
00174    }
00175 }
00176 
00177 <font class="keywordtype">void</font>
<a name="l00178"></a><a class="code" href="classCTexManager.html#a6">00178</a> <a class="code" href="classCTexManager.html#a6">CTexManager::DeleteTextures</a>( <a class="code" href="gl_8h.html#a697">GLsizei</a> numToDelete, <font class="keyword">const</font> <a class="code" href="gl_8h.html#a696">GLuint</a> *texNames )<font class="keyword"></font>
00179 {
00180    <font class="keywordflow">for</font> ( <font class="keywordtype">int</font> i = 0; i &lt; numToDelete; i++ ) {
00181       mErrorIf( TexNames[texNames[i]] == NULL,
00182                 <font class="stringliteral">"Trying to delete a texture that doesn't exist!"</font> );
00183       <a class="code" href="gl_8h.html#a696">GLuint</a> texName = texNames[i];
00184       <font class="keywordflow">if</font> ( CurTexture == TexNames[texName] )
00185          CurTexture = DefaultTex;
00186       <font class="keyword">delete</font> TexNames[texName];
00187       TexNames[texName] = NULL;
00188    }
00189 }
00190 
<a name="l00191"></a><a class="code" href="classCSetCurTexParamCmd.html">00191</a> <font class="keyword">class </font><a class="code" href="classCSetCurTexParamCmd.html">CSetCurTexParamCmd</a> : <font class="keyword">public</font> <a class="code" href="classCDListCmd.html">CDListCmd</a> {
00192       <a class="code" href="gl_8h.html#a687">GLenum</a>    PName;
00193       <font class="keywordtype">int</font>       Param;
00194    <font class="keyword">public</font>:
<a name="l00195"></a><a class="code" href="classCSetCurTexParamCmd.html#a0">00195</a>       <a class="code" href="classCSetCurTexParamCmd.html#a0">CSetCurTexParamCmd</a>( <a class="code" href="gl_8h.html#a687">GLenum</a> pname, <font class="keywordtype">int</font> param ) : PName(pname), Param(param) {}
<a name="l00196"></a><a class="code" href="classCSetCurTexParamCmd.html#a1">00196</a>       <a class="code" href="classCDListCmd.html">CDListCmd</a>* <a class="code" href="classCDListCmd.html#a1">Play</a>()<font class="keyword"> </font>{
00197          pGLContext-&gt;GetTexManager().SetCurTexParam(PName, Param);
00198          <font class="keywordflow">return</font> <a class="code" href="classCDListCmd.html#d1">CDListCmd::GetNextCmd</a>(<font class="keyword">this</font>);
00199       }
00200 };
00201 
00202 <font class="keywordtype">void</font>
<a name="l00203"></a><a class="code" href="classCTexManager.html#a11">00203</a> <a class="code" href="classCTexManager.html#a11">CTexManager::SetCurTexParam</a>( <a class="code" href="gl_8h.html#a687">GLenum</a> pname, <a class="code" href="gl_8h.html#a693">GLint</a> param )<font class="keyword"></font>
00204 {
00205    <font class="keywordflow">if</font> ( ! InsideDListDef ) {
00206       <a class="code" href="classCMMTexture.html">CMMTexture</a> &amp;tex = *CurTexture;
00207 
00208       <font class="keywordflow">switch</font>( pname ) {
00209          <font class="keywordflow">case</font> <a class="code" href="gl_8h.html#a422">GL_TEXTURE_MIN_FILTER</a>:
00210             tex.SetMinMode( (GS::tMinMode)(param &amp; 0xf) );
00211             <font class="keywordflow">break</font>;
00212          <font class="keywordflow">case</font> <a class="code" href="gl_8h.html#a421">GL_TEXTURE_MAG_FILTER</a>:
00213             tex.SetMagMode( (GS::tMagMode)(param &amp; 0xf) );
00214             <font class="keywordflow">break</font>;
00215          <font class="keywordflow">case</font> <a class="code" href="gl_8h.html#a540">GL_TEXTURE_MIN_LOD</a>:
00216          <font class="keywordflow">case</font> <a class="code" href="gl_8h.html#a541">GL_TEXTURE_MAX_LOD</a>:
00217          <font class="keywordflow">case</font> <a class="code" href="gl_8h.html#a542">GL_TEXTURE_BASE_LEVEL</a>:
00218          <font class="keywordflow">case</font> <a class="code" href="gl_8h.html#a543">GL_TEXTURE_MAX_LEVEL</a>:
00219          <font class="keywordflow">case</font> <a class="code" href="gl_8h.html#a460">GL_TEXTURE_PRIORITY</a>:
00220          <font class="keywordflow">case</font> <a class="code" href="gl_8h.html#a427">GL_TEXTURE_BORDER_COLOR</a>:
00221             <a class="code" href="debug_8h.html#a1">mNotImplemented</a>( );
00222             <font class="keywordflow">break</font>;
00223          <font class="keywordflow">case</font> <a class="code" href="gl_8h.html#a419">GL_TEXTURE_WRAP_S</a>:
00224             tex.SetWrapModeS( (GS::tTexWrapMode)(param &amp; 0xf) );
00225             <font class="keywordflow">break</font>;
00226          <font class="keywordflow">case</font> <a class="code" href="gl_8h.html#a420">GL_TEXTURE_WRAP_T</a>:
00227             tex.SetWrapModeT( (GS::tTexWrapMode)(param &amp; 0xf) );
00228             <font class="keywordflow">break</font>;
00229          <font class="keywordflow">case</font> <a class="code" href="gl_8h.html#a472">GL_TEXTURE_WRAP_R</a>:
00230             <a class="code" href="debug_8h.html#a1">mNotImplemented</a>( <font class="stringliteral">"Sorry, only 2d textures."</font> );
00231             <font class="keywordflow">break</font>;
00232       }
00233    }
00234    <font class="keywordflow">else</font> {
00235       <a class="code" href="classCDList.html">CDList</a> &amp;dlist = GLContext.<a class="code" href="classCGLContext.html#a13">GetDListManager</a>().<a class="code" href="classCDListManager.html#a8">GetOpenDList</a>();
00236       dlist += CSetCurTexParamCmd(pname, param);
00237    }
00238 }
00239 
<a name="l00240"></a><a class="code" href="classCSetCurTexImageCmd.html">00240</a> <font class="keyword">class </font><a class="code" href="classCSetCurTexImageCmd.html">CSetCurTexImageCmd</a> : <font class="keyword">public</font> <a class="code" href="classCDListCmd.html">CDListCmd</a> {
00241       tU128             *Image;
00242       <font class="keywordtype">unsigned</font> <font class="keywordtype">int</font>      Width, Height;
00243       GS::tPSM          Psm;
00244    <font class="keyword">public</font>:
<a name="l00245"></a><a class="code" href="classCSetCurTexImageCmd.html#a0">00245</a>       <a class="code" href="classCSetCurTexImageCmd.html#a0">CSetCurTexImageCmd</a>( tU128 *image, <font class="keywordtype">unsigned</font> <font class="keywordtype">int</font> w, <font class="keywordtype">unsigned</font> <font class="keywordtype">int</font> h,
00246                           GS::tPSM psm )
00247          : Image(image), Width(w), Height(h), Psm(psm) {}
<a name="l00248"></a><a class="code" href="classCSetCurTexImageCmd.html#a1">00248</a>       <a class="code" href="classCDListCmd.html">CDListCmd</a>* <a class="code" href="classCDListCmd.html#a1">Play</a>()<font class="keyword"> </font>{
00249          pGLContext-&gt;GetTexManager().SetCurTexImage( Image, Width, Height, Psm );
00250          <font class="keywordflow">return</font> <a class="code" href="classCDListCmd.html#d1">CDListCmd::GetNextCmd</a>(<font class="keyword">this</font>);
00251       }
00252 };
00253 
00254 <font class="keywordtype">void</font>
<a name="l00255"></a><a class="code" href="classCTexManager.html#a12">00255</a> <a class="code" href="classCTexManager.html#a12">CTexManager::SetCurTexImage</a>( tU128* imagePtr, tU32 w, tU32 h,
00256                              GS::tPSM psm )<font class="keyword"></font>
00257 {
00258    GLContext.<a class="code" href="classCGLContext.html#a52">TextureChanged</a>();
00259 
00260    <font class="keywordflow">if</font> ( ! InsideDListDef ) {
00261       CurTexture-&gt;<a class="code" href="classCMMTexture.html#a2">SetImage</a>( imagePtr, w, h, psm );
00262       <font class="keywordflow">if</font> ( psm != GS::kPsm24 )
00263          CurTexture-&gt;SetUseTexAlpha( <font class="keyword">true</font> );
00264       <font class="keywordflow">else</font>
00265          CurTexture-&gt;SetUseTexAlpha( <font class="keyword">false</font> );
00266 
00267       CurTexture-&gt;<a class="code" href="classCMMTexture.html#a13">Free</a>();
00268    }
00269    <font class="keywordflow">else</font> {
00270       <a class="code" href="classCDList.html">CDList</a> &amp;dlist = GLContext.<a class="code" href="classCGLContext.html#a13">GetDListManager</a>().<a class="code" href="classCDListManager.html#a8">GetOpenDList</a>();
00271       dlist += CSetCurTexImageCmd( imagePtr, w, h, psm );
00272    }
00273 }
00274 
<a name="l00275"></a><a class="code" href="classCSetCurClutCmd.html">00275</a> <font class="keyword">class </font><a class="code" href="classCSetCurClutCmd.html">CSetCurClutCmd</a> : <font class="keyword">public</font> <a class="code" href="classCDListCmd.html">CDListCmd</a> {
00276       <font class="keyword">const</font> <font class="keywordtype">void</font>        *Clut;
00277       <font class="keywordtype">int</font>               NumEntries;
00278    <font class="keyword">public</font>:
<a name="l00279"></a><a class="code" href="classCSetCurClutCmd.html#a0">00279</a>       <a class="code" href="classCSetCurClutCmd.html#a0">CSetCurClutCmd</a>( <font class="keyword">const</font> <font class="keywordtype">void</font> *clut, <font class="keywordtype">int</font> numEntries )
00280          : Clut(clut), NumEntries(numEntries) {}
<a name="l00281"></a><a class="code" href="classCSetCurClutCmd.html#a1">00281</a>       <a class="code" href="classCDListCmd.html">CDListCmd</a>* <a class="code" href="classCDListCmd.html#a1">Play</a>()<font class="keyword"> </font>{
00282          pGLContext-&gt;GetTexManager().SetCurClut(Clut, NumEntries);
00283          <font class="keywordflow">return</font> <a class="code" href="classCDListCmd.html#d1">CDListCmd::GetNextCmd</a>(<font class="keyword">this</font>);
00284       }
00285 };
00286 
00287 <font class="keywordtype">void</font>
<a name="l00288"></a><a class="code" href="classCTexManager.html#a14">00288</a> <a class="code" href="classCTexManager.html#a14">CTexManager::SetCurClut</a>( <font class="keyword">const</font> <font class="keywordtype">void</font> *clut, <font class="keywordtype">int</font> numEntries )<font class="keyword"></font>
00289 {
00290    GLContext.<a class="code" href="classCGLContext.html#a52">TextureChanged</a>();
00291 
00292    <font class="keywordflow">if</font> ( ! InsideDListDef ) {
00293       <a class="code" href="classCMMClut.html">CMMClut</a> *temp = CurClut;
00294       CurClut = <font class="keyword">new</font> CMMClut( clut );
00295       <font class="keywordflow">if</font> ( temp ) <font class="keyword">delete</font> temp;
00296    }
00297    <font class="keywordflow">else</font> {
00298       <a class="code" href="classCDList.html">CDList</a> &amp;dlist = GLContext.<a class="code" href="classCGLContext.html#a13">GetDListManager</a>().<a class="code" href="classCDListManager.html#a8">GetOpenDList</a>();
00299       dlist += CSetCurClutCmd( clut, numEntries );
00300    }
00301 }
00302 
<a name="l00303"></a><a class="code" href="classCSetGsTextureCmd.html">00303</a> <font class="keyword">class </font><a class="code" href="classCSetGsTextureCmd.html">CSetGsTextureCmd</a> : <font class="keyword">public</font> <a class="code" href="classCDListCmd.html">CDListCmd</a> {
00304       GS::CMemArea      &amp;Texture;
00305    <font class="keyword">public</font>:
<a name="l00306"></a><a class="code" href="classCSetGsTextureCmd.html#a0">00306</a>       <a class="code" href="classCSetGsTextureCmd.html#a0">CSetGsTextureCmd</a>(GS::CMemArea &amp;tex) : Texture(tex) {}
<a name="l00307"></a><a class="code" href="classCSetGsTextureCmd.html#a1">00307</a>       <a class="code" href="classCDListCmd.html">CDListCmd</a>* <a class="code" href="classCDListCmd.html#a1">Play</a>()<font class="keyword"> </font>{
00308          pGLContext-&gt;GetTexManager().SetGsTexture(Texture);
00309          <font class="keywordflow">return</font> <a class="code" href="classCDListCmd.html#d1">CDListCmd::GetNextCmd</a>(<font class="keyword">this</font>);
00310       }
00311 };
00312 
00313 <font class="keywordtype">void</font>
<a name="l00314"></a><a class="code" href="classCTexManager.html#a13">00314</a> <a class="code" href="classCTexManager.html#a13">CTexManager::SetGsTexture</a>( GS::CMemArea &amp;area )<font class="keyword"></font>
00315 {
00316    GLContext.<a class="code" href="classCGLContext.html#a52">TextureChanged</a>();
00317 
00318    <font class="keywordflow">if</font> ( ! InsideDListDef ) 
00319       CurTexture-&gt;<a class="code" href="classCMMTexture.html#a2">SetImage</a>( area );
00320    <font class="keywordflow">else</font> {
00321       <a class="code" href="classCDList.html">CDList</a> &amp;dlist = GLContext.<a class="code" href="classCGLContext.html#a13">GetDListManager</a>().<a class="code" href="classCDListManager.html#a8">GetOpenDList</a>();
00322       dlist += CSetGsTextureCmd(area);
00323    }
00324 }
00325 
00326 <font class="comment">/********************************************</font>
00327  * CMMTexture methods
00328  */
00329 
<a name="l00330"></a><a class="code" href="classCMMTexture.html#a0">00330</a> <a class="code" href="classCMMTexture.html#a0">CMMTexture::CMMTexture</a>( GS::tContext context )
00331    : CTexture( context ), pImageMem(NULL), XferImage(false), IsResident(false)
00332 {
00333    <font class="comment">// always load the clut</font>
00334    <font class="comment">// FIXME:  this is obviously not the best way to do</font>
00335    <font class="comment">// things...fix this once there is reasonable clut</font>
00336    <font class="comment">// allocation</font>
00337    SetClutLoadConditions(1);
00338 }
00339 
<a name="l00340"></a><a class="code" href="classCMMTexture.html#a1">00340</a> <a class="code" href="classCMMTexture.html#a1">CMMTexture::~CMMTexture</a>()<font class="keyword"></font>
00341 {
00342    <font class="keyword">delete</font> pImageMem;
00343 }
00344 
00348 <font class="keywordtype">void</font>
<a name="l00349"></a><a class="code" href="classCMMTexture.html#a3">00349</a> <a class="code" href="classCMMTexture.html#a2">CMMTexture::SetImage</a>( tU128* imagePtr, tU32 w, tU32 h, GS::tPSM psm )<font class="keyword"></font>
00350 {
00351    <font class="keywordflow">if</font> ( pImageMem ) {
00352       <font class="comment">// we are being re-initialized</font>
00353       <font class="keyword">delete</font> pImageMem;
00354       CTexture::Reset();
00355    }
00356 
00357    CTexture::SetImage( imagePtr, w, h, psm, NULL );
00358 
00359    <font class="comment">// create a memarea for the image</font>
00360    tU32 bufWidth = gsrTex0.TBW * 64;
00361    pImageMem = <font class="keyword">new</font> GS::CMemArea( bufWidth, h, psm, GS::kAlignBlock );
00362         
00363    XferImage = <font class="keyword">true</font>;
00364 }
00365 
00370 <font class="keywordtype">void</font>
<a name="l00371"></a><a class="code" href="classCMMTexture.html#a2">00371</a> <a class="code" href="classCMMTexture.html#a2">CMMTexture::SetImage</a>( <font class="keyword">const</font> GS::CMemArea &amp;area )<font class="keyword"></font>
00372 {
00373    CTexEnv::SetPSM( area.GetPixFormat() );
00374    CTexEnv::SetDimensions( area.GetWidth(), area.GetHeight() );
00375    SetImageGsAddr( area.GetWordAddr() );
00376 
00377    XferImage = <font class="keyword">false</font>;
00378 }
00379 
00380 <font class="keywordtype">void</font>
<a name="l00381"></a><a class="code" href="classCMMTexture.html#a5">00381</a> <a class="code" href="classCMMTexture.html#a5">CMMTexture::ChangePsm</a>( GS::tPSM psm )<font class="keyword"></font>
00382 {
00383    <font class="comment">// we only want changes like 8 -&gt; 8h, or 4hh -&gt; 4, not 8 -&gt; 32</font>
00384 
00385    <font class="keyword">using</font> <font class="keyword">namespace </font>GS;
00386 
00387    <font class="comment">// printf("changing (%d,%d) into ", GetPSM(), psm);</font>
00388 
00389    <font class="keywordflow">if</font> ( GS::GetBitsPerPixel(psm) == GS::GetBitsPerPixel(GetPSM()) )<font class="keyword"> </font>{
00390       <font class="comment">// printf("%d\n", psm);</font>
00391       CTexEnv::SetPSM(psm);
00392       pImageUploadPkt-&gt;ChangePsm(psm);
00393    }
00394    <font class="keywordflow">else</font> {
00395       <font class="comment">// on the other hand, don't put an 8h into a 32</font>
00396 
00397       <font class="keywordtype">int</font> bpp = GS::GetBitsPerPixel(GetPSM());
00398       <font class="keywordflow">if</font> ( bpp == 8 &amp;&amp; GetPSM() == GS::kPsm8h )<font class="keyword"> </font>{
00399          <font class="comment">// printf("%d\n", kPsm8 );</font>
00400          ChangePsm(GS::kPsm8);
00401       }
00402       <font class="keywordflow">else</font> <font class="keywordflow">if</font> ( bpp == 4 &amp;&amp; GetPSM() != GS::kPsm4 )<font class="keyword"> </font>{
00403          <font class="comment">// printf("%d\n", kPsm4 );</font>
00404          ChangePsm(GS::kPsm4);
00405       }
00406       <font class="keywordflow">else</font> {
00407          <font class="comment">// printf("&lt;no change&gt;\n");</font>
00408       }
00409    }
00410 }
00411 
00412 <font class="keywordtype">void</font>
<a name="l00413"></a><a class="code" href="classCMMTexture.html#a6">00413</a> <a class="code" href="classCMMTexture.html#a6">CMMTexture::Load</a>( <font class="keywordtype">bool</font> waitForEnd = <font class="keyword">true</font> )<font class="keyword"></font>
00414 {
00415    mErrorIf( pImageMem == NULL,
00416              <font class="stringliteral">"Trying to load a texture that hasn't been defined!"</font> );
00417    <font class="comment">// first set the gs address and flush the cache</font>
00418    <font class="keywordflow">if</font> ( ! pImageMem-&gt;IsAllocated() ) {
00419       pImageMem-&gt;Alloc();
00420       <font class="keywordflow">if</font> ( GetPSM() != pImageMem-&gt;GetPixFormat() )
00421          <a class="code" href="classCMMTexture.html#a5">ChangePsm</a>(pImageMem-&gt;GetPixFormat());
00422       SetImageGsAddr( pImageMem-&gt;GetWordAddr() );
00423       IsResident = <font class="keyword">false</font>;
00424    }
00425    <font class="keywordflow">if</font> ( ! IsResident ) {
00426 <font class="preprocessor">#ifndef PS2_LINUX</font>
00427       FlushCache(0);
00428 <font class="preprocessor">#endif</font>
00429       <font class="comment">// send the image</font>
00430       SendImage( waitForEnd, Packet::kDontFlushCache );
00431       IsResident = <font class="keyword">true</font>;
00432 
00433       <a class="code" href="metrics_8h.html#a12">pglAddToMetric</a>(<a class="code" href="metrics_8h.html#a13a3">kMetricsTextureUploadCount</a>);
00434    }
00435 }
00436 
00437 <font class="comment">// these two should be templates or something..</font>
00438 
00439 <font class="keywordtype">void</font>
<a name="l00440"></a><a class="code" href="classCMMTexture.html#a8">00440</a> <a class="code" href="classCMMTexture.html#a6">CMMTexture::Load</a>( CSCDmaPacket&amp; packet )<font class="keyword"></font>
00441 {
00442    mErrorIf( pImageMem == NULL,
00443              <font class="stringliteral">"Trying to load a texture that hasn't been defined!"</font> );
00444    <font class="keywordflow">if</font> ( ! pImageMem-&gt;IsAllocated() ) {
00445       pImageMem-&gt;Alloc();
00446       <font class="keywordflow">if</font> ( GetPSM() != pImageMem-&gt;GetPixFormat() )
00447          <a class="code" href="classCMMTexture.html#a5">ChangePsm</a>(pImageMem-&gt;GetPixFormat());
00448       SetImageGsAddr( pImageMem-&gt;GetWordAddr() );
00449       IsResident = <font class="keyword">false</font>;
00450    }
00451    <font class="keywordflow">if</font> ( ! IsResident ) {
00452       SendImage( packet );
00453       IsResident = <font class="keyword">true</font>;
00454 
00455       <a class="code" href="metrics_8h.html#a12">pglAddToMetric</a>(<a class="code" href="metrics_8h.html#a13a3">kMetricsTextureUploadCount</a>);
00456    }
00457 }
00458 <font class="keywordtype">void</font>
<a name="l00459"></a><a class="code" href="classCMMTexture.html#a9">00459</a> <a class="code" href="classCMMTexture.html#a6">CMMTexture::Load</a>( CVifSCDmaPacket&amp; packet )<font class="keyword"></font>
00460 {
00461    mErrorIf( pImageMem == NULL,
00462              <font class="stringliteral">"Trying to load a texture that hasn't been defined!"</font> );
00463    <font class="keywordflow">if</font> ( ! pImageMem-&gt;IsAllocated() ) {
00464       pImageMem-&gt;Alloc();
00465       <font class="keywordflow">if</font> ( GetPSM() != pImageMem-&gt;GetPixFormat() )
00466          <a class="code" href="classCMMTexture.html#a5">ChangePsm</a>(pImageMem-&gt;GetPixFormat());
00467       SetImageGsAddr( pImageMem-&gt;GetWordAddr() );
00468       IsResident = <font class="keyword">false</font>;
00469    }
00470    <font class="keywordflow">if</font> ( ! IsResident ) {
00471 <font class="comment">//        printf("allocing memarea of psm %d (%dx%d)...", pImageMem-&gt;GetPixFormat(),</font>
00472 <font class="comment">//           GetW(), GetH() );</font>
00473 <font class="comment">//        printf("at addr %d\n", pImageMem-&gt;GetWordAddr() /2048);</font>
00474       SendImage( packet );
00475       IsResident = <font class="keyword">true</font>;
00476 
00477       <a class="code" href="metrics_8h.html#a12">pglAddToMetric</a>(<a class="code" href="metrics_8h.html#a13a3">kMetricsTextureUploadCount</a>);
00478    }
00479 }
00480 
00481 <font class="comment">// again, should be templates..</font>
00482 
00483 <font class="keywordtype">void</font>
<a name="l00484"></a><a class="code" href="classCMMTexture.html#a7">00484</a> <a class="code" href="classCMMTexture.html#a7">CMMTexture::Use</a>( <font class="keywordtype">bool</font> waitForEnd = <font class="keyword">false</font> )<font class="keyword"></font>
00485 {
00486    <font class="keywordflow">if</font> ( XferImage ) <a class="code" href="classCMMTexture.html#a6">Load</a>();
00487    SendSettings( waitForEnd, Packet::kDontFlushCache );
00488 }
00489 <font class="keywordtype">void</font>
<a name="l00490"></a><a class="code" href="classCMMTexture.html#a10">00490</a> <a class="code" href="classCMMTexture.html#a7">CMMTexture::Use</a>( CSCDmaPacket&amp; packet )<font class="keyword"></font>
00491 {
00492    <font class="keywordflow">if</font> ( XferImage ) <a class="code" href="classCMMTexture.html#a6">Load</a>( packet );
00493    SendSettings( packet );
00494 }
00495 <font class="keywordtype">void</font>
<a name="l00496"></a><a class="code" href="classCMMTexture.html#a11">00496</a> <a class="code" href="classCMMTexture.html#a7">CMMTexture::Use</a>( CVifSCDmaPacket&amp; packet )<font class="keyword"></font>
00497 {
00498    <font class="keywordflow">if</font> ( XferImage ) <a class="code" href="classCMMTexture.html#a6">Load</a>( packet );
00499    SendSettings( packet );
00500 }
00501 
00502 <font class="keywordtype">void</font>
<a name="l00503"></a><a class="code" href="classCMMTexture.html#a13">00503</a> <a class="code" href="classCMMTexture.html#a13">CMMTexture::Free</a>( <font class="keywordtype">void</font> )<font class="keyword"></font>
00504 {
00505    pImageMem-&gt;Free();
00506    IsResident = <font class="keyword">false</font>;
00507 }
00508 
00509 <font class="keywordtype">void</font>
<a name="l00510"></a><a class="code" href="classCMMTexture.html#a12">00510</a> <a class="code" href="classCMMTexture.html#a12">CMMTexture::BindToSlot</a>( GS::CMemSlot &amp;slot )<font class="keyword"></font>
00511 {
00512 <font class="comment">//     slot.Bind(*pImageMem, 0);</font>
00513 <font class="comment">//     if ( GetPSM() != pImageMem-&gt;GetPixFormat() )</font>
00514 <font class="comment">//        ChangePsm(pImageMem-&gt;GetPixFormat());</font>
00515 <font class="comment">//     SetImageGsAddr( pImageMem-&gt;GetWordAddr() );</font>
00516 <font class="comment">//     IsResident = false;</font>
00517 }
00518 
00519 <font class="comment">/********************************************</font>
00520  * CMMClut
00521  */
00522 
00523 <font class="keywordtype">void</font>
<a name="l00524"></a><a class="code" href="classCMMClut.html#a2">00524</a> <a class="code" href="classCMMClut.html#a2">CMMClut::Load</a>( CVifSCDmaPacket &amp;packet )<font class="keyword"></font>
00525 {
00526    <font class="keywordflow">if</font> ( ! GsMem.IsAllocated() ) {
00527       GsMem.Alloc();
00528       SetGsAddr( GsMem.GetWordAddr() );
00529       Send(packet);
00530 
00531       <a class="code" href="metrics_8h.html#a12">pglAddToMetric</a>(<a class="code" href="metrics_8h.html#a13a5">kMetricsClutUploadCount</a>);
00532    }
00533 }
00534 
00535 <font class="comment">/********************************************</font>
00536  * gl api
00537  */
00538 
<a name="l00539"></a><a class="code" href="texture_8cpp.html#a992">00539</a> <font class="keywordtype">void</font> <a class="code" href="gl_8h.html#a992">glGenTextures</a>( <a class="code" href="gl_8h.html#a697">GLsizei</a> numNewTexNames, <a class="code" href="gl_8h.html#a696">GLuint</a> *newTexNames )<font class="keyword"></font>
00540 {
00541    <a class="code" href="classCTexManager.html">CTexManager</a> &amp;texManager = pGLContext-&gt;GetTexManager();
00542    texManager.<a class="code" href="classCTexManager.html#a4">GenTextures</a>( numNewTexNames, newTexNames );
00543 }
00544 
<a name="l00545"></a><a class="code" href="texture_8cpp.html#a994">00545</a> <font class="keywordtype">void</font> <a class="code" href="gl_8h.html#a994">glBindTexture</a>( <a class="code" href="gl_8h.html#a687">GLenum</a> target, <a class="code" href="gl_8h.html#a696">GLuint</a> texName )<font class="keyword"></font>
00546 {
00547    mErrorIf( target != <a class="code" href="gl_8h.html#a418">GL_TEXTURE_2D</a>, <font class="stringliteral">"There are only 2D textures in ps2gl"</font> );
00548 
00549    <a class="code" href="classCTexManager.html">CTexManager</a> &amp;texManager = pGLContext-&gt;GetTexManager();
00550    texManager.<a class="code" href="classCTexManager.html#a5">BindTexture</a>( texName );
00551 }
00552 
<a name="l00553"></a><a class="code" href="texture_8cpp.html#a993">00553</a> <font class="keywordtype">void</font> <a class="code" href="gl_8h.html#a993">glDeleteTextures</a>( <a class="code" href="gl_8h.html#a697">GLsizei</a> numToDelete, <font class="keyword">const</font> <a class="code" href="gl_8h.html#a696">GLuint</a> *texNames )<font class="keyword"></font>
00554 {
00555    <a class="code" href="classCTexManager.html">CTexManager</a> &amp;texManager = pGLContext-&gt;GetTexManager();
00556    texManager.<a class="code" href="classCTexManager.html#a6">DeleteTextures</a>( numToDelete, texNames );
00557 }
00558 
<a name="l00559"></a><a class="code" href="texture_8cpp.html#a990">00559</a> <font class="keywordtype">void</font> <a class="code" href="gl_8h.html#a990">glTexImage2D</a>( <a class="code" href="gl_8h.html#a687">GLenum</a> target,
00560                    <a class="code" href="gl_8h.html#a693">GLint</a> level,
00561                    <a class="code" href="gl_8h.html#a693">GLint</a> internalFormat,
00562                    <a class="code" href="gl_8h.html#a697">GLsizei</a> width,
00563                    <a class="code" href="gl_8h.html#a697">GLsizei</a> height,
00564                    <a class="code" href="gl_8h.html#a693">GLint</a> border,
00565                    <a class="code" href="gl_8h.html#a687">GLenum</a> format,
00566                    <a class="code" href="gl_8h.html#a687">GLenum</a> type,
00567                    <font class="keyword">const</font> <a class="code" href="gl_8h.html#a690">GLvoid</a> *pixels )<font class="keyword"></font>
00568 {
00569    <font class="keywordflow">if</font> ( target == <a class="code" href="gl_8h.html#a459">GL_PROXY_TEXTURE_2D</a> ) {
00570       <a class="code" href="debug_8h.html#a1">mNotImplemented</a>( );
00571       <font class="keywordflow">return</font>;
00572    }
00573    <font class="keywordflow">if</font> ( level &gt; 0 ) {
00574       <a class="code" href="debug_8h.html#a1">mNotImplemented</a>(<font class="stringliteral">"mipmapping"</font>);
00575       <font class="keywordflow">return</font>;
00576    }
00577    <font class="keywordflow">if</font> ( border &gt; 0 ) {
00578       <a class="code" href="debug_8h.html#a1">mNotImplemented</a>(<font class="stringliteral">"texture borders"</font>);
00579       <font class="keywordflow">return</font>;
00580    }
00581    <font class="keywordflow">if</font> ( (<font class="keywordtype">unsigned</font> <font class="keywordtype">int</font>)pixels &amp; 0xf ) {
00582       <a class="code" href="debug_8h.html#a1">mNotImplemented</a>( <font class="stringliteral">"texture data needs to be aligned to at least 16 bytes, "</font>
00583                        <font class="stringliteral">"preferably 9 quads"</font> );
00584    }
00585 
00586    GS::tPSM psm = GS::kInvalidPsm;
00587    <font class="keywordflow">switch</font> (format) {
00588       <font class="keywordflow">case</font> <a class="code" href="gl_8h.html#a290">GL_RGBA</a>:
00589          <font class="keywordflow">if</font> ( type == <a class="code" href="gl_8h.html#a4">GL_UNSIGNED_BYTE</a> ||
00590               type == <a class="code" href="gl_8h.html#a533">GL_UNSIGNED_INT_8_8_8_8</a> )
00591             psm = GS::kPsm32;
00592          <font class="keywordflow">else</font> <font class="keywordflow">if</font> ( type == <a class="code" href="gl_8h.html#a531">GL_UNSIGNED_SHORT_5_5_5_1</a> )
00593             psm = GS::kPsm16;
00594          <font class="keywordflow">else</font> {
00595             <a class="code" href="debug_8h.html#a1">mNotImplemented</a>( <font class="stringliteral">"RGBA textures should have a type of GL_UNSIGNED_BYTE, "</font>
00596                              <font class="stringliteral">"GL_UNSIGNED_INT_8_8_8_8, or GL_UNSIGNED_SHORT_5_5_5_1"</font> );
00597          }
00598          <font class="keywordflow">break</font>;
00599       <font class="keywordflow">case</font> <a class="code" href="gl_8h.html#a289">GL_RGB</a>:
00600          <font class="keywordflow">if</font> ( type == <a class="code" href="gl_8h.html#a4">GL_UNSIGNED_BYTE</a> )
00601             psm = GS::kPsm24;
00602          <font class="keywordflow">else</font> {
00603             <a class="code" href="debug_8h.html#a1">mNotImplemented</a>( <font class="stringliteral">"RGB textures should have a type of GL_UNSIGNED_BYTE"</font> );
00604          }
00605          <font class="keywordflow">break</font>;
00606       <font class="keywordflow">case</font> <a class="code" href="gl_8h.html#a266">GL_COLOR_INDEX</a>:
00607          <font class="keywordflow">if</font> ( type == <a class="code" href="gl_8h.html#a4">GL_UNSIGNED_BYTE</a> )
00608             psm = GS::kPsm8;
00609          <font class="keywordflow">else</font> {
00610             <a class="code" href="debug_8h.html#a1">mNotImplemented</a>( <font class="stringliteral">"indexed textures should have a type of GL_UNSIGNED_BYTE"</font> );
00611          }
00612          <font class="keywordflow">break</font>;
00613       <font class="keywordflow">default</font>:
00614          mError( <font class="stringliteral">"Unknown texture format"</font> );
00615    }
00616 
00617    <font class="keywordflow">if</font> ( psm != GS::kInvalidPsm ) {
00618       <a class="code" href="classCTexManager.html">CTexManager</a>&amp; tm = pGLContext-&gt;GetTexManager();
00619       tm.<a class="code" href="classCTexManager.html#a12">SetCurTexImage</a>( (tU128*)pixels, width, height, psm );
00620    }
00621 }
00622 
<a name="l00623"></a><a class="code" href="texture_8cpp.html#a1042">00623</a> <font class="keywordtype">void</font> <a class="code" href="gl_8h.html#a1042">glColorTable</a>( <a class="code" href="gl_8h.html#a687">GLenum</a> target, <a class="code" href="gl_8h.html#a687">GLenum</a> internalFormat,
00624                    <a class="code" href="gl_8h.html#a697">GLsizei</a> width, <a class="code" href="gl_8h.html#a687">GLenum</a> format, <a class="code" href="gl_8h.html#a687">GLenum</a> type,
00625                    <font class="keyword">const</font> <a class="code" href="gl_8h.html#a690">GLvoid</a> *table )<font class="keyword"></font>
00626 {
00627    mWarnIf( target != <a class="code" href="gl_8h.html#a550">GL_COLOR_TABLE</a>,
00628             <font class="stringliteral">"glColorTable only supports GL_COLOR_TABLE"</font> );
00629    <font class="comment">// ignore internalFormat</font>
00630    mErrorIf( width != 16 &amp;&amp; width != 256,
00631              <font class="stringliteral">"A color table must contain either 16 or 256 entries"</font> );
00632    mErrorIf( format != <a class="code" href="gl_8h.html#a289">GL_RGB</a> &amp;&amp; format != <a class="code" href="gl_8h.html#a290">GL_RGBA</a>,
00633              <font class="stringliteral">"The pixel format of color tables must be either GL_RGB or GL_RGBA"</font> );
00634    mWarnIf( type != <a class="code" href="gl_8h.html#a8">GL_UNSIGNED_INT</a> &amp;&amp; type != <a class="code" href="gl_8h.html#a533">GL_UNSIGNED_INT_8_8_8_8</a>,
00635             <font class="stringliteral">"The type of color table data must be either GL_UNSIGNED_INT or"</font>
00636             <font class="stringliteral">"GL_UNSIGNED_INT_8_8_8_8"</font> );
00637    mErrorIf( (<font class="keywordtype">unsigned</font> <font class="keywordtype">int</font>)table &amp; (16-1),
00638              <font class="stringliteral">"Color tables in ps2gl need to be 16-byte aligned in memory.."</font> );
00639 
00640    <a class="code" href="classCTexManager.html">CTexManager</a>&amp; tm = pGLContext-&gt;GetTexManager();
00641    tm.<a class="code" href="classCTexManager.html#a14">SetCurClut</a>( table, width );
00642 }
00643 
<a name="l00644"></a><a class="code" href="texture_8cpp.html#a982">00644</a> <font class="keywordtype">void</font> <a class="code" href="gl_8h.html#a982">glTexParameteri</a>( <a class="code" href="gl_8h.html#a687">GLenum</a> target, <a class="code" href="gl_8h.html#a687">GLenum</a> pname, <a class="code" href="gl_8h.html#a693">GLint</a> param )<font class="keyword"></font>
00645 {
00646    <font class="keywordflow">if</font> ( target != <a class="code" href="gl_8h.html#a418">GL_TEXTURE_2D</a> ) {
00647       <a class="code" href="debug_8h.html#a1">mNotImplemented</a>( <font class="stringliteral">"Sorry, only 2d textures."</font> );
00648       <font class="keywordflow">return</font>;
00649    }
00650 
00651    pGLContext-&gt;GetTexManager().SetCurTexParam( pname, param );
00652 }
00653 
<a name="l00654"></a><a class="code" href="texture_8cpp.html#a981">00654</a> <font class="keywordtype">void</font> <a class="code" href="gl_8h.html#a981">glTexParameterf</a>( <a class="code" href="gl_8h.html#a687">GLenum</a> target, <a class="code" href="gl_8h.html#a687">GLenum</a> pname, <a class="code" href="gl_8h.html#a698">GLfloat</a> param )<font class="keyword"></font>
00655 {
00656    <a class="code" href="gl_8h.html#a982">glTexParameteri</a>( target, pname, (<a class="code" href="gl_8h.html#a693">GLint</a>)param );
00657 }
00658 
<a name="l00659"></a><a class="code" href="texture_8cpp.html#a7">00659</a> <font class="keywordtype">void</font> <a class="code" href="gl_8h.html#a984">glTexParameteriv</a>( <a class="code" href="gl_8h.html#a687">GLenum</a> target, <a class="code" href="gl_8h.html#a687">GLenum</a> pname, <a class="code" href="gl_8h.html#a693">GLint</a> *param )<font class="keyword"></font>
00660 {
00661    <a class="code" href="gl_8h.html#a982">glTexParameteri</a>( target, pname, *param );
00662 }
00663 
<a name="l00664"></a><a class="code" href="texture_8cpp.html#a983">00664</a> <font class="keywordtype">void</font> <a class="code" href="gl_8h.html#a983">glTexParameterfv</a>( <a class="code" href="gl_8h.html#a687">GLenum</a> target, <a class="code" href="gl_8h.html#a687">GLenum</a> pname, <font class="keyword">const</font> <a class="code" href="gl_8h.html#a698">GLfloat</a> *param )<font class="keyword"></font>
00665 {
00666    <a class="code" href="gl_8h.html#a982">glTexParameteri</a>( target, pname, (<a class="code" href="gl_8h.html#a693">GLint</a>)*param );
00667 }
00668 
<a name="l00669"></a><a class="code" href="texture_8cpp.html#a976">00669</a> <font class="keywordtype">void</font> <a class="code" href="gl_8h.html#a976">glTexEnvi</a>( <a class="code" href="gl_8h.html#a687">GLenum</a> target, <a class="code" href="gl_8h.html#a687">GLenum</a> pname, <a class="code" href="gl_8h.html#a693">GLint</a> param )<font class="keyword"></font>
00670 {
00671    <a class="code" href="classCTexManager.html">CTexManager</a> &amp;tm = pGLContext-&gt;GetTexManager();
00672 
00673    <font class="keywordflow">switch</font>( param ) {
00674       <font class="keywordflow">case</font> <a class="code" href="gl_8h.html#a448">GL_MODULATE</a>:
00675          tm.<a class="code" href="classCTexManager.html#a10">SetTexMode</a>( (GS::tTexMode)(param &amp; 0xf) );
00676          <font class="keywordflow">break</font>;
00677       <font class="keywordflow">case</font> <a class="code" href="gl_8h.html#a447">GL_DECAL</a>:
00678          mWarn( <font class="stringliteral">"GL_DECAL functions exactly as GL_REPLACE right now."</font> );
00679       <font class="keywordflow">case</font> <a class="code" href="gl_8h.html#a252">GL_REPLACE</a>:
00680          tm.<a class="code" href="classCTexManager.html#a10">SetTexMode</a>( (GS::tTexMode)(param &amp; 0xf) );
00681          <font class="keywordflow">break</font>;
00682       <font class="keywordflow">case</font> <a class="code" href="gl_8h.html#a171">GL_BLEND</a>:
00683          <a class="code" href="debug_8h.html#a1">mNotImplemented</a>( );
00684          <font class="keywordflow">break</font>;
00685    }
00686 }
00687 
<a name="l00688"></a><a class="code" href="texture_8cpp.html#a975">00688</a> <font class="keywordtype">void</font> <a class="code" href="gl_8h.html#a975">glTexEnvf</a>( <a class="code" href="gl_8h.html#a687">GLenum</a> target, <a class="code" href="gl_8h.html#a687">GLenum</a> pname, <a class="code" href="gl_8h.html#a698">GLfloat</a> param )<font class="keyword"></font>
00689 {
00690    <a class="code" href="gl_8h.html#a976">glTexEnvi</a>( target, pname, (<a class="code" href="gl_8h.html#a693">GLint</a>)param );
00691 }
00692 
<a name="l00693"></a><a class="code" href="texture_8cpp.html#a11">00693</a> <font class="keywordtype">void</font> <a class="code" href="gl_8h.html#a977">glTexEnvfv</a>( <a class="code" href="gl_8h.html#a687">GLenum</a> target, <a class="code" href="gl_8h.html#a687">GLenum</a> pname, <a class="code" href="gl_8h.html#a698">GLfloat</a> *param )<font class="keyword"></font>
00694 {
00695    <a class="code" href="gl_8h.html#a976">glTexEnvi</a>( target, pname, (<a class="code" href="gl_8h.html#a693">GLint</a>)*param );
00696 }
00697 
<a name="l00698"></a><a class="code" href="texture_8cpp.html#a12">00698</a> <font class="keywordtype">void</font> <a class="code" href="gl_8h.html#a978">glTexEnviv</a>( <a class="code" href="gl_8h.html#a687">GLenum</a> target, <a class="code" href="gl_8h.html#a687">GLenum</a> pname, <a class="code" href="gl_8h.html#a693">GLint</a> *param )<font class="keyword"></font>
00699 {
00700    <a class="code" href="gl_8h.html#a976">glTexEnvi</a>( target, pname, *param );
00701 }
00702 
<a name="l00703"></a><a class="code" href="texture_8cpp.html#a13">00703</a> <font class="keywordtype">void</font> <a class="code" href="gl_8h.html#a999">glTexSubImage2D</a>( <a class="code" href="gl_8h.html#a687">GLenum</a> target, <font class="keywordtype">int</font> level,
00704                       <font class="keywordtype">int</font> xoffset, <font class="keywordtype">int</font> yoffset, <font class="keywordtype">int</font> width, <font class="keywordtype">int</font> height,
00705                       <a class="code" href="gl_8h.html#a687">GLenum</a> format, <a class="code" href="gl_8h.html#a687">GLenum</a> type,
00706                       <font class="keyword">const</font> <font class="keywordtype">void</font>* pixels )<font class="keyword"></font>
00707 {
00708    <a class="code" href="debug_8h.html#a1">mNotImplemented</a>( );
00709 }
00710 
<a name="l00711"></a><a class="code" href="texture_8cpp.html#a14">00711</a> <font class="keywordtype">void</font> <a class="code" href="gl_8h.html#a1001">glCopyTexImage2D</a>( <a class="code" href="gl_8h.html#a687">GLenum</a> target, <font class="keywordtype">int</font> level,
00712                        <a class="code" href="gl_8h.html#a687">GLenum</a> iformat,
00713                        <font class="keywordtype">int</font> x, <font class="keywordtype">int</font> y, <font class="keywordtype">int</font> width, <font class="keywordtype">int</font> height,
00714                        <font class="keywordtype">int</font> border )<font class="keyword"></font>
00715 {
00716    <a class="code" href="debug_8h.html#a1">mNotImplemented</a>( );
00717 }
00718 
<a name="l00719"></a><a class="code" href="texture_8cpp.html#a15">00719</a> <font class="keywordtype">void</font> <a class="code" href="gl_8h.html#a1003">glCopyTexSubImage2D</a>( <a class="code" href="gl_8h.html#a687">GLenum</a> target, <font class="keywordtype">int</font> level,
00720                           <font class="keywordtype">int</font> xoffset, <font class="keywordtype">int</font> yoffset, <font class="keywordtype">int</font> x, <font class="keywordtype">int</font> y,
00721                           <font class="keywordtype">int</font> width, <font class="keywordtype">int</font> height )<font class="keyword"></font>
00722 {
00723    <a class="code" href="debug_8h.html#a1">mNotImplemented</a>( );
00724 }
00725 
00726 <font class="comment">/********************************************</font>
00727  * ps2gl C interface
00728  */
00729 
00739 <font class="keywordtype">void</font>
<a name="l00740"></a><a class="code" href="texture_8cpp.html#a40">00740</a> <a class="code" href="ps2gl_8h.html#a40">pglFreeTexture</a>( <a class="code" href="gl_8h.html#a696">GLuint</a> texId )<font class="keyword"></font>
00741 {
00742    <a class="code" href="classCTexManager.html">CTexManager</a> &amp;texManager = pGLContext-&gt;GetTexManager();
00743    <a class="code" href="classCMMTexture.html">CMMTexture</a> &amp;texture = texManager.<a class="code" href="classCTexManager.html#a8">GetNamedTexture</a>(texId);
00744    texture.<a class="code" href="classCMMTexture.html#a13">Free</a>();
00745 }
00746 
00752 <font class="keywordtype">void</font>
<a name="l00753"></a><a class="code" href="texture_8cpp.html#a39">00753</a> <a class="code" href="ps2gl_8h.html#a39">pglBindTextureToSlot</a>( <a class="code" href="gl_8h.html#a696">GLuint</a> texId, <a class="code" href="ps2gl_8h.html#a11">pgl_slot_handle_t</a> mem_slot )<font class="keyword"></font>
00754 {
00755    <a class="code" href="classCTexManager.html">CTexManager</a> &amp;texManager = pGLContext-&gt;GetTexManager();
00756    <a class="code" href="classCMMTexture.html">CMMTexture</a> &amp;texture = texManager.<a class="code" href="classCTexManager.html#a8">GetNamedTexture</a>(texId);
00757    texture.<a class="code" href="classCMMTexture.html#a12">BindToSlot</a>( *reinterpret_cast&lt;GS::CMemSlot*&gt;(mem_slot) );
00758 }
00759 
<a name="l00765"></a><a class="code" href="texture_8cpp.html#a38">00765</a> <font class="keywordtype">void</font> <a class="code" href="ps2gl_8h.html#a38">pglTextureFromGsMemArea</a>( <a class="code" href="ps2gl_8h.html#a12">pgl_area_handle_t</a> tex_area_handle )<font class="keyword"></font>
00766 {
00767    <a class="code" href="classCTexManager.html">CTexManager</a> &amp;texManager = pGLContext-&gt;GetTexManager();
00768    GS::CMemArea *texArea = reinterpret_cast&lt;GS::CMemArea*&gt;(tex_area_handle);
00769    texManager.<a class="code" href="classCTexManager.html#a13">SetGsTexture</a>( *texArea );
00770 }
00771 
</pre></div><hr><address><small>ps2gl version cvs</small></address>
