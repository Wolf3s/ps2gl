<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>glcontext.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body bgcolor="#ffffff">
<!-- Generated by Doxygen 1.2.11 -->
<center>
<a class="qindex" href="main.html">Main Page</a> &nbsp; <a class="qindex" href="modules.html">Modules</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>glcontext.cpp</h1><a href="glcontext_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <font class="comment">/*        Copyright (C) 2000,2001,2002  Sony Computer Entertainment America</font>
00002           
00003           This file is subject to the terms and conditions of the GNU Lesser
00004           General Public License Version 2.1. See the file "COPYING" in the
00005           main directory of this archive for more details.                             */
00006 
00007 <font class="preprocessor">#include &lt;string.h&gt;</font>
00008 
00009 <font class="preprocessor">#ifndef PS2_LINUX</font>
00010 <font class="preprocessor">#  include "libgraph.h"</font>
00011 <font class="preprocessor">#  include "libdma.h"</font>
00012 <font class="preprocessor">#  include "libdev.h"</font>
00013 <font class="preprocessor">#else</font>
00014 <font class="preprocessor">#  include &lt;sys/mman.h&gt;</font>
00015 <font class="preprocessor">#  include "ps2stuff_kmodule.h"</font>
00016 <font class="preprocessor">#  include &lt;ps2gs.h&gt;</font>
00017 <font class="preprocessor">#endif</font>
00018 
00019 <font class="preprocessor">#include "<a class="code" href="ps2gl_8h.html">GL/ps2gl.h</a>"</font>
00020 
00021 <font class="preprocessor">#include "ps2s/ps2stuff.h"</font>
00022 <font class="preprocessor">#include "ps2s/types.h"</font>
00023 <font class="preprocessor">#include "ps2s/math.h"</font>
00024 <font class="preprocessor">#include "ps2s/drawenv.h"</font>
00025 <font class="preprocessor">#include "ps2s/displayenv.h"</font>
00026 <font class="preprocessor">#include "ps2s/packet.h"</font>
00027 <font class="preprocessor">#include "ps2s/gsmem.h"</font>
00028 <font class="preprocessor">#include "<a class="code" href="texture_8h.html">ps2s/texture.h</a>"</font>
00029 
00030 <font class="preprocessor">#include "<a class="code" href="glcontext_8h.html">ps2gl/glcontext.h</a>"</font>
00031 <font class="preprocessor">#include "<a class="code" href="matrix_8h.html">ps2gl/matrix.h</a>"</font>
00032 <font class="preprocessor">#include "<a class="code" href="gmanager_8h.html">ps2gl/gmanager.h</a>"</font>
00033 <font class="preprocessor">#include "<a class="code" href="dlgmanager_8h.html">ps2gl/dlgmanager.h</a>"</font>
00034 <font class="preprocessor">#include "<a class="code" href="immgmanager_8h.html">ps2gl/immgmanager.h</a>"</font>
00035 <font class="preprocessor">#include "<a class="code" href="lighting_8h.html">ps2gl/lighting.h</a>"</font>
00036 <font class="preprocessor">#include "<a class="code" href="material_8h.html">ps2gl/material.h</a>"</font>
00037 <font class="preprocessor">#include "<a class="code" href="dlist_8h.html">ps2gl/dlist.h</a>"</font>
00038 <font class="preprocessor">#include "<a class="code" href="texture_8h.html">ps2gl/texture.h</a>"</font>
00039 <font class="preprocessor">#include "<a class="code" href="displaycontext_8h.html">ps2gl/displaycontext.h</a>"</font>
00040 <font class="preprocessor">#include "<a class="code" href="drawcontext_8h.html">ps2gl/drawcontext.h</a>"</font>
00041 
00042 <font class="comment">/********************************************</font>
00043  * globals
00044  */
00045 
00046 
00047 <font class="comment">/********************************************</font>
00048  * CGLContext
00049  */
00050 
00051 <font class="comment">// static members</font>
00052 
00053 CVifSCDmaPacket *CGLContext::CurPacket, *CGLContext::LastPacket,
00054      *CGLContext::Vif1Packet = NULL, *CGLContext::SavedVif1Packet = NULL,
00055      *CGLContext::ImmVif1Packet;
00056 
00057 <font class="keywordtype">int</font> CGLContext::RenderingFinishedSemaId                 = -1;
00058 <font class="keywordtype">int</font> CGLContext::ImmediateRenderingFinishedSemaId        = -1;
00059 <font class="keywordtype">int</font> CGLContext::VsyncSemaId                             = -1;
00060 
00061 CGLContext::tRenderingFinishedCallback CGLContext::RenderingFinishedCallback = NULL;
00062 
<a name="l00063"></a><a class="code" href="classCGLContext.html#a0">00063</a> <a class="code" href="classCGLContext.html#a0">CGLContext::CGLContext</a>( <font class="keywordtype">int</font> immBufferQwordSize, <font class="keywordtype">int</font> immDrawBufferQwordSize )
00064    : StateChangesArePushed(false),
00065      IsCurrentFieldEven(true),
00066      CurrentFrameNumber(0),
00067      CurBuffer(0)
00068 {
00069    CurPacket = <font class="keyword">new</font> CVifSCDmaPacket( kDmaPacketMaxQwordLength, DMAC::Channels::vif1,
00070                                      Packet::kXferTags, Core::MemMappings::UncachedAccl );
00071    LastPacket = <font class="keyword">new</font> CVifSCDmaPacket( kDmaPacketMaxQwordLength, DMAC::Channels::vif1,
00072                                       Packet::kXferTags, Core::MemMappings::UncachedAccl );
00073    Vif1Packet = CurPacket;
00074 
00075    ImmVif1Packet = <font class="keyword">new</font> CVifSCDmaPacket( immDrawBufferQwordSize, DMAC::Channels::vif1,
00076                                         Packet::kXferTags, Core::MemMappings::UncachedAccl );
00077 
00078    CurDrawEnvPtrs = DrawEnvPtrs0;
00079    LastDrawEnvPtrs = DrawEnvPtrs1;
00080    NumCurDrawEnvPtrs = 0;
00081    NumLastDrawEnvPtrs = 0;
00082 
00083    ImmGManager = <font class="keyword">new</font> CImmGeomManager(*<font class="keyword">this</font>, immBufferQwordSize);
00084    DListGManager = <font class="keyword">new</font> CDListGeomManager(*<font class="keyword">this</font>);
00085    CurGManager = ImmGManager;
00086 
00087    ProjectionMatStack = <font class="keyword">new</font> CImmMatrixStack(*<font class="keyword">this</font>);
00088    ModelViewMatStack = <font class="keyword">new</font> CImmMatrixStack(*<font class="keyword">this</font>);
00089    DListMatStack = <font class="keyword">new</font> CDListMatrixStack(*<font class="keyword">this</font>);
00090    CurMatrixStack = ModelViewMatStack;
00091    SavedCurMatStack = NULL;
00092 
00093    ImmLighting = <font class="keyword">new</font> CImmLighting(*<font class="keyword">this</font>);
00094    DListLighting = <font class="keyword">new</font> CDListLighting(*<font class="keyword">this</font>);
00095    CurLighting = ImmLighting;
00096    <font class="comment">// defaults</font>
00097    <a class="code" href="classCLight.html">CLight</a> &amp;light = ImmLighting-&gt;<a class="code" href="classCImmLighting.html#a2">GetLight</a>(0);
00098    light.<a class="code" href="classCLight.html#a2">SetDiffuse</a>( cpu_vec_xyzw(1.0f, 1.0f, 1.0f, 1.0f) );
00099    light.<a class="code" href="classCLight.html#a3">SetSpecular</a>( cpu_vec_xyzw(1.0f, 1.0f, 1.0f, 1.0f) );
00100 
00101    MaterialManager = <font class="keyword">new</font> CMaterialManager(*<font class="keyword">this</font>);
00102    DListManager = <font class="keyword">new</font> <a class="code" href="classCDListManager.html">CDListManager</a>;
00103    TexManager = <font class="keyword">new</font> CTexManager(*<font class="keyword">this</font>);
00104 
00105    ImmDrawContext = <font class="keyword">new</font> CImmDrawContext(*<font class="keyword">this</font>);
00106    DListDrawContext = <font class="keyword">new</font> CDListDrawContext(*<font class="keyword">this</font>);
00107    CurDrawContext = ImmDrawContext;
00108 
00109    DisplayContext = <font class="keyword">new</font> CDisplayContext(*<font class="keyword">this</font>);
00110 
00111    <a class="code" href="classCGLContext.html#a62">SetRendererContextChanged</a>(<font class="keyword">true</font>);
00112    <a class="code" href="classCGLContext.html#a64">SetGsContextChanged</a>(<font class="keyword">true</font>);
00113    <a class="code" href="classCGLContext.html#a66">SetRendererPropsChanged</a>(<font class="keyword">true</font>);
00114 
00115    <font class="comment">// util</font>
00116    NumBuffersToBeFreed[0] = NumBuffersToBeFreed[1] = 0;
00117 
00118    GS::Init();
00119 
00120 <font class="preprocessor">#ifndef PS2_LINUX</font>
00121    <font class="comment">// create a few semaphores</font>
00122 
00123    <font class="keyword">struct </font>SemaParam newSemaphore = { 0, 1, 0 }; <font class="comment">// but maxCount doesn't work?</font>
00124    VsyncSemaId = CreateSema( &amp;newSemaphore );
00125    RenderingFinishedSemaId = CreateSema( &amp;newSemaphore );
00126    ImmediateRenderingFinishedSemaId = CreateSema( &amp;newSemaphore );
00127    mErrorIf( VsyncSemaId == -1
00128              || RenderingFinishedSemaId == -1
00129              || ImmediateRenderingFinishedSemaId == -1,
00130              <font class="stringliteral">"Failed to create ps2gl semaphores."</font> );
00131    
00132 
00133    <font class="comment">// add an interrupt handler for gs "signal" exceptions</font>
00134 
00135    AddIntcHandler( INTC_GS, CGLContext::GsIntHandler, 0 <font class="comment">/*first handler*/</font> );
00136    EnableIntc( INTC_GS );
00137    <font class="comment">// clear any signal/vsync exceptions and wait for the next</font>
00138    *(<font class="keyword">volatile</font> <font class="keywordtype">unsigned</font> <font class="keywordtype">int</font>*)GS::ControlRegs::csr = 9;
00139    <font class="comment">// enable signal and vsync exceptions</font>
00140    *(<font class="keyword">volatile</font> <font class="keywordtype">unsigned</font> <font class="keywordtype">int</font>*)GS::ControlRegs::imr = 0x7600;
00141 <font class="preprocessor">#endif</font>
00142 }
00143 
<a name="l00144"></a><a class="code" href="classCGLContext.html#a1">00144</a> <a class="code" href="classCGLContext.html#a1">CGLContext::~CGLContext</a>()<font class="keyword"></font>
00145 {
00146    <font class="keyword">delete</font> CurPacket;
00147    <font class="keyword">delete</font> LastPacket;
00148 
00149    <font class="keyword">delete</font> ImmGManager;
00150    <font class="keyword">delete</font> DListGManager;
00151 
00152    <font class="keyword">delete</font> ProjectionMatStack;
00153    <font class="keyword">delete</font> ModelViewMatStack;
00154    <font class="keyword">delete</font> DListMatStack;
00155 
00156    <font class="keyword">delete</font> ImmLighting;
00157    <font class="keyword">delete</font> DListLighting;
00158 
00159    <font class="keyword">delete</font> MaterialManager;
00160    <font class="keyword">delete</font> DListManager;
00161    <font class="keyword">delete</font> TexManager;
00162 
00163    <font class="keyword">delete</font> ImmDrawContext;
00164    <font class="keyword">delete</font> DListDrawContext;
00165 
00166    <font class="keyword">delete</font> DisplayContext;
00167 }
00168 
00169 <font class="comment">/********************************************</font>
00170  * display lists
00171  */
00172 
00173 <font class="keywordtype">void</font>
<a name="l00174"></a><a class="code" href="classCGLContext.html#a20">00174</a> <a class="code" href="classCGLContext.html#a20">CGLContext::BeginDListDef</a>( <font class="keywordtype">unsigned</font> <font class="keywordtype">int</font> listID, <a class="code" href="gl_8h.html#a687">GLenum</a> mode )<font class="keyword"></font>
00175 {
00176    DListManager-&gt;<a class="code" href="classCDListManager.html#a5">NewList</a>( listID, mode );
00177 
00178    PushStateChanges();
00179 
00180    <font class="comment">// not so sure about these two, but let's be cautious</font>
00181    <a class="code" href="classCGLContext.html#a62">SetRendererContextChanged</a>(<font class="keyword">true</font>);
00182    <a class="code" href="classCGLContext.html#a64">SetGsContextChanged</a>(<font class="keyword">true</font>);
00183    <font class="comment">// definately need this to force an update - indexed/linear arrays</font>
00184    <a class="code" href="classCGLContext.html#a66">SetRendererPropsChanged</a>(<font class="keyword">true</font>);
00185 
00186    MaterialManager-&gt;<a class="code" href="classCMaterialManager.html#a10">BeginDListDef</a>();
00187    TexManager-&gt;<a class="code" href="classCTexManager.html#a15">BeginDListDef</a>();
00188    DListGManager-&gt;<a class="code" href="classCDListGeomManager.html#a6">BeginDListDef</a>();
00189 
00190    CurLighting = DListLighting;
00191    CurGManager = DListGManager;
00192    SavedCurMatStack = CurMatrixStack;
00193    CurMatrixStack = DListMatStack;
00194    CurDrawContext = DListDrawContext;
00195 }
00196 
00197 <font class="keywordtype">void</font>
<a name="l00198"></a><a class="code" href="classCGLContext.html#a21">00198</a> <a class="code" href="classCGLContext.html#a21">CGLContext::EndDListDef</a>()<font class="keyword"></font>
00199 {
00200    DListGManager-&gt;<a class="code" href="classCDListGeomManager.html#a7">EndDListDef</a>();
00201    MaterialManager-&gt;<a class="code" href="classCMaterialManager.html#a11">EndDListDef</a>();
00202    TexManager-&gt;<a class="code" href="classCTexManager.html#a16">EndDListDef</a>();
00203 
00204    CurLighting = ImmLighting;
00205    CurGManager = ImmGManager;
00206    CurMatrixStack = SavedCurMatStack;
00207    CurDrawContext = ImmDrawContext;
00208 
00209    PopStateChanges();
00210 
00211    DListManager-&gt;<a class="code" href="classCDListManager.html#a6">EndList</a>();
00212 }
00213 
00214 <font class="comment">/********************************************</font>
00215  * matrix mode
00216  */
00217 
<a name="l00218"></a><a class="code" href="classCSetMatrixModeCmd.html">00218</a> <font class="keyword">class </font><a class="code" href="classCSetMatrixModeCmd.html">CSetMatrixModeCmd</a> : <font class="keyword">public</font> <a class="code" href="classCDListCmd.html">CDListCmd</a> {
00219       <a class="code" href="gl_8h.html#a687">GLenum</a>    Mode;
00220    <font class="keyword">public</font>:
<a name="l00221"></a><a class="code" href="classCSetMatrixModeCmd.html#a0">00221</a>       <a class="code" href="classCSetMatrixModeCmd.html#a0">CSetMatrixModeCmd</a>( <a class="code" href="gl_8h.html#a687">GLenum</a> mode ) : Mode(mode) {}
<a name="l00222"></a><a class="code" href="classCSetMatrixModeCmd.html#a1">00222</a>       <a class="code" href="classCDListCmd.html">CDListCmd</a>* <a class="code" href="classCDListCmd.html#a1">Play</a>()<font class="keyword"> </font>{ <a class="code" href="gl_8h.html#a751">glMatrixMode</a>( Mode ); <font class="keywordflow">return</font> <a class="code" href="classCDListCmd.html#d1">CDListCmd::GetNextCmd</a>(<font class="keyword">this</font>); }
00223 };
00224 
00225 <font class="keywordtype">void</font>
<a name="l00226"></a><a class="code" href="classCGLContext.html#a2">00226</a> <a class="code" href="classCGLContext.html#a2">CGLContext::SetMatrixMode</a>( <a class="code" href="gl_8h.html#a687">GLenum</a> mode )<font class="keyword"></font>
00227 {
00228    <font class="keywordflow">if</font> ( <a class="code" href="classCGLContext.html#a19">InDListDef</a>() )<font class="keyword"> </font>{
00229       DListManager-&gt;<a class="code" href="classCDListManager.html#a8">GetOpenDList</a>() += CSetMatrixModeCmd(mode);
00230    }
00231    <font class="keywordflow">else</font> {
00232       <font class="keywordflow">switch</font> (mode) {
00233          <font class="keywordflow">case</font> <a class="code" href="gl_8h.html#a65">GL_MODELVIEW</a>:
00234             CurMatrixStack = ModelViewMatStack;
00235             <font class="keywordflow">break</font>;
00236          <font class="keywordflow">case</font> <a class="code" href="gl_8h.html#a66">GL_PROJECTION</a>:
00237             CurMatrixStack = ProjectionMatStack;
00238             <font class="keywordflow">break</font>;
00239          <font class="keywordflow">default</font>:
00240             <a class="code" href="debug_8h.html#a1">mNotImplemented</a>( );
00241       }
00242    }
00243 }
00244 
00245 <font class="comment">/********************************************</font>
00246  * immediate geometry
00247  */
00248 
00249 <font class="keywordtype">void</font>
<a name="l00250"></a><a class="code" href="classCGLContext.html#a22">00250</a> <a class="code" href="classCGLContext.html#a22">CGLContext::BeginImmediateGeometry</a>()<font class="keyword"></font>
00251 {
00252 <font class="comment">//     mErrorIf( InDListDef == true,</font>
00253 <font class="comment">//           "pglBeginImmediateGeom can't be called in a display list definition." );</font>
00254 
00255    <font class="comment">// flush any pending geometry</font>
00256    <a class="code" href="classCGLContext.html#a10">GetImmGeomManager</a>().Flush();
00257 
00258    <a class="code" href="classCGLContext.html#a67">PushVif1Packet</a>();
00259    <a class="code" href="classCGLContext.html#a69">SetVif1Packet</a>( *ImmVif1Packet );
00260 
00261    ImmVif1Packet-&gt;Reset();
00262 }
00263 
00264 <font class="keywordtype">void</font>
<a name="l00265"></a><a class="code" href="classCGLContext.html#a23">00265</a> <a class="code" href="classCGLContext.html#a23">CGLContext::EndImmediateGeometry</a>()<font class="keyword"></font>
00266 {
00267    mAssert( Vif1Packet == ImmVif1Packet );
00268 
00269    EndVif1Packet(2);
00270 
00271    <a class="code" href="classCGLContext.html#a68">PopVif1Packet</a>();
00272 }
00273 
00274 <font class="keywordtype">void</font>
<a name="l00275"></a><a class="code" href="classCGLContext.html#a24">00275</a> <a class="code" href="classCGLContext.html#a24">CGLContext::RenderImmediateGeometry</a>()<font class="keyword"></font>
00276 {
00277    ImmVif1Packet-&gt;End();
00278    ImmVif1Packet-&gt;Pad128();
00279    ImmVif1Packet-&gt;CloseTag();
00280 
00281    ImmVif1Packet-&gt;Send();
00282 }
00283 
00284 <font class="keywordtype">void</font>
<a name="l00285"></a><a class="code" href="classCGLContext.html#a25">00285</a> <a class="code" href="classCGLContext.html#a25">CGLContext::FinishRenderingImmediateGeometry</a>( <font class="keywordtype">bool</font> forceImmediateStop )<font class="keyword"></font>
00286 {
00287    mWarnIf( forceImmediateStop, <font class="stringliteral">"Interrupting currently rendering dma chain not supported yet"</font> );
00288    <a class="code" href="debug_8h.html#a1">mNotImplemented</a>( );
00289 }
00290 
00291 <font class="comment">/********************************************</font>
00292  * normal geometry
00293  */
00294 
00295 <font class="keywordtype">void</font>
<a name="l00296"></a><a class="code" href="classCGLContext.html#a26">00296</a> <a class="code" href="classCGLContext.html#a26">CGLContext::BeginGeometry</a>()<font class="keyword"></font>
00297 {
00298    <font class="comment">// reset packets that will be drawn to during this frame</font>
00299 
00300    CurPacket-&gt;Reset();
00301 }
00302 
00303 <font class="keywordtype">void</font>
<a name="l00304"></a><a class="code" href="classCGLContext.html#a27">00304</a> <a class="code" href="classCGLContext.html#a27">CGLContext::EndGeometry</a>()<font class="keyword"></font>
00305 {
00306    EndVif1Packet(1);
00307 }
00308 
00309 <font class="keywordtype">void</font>
00310 CGLContext::EndVif1Packet( <font class="keywordtype">unsigned</font> <font class="keywordtype">short</font> signalNum )<font class="keyword"></font>
00311 {
00312    <font class="comment">// flush any pending geometry</font>
00313    <a class="code" href="classCGLContext.html#a10">GetImmGeomManager</a>().Flush();
00314 
00315    <font class="comment">// end current packet</font>
00316    <font class="comment">// write our id to the signal register and trigger an</font>
00317    <font class="comment">// exception on the core when this dma chain reaches the end</font>
00318 
00319 <font class="preprocessor">#ifndef PS2_LINUX</font>
00320    tGifTag giftag;
00321    giftag.NLOOP = 1;
00322    giftag.EOP = 1;
00323    giftag.PRE = 0;
00324    giftag.FLG = 0; <font class="comment">// packed</font>
00325    giftag.NREG = 1;
00326    giftag.REGS0 = 0xe; <font class="comment">// a+d</font>
00327    
00328    Vif1Packet-&gt;End();
00329    Vif1Packet-&gt;Flush();
00330    Vif1Packet-&gt;OpenDirect();
00331    {
00332       *Vif1Packet += giftag;
00333       *Vif1Packet += Ps2glSignalId | signalNum;
00334       *Vif1Packet += (tU64)0x60; <font class="comment">// signal</font>
00335    }
00336    Vif1Packet-&gt;CloseDirect();
00337    Vif1Packet-&gt;CloseTag();
00338 <font class="preprocessor">#else</font>
00339    Vif1Packet-&gt;End();
00340    Vif1Packet-&gt;Nop().Nop();
00341    Vif1Packet-&gt;CloseTag();
00342 <font class="preprocessor">#endif</font>
00343 }
00344 
00345 <font class="keywordtype">void</font>
<a name="l00346"></a><a class="code" href="classCGLContext.html#a28">00346</a> <a class="code" href="classCGLContext.html#a28">CGLContext::RenderGeometry</a>()<font class="keyword"></font>
00347 {
00348 <font class="preprocessor">#ifndef PS2_LINUX</font>
00349    <font class="comment">// make sure the semaphore we'll signal on completion is zero now</font>
00350    <font class="keywordflow">while</font> ( PollSema(RenderingFinishedSemaId) != -1 );
00351 <font class="preprocessor">#endif</font>
00352 
00353    LastPacket-&gt;Send();
00354 }
00355 
00356 <font class="keywordtype">int</font>
00357 CGLContext::GsIntHandler( <font class="keywordtype">int</font> cause )<font class="keyword"></font>
00358 {
00359    <font class="keywordtype">int</font> ret = 0;
00360 
00361 <font class="preprocessor">#ifndef PS2_LINUX</font>
00362    tU32 csr = *(<font class="keyword">volatile</font> tU32*)GS::ControlRegs::csr;
00363    <font class="comment">// is this a signal interrupt?</font>
00364    <font class="keywordflow">if</font> ( csr &amp; 1 ) {
00365       <font class="comment">// is it one of ours?</font>
00366       tU64 sigLblId = *(<font class="keyword">volatile</font> tU64*)GS::ControlRegs::siglblid;
00367       <font class="keywordflow">if</font> ( (tU16)(sigLblId &gt;&gt; 16) == <a class="code" href="classCGLContext.html#d0">GetPs2glSignalId</a>() )<font class="keyword"> </font>{
00368          <font class="keywordflow">switch</font> ( sigLblId &amp; 0xffff ) {
00369             <font class="keywordflow">case</font> 1:
00370                iSignalSema( RenderingFinishedSemaId );
00371                <font class="keywordflow">if</font> ( RenderingFinishedCallback != NULL )
00372                   RenderingFinishedCallback();
00373                <font class="keywordflow">break</font>;
00374             <font class="keywordflow">case</font> 2:
00375                iSignalSema( ImmediateRenderingFinishedSemaId );
00376                <font class="keywordflow">break</font>;
00377             <font class="keywordflow">default</font>:
00378                mError( <font class="stringliteral">"Unknown signal"</font> );
00379          }
00380 
00381          <font class="comment">// clear our signal id</font>
00382          sigLblId &amp;= ~0xffffffff;
00383          *(<font class="keyword">volatile</font> tU64*)GS::ControlRegs::siglblid = sigLblId;
00384          <font class="comment">// clear the exception and wait for the next</font>
00385          *(<font class="keyword">volatile</font> <font class="keywordtype">unsigned</font> <font class="keywordtype">int</font>*)GS::ControlRegs::csr = 1;
00386 
00387          ret = -1; <font class="comment">// don't call other handlers</font>
00388       }
00389    }
00390    <font class="comment">// is this a vsync interrupt?</font>
00391    <font class="keywordflow">else</font> <font class="keywordflow">if</font> ( csr &amp; 8 ) {
00392       iSignalSema( VsyncSemaId );
00393       <font class="comment">// clear the exception and wait for the next</font>
00394       *(<font class="keyword">volatile</font> <font class="keywordtype">unsigned</font> <font class="keywordtype">int</font>*)GS::ControlRegs::csr = 8;
00395    }
00396    
00397    <font class="comment">// I'm not entirely sure why this is necessary, but if I don't do</font>
00398    <font class="comment">// it then framing out can cause the display thread to lock (I've</font>
00399    <font class="comment">// only verified it frozen waiting on pglFinishRenderingGeometry().)</font>
00400    <font class="comment">// The GS manual says that a second "signal" event occuring before</font>
00401    <font class="comment">// the first is cleared causes the gs to stop drawing, and the second</font>
00402    <font class="comment">// interrupt will not be raised until that interrupt (signal) is masked</font>
00403    <font class="comment">// and then unmasked.  Could something similar be true for gs events/</font>
00404    <font class="comment">// interrupts in general?  This needs to be here, not in the vsync branch.</font>
00405    <font class="keywordflow">if</font> ( ret == -1 ) {
00406       *(<font class="keyword">volatile</font> <font class="keywordtype">unsigned</font> <font class="keywordtype">int</font>*)GS::ControlRegs::imr = 0x7f00;
00407       *(<font class="keyword">volatile</font> <font class="keywordtype">unsigned</font> <font class="keywordtype">int</font>*)GS::ControlRegs::imr = 0x7600;
00408    }
00409 <font class="preprocessor">#endif</font>
00410 
00411    <font class="keywordflow">return</font> ret;
00412 }
00413 
00414 <font class="keywordtype">void</font>
<a name="l00415"></a><a class="code" href="classCGLContext.html#a29">00415</a> <a class="code" href="classCGLContext.html#a29">CGLContext::FinishRenderingGeometry</a>( <font class="keywordtype">bool</font> forceImmediateStop )<font class="keyword"></font>
00416 {
00417 <font class="preprocessor">#ifndef PS2_LINUX</font>
00418    mWarnIf( forceImmediateStop, <font class="stringliteral">"Interrupting currently rendering dma chain not supported yet"</font> );
00419    WaitSema( RenderingFinishedSemaId );
00420 <font class="preprocessor">#else</font>
00421    <a class="code" href="group__pgl__api.html#a6">pglWaitForVU1</a>();
00422 <font class="preprocessor">#endif</font>
00423 }
00424 
00425 <font class="keywordtype">void</font>
<a name="l00426"></a><a class="code" href="classCGLContext.html#a71">00426</a> <a class="code" href="classCGLContext.html#a71">CGLContext::WaitForVSync</a>()<font class="keyword"></font>
00427 {
00428    <font class="comment">// wait for beginning of v-sync </font>
00429 <font class="preprocessor">#ifndef PS2_LINUX</font>
00430    WaitSema( VsyncSemaId );
00431    <font class="comment">// sometimes if we miss a frame the semaphore gets incremented</font>
00432    <font class="comment">// more than once (because maxCount is ignored?) which causes the next</font>
00433    <font class="comment">// call to WaitForVSync to fall through immediately, which is kinda bad,</font>
00434    <font class="comment">// so make sure the count is zero after waiting.</font>
00435    <font class="keywordflow">while</font> ( PollSema(VsyncSemaId) != -1 );
00436    <font class="comment">// sceGsSyncV(0);</font>
00437    tU32 csr = *(<font class="keyword">volatile</font> tU32*)GS::ControlRegs::csr;
00438    IsCurrentFieldEven = (bool)((csr &gt;&gt; 13) &amp; 1);
00439 <font class="preprocessor">#else</font>
00440    IsCurrentFieldEven = Math::IsEven(ps2_gs_sync_v(0));
00441 <font class="preprocessor">#endif</font>
00442 }
00443 
00444 <font class="keywordtype">void</font>
<a name="l00445"></a><a class="code" href="classCGLContext.html#a72">00445</a> <a class="code" href="classCGLContext.html#a72">CGLContext::SwapBuffers</a>()<font class="keyword"></font>
00446 {
00447    <font class="comment">// switch packet ptrs</font>
00448 
00449    CVifSCDmaPacket *tempPkt = CurPacket;
00450    CurPacket = LastPacket;
00451    LastPacket = tempPkt;
00452    Vif1Packet = CurPacket;
00453 
00454    <font class="comment">// switch drawenv ptrs</font>
00455 
00456    <font class="keywordtype">void</font> **tempDEPtrs = CurDrawEnvPtrs;
00457    CurDrawEnvPtrs = LastDrawEnvPtrs;
00458    LastDrawEnvPtrs = tempDEPtrs;
00459    NumLastDrawEnvPtrs = NumCurDrawEnvPtrs;
00460    NumCurDrawEnvPtrs = 0;
00461 
00462    <font class="comment">// tell some modules that it's time to flip</font>
00463 
00464    <a class="code" href="classCGLContext.html#a10">GetImmGeomManager</a>().<a class="code" href="classCGLContext.html#a72">SwapBuffers</a>();
00465    <a class="code" href="classCGLContext.html#a13">GetDListManager</a>().<a class="code" href="classCGLContext.html#a72">SwapBuffers</a>();
00466    <a class="code" href="classCGLContext.html#a18">GetDisplayContext</a>().<a class="code" href="classCGLContext.html#a72">SwapBuffers</a>();
00467    <a class="code" href="classCGLContext.html#a16">GetImmDrawContext</a>().<a class="code" href="classCGLContext.html#a72">SwapBuffers</a>( IsCurrentFieldEven );
00468 
00469    <font class="comment">// free memory that was waiting til end of frame</font>
00470    FreeWaitingBuffersAndSwap();
00471 
00472    CurrentFrameNumber++;
00473 }
00474 
00475 <font class="keywordtype">void</font>
00476 CGLContext::FreeWaitingBuffersAndSwap()<font class="keyword"></font>
00477 {
00478    CurBuffer = 1 - CurBuffer;
00479 
00480    <font class="keywordflow">for</font> ( <font class="keywordtype">int</font> i = 0; i &lt; NumBuffersToBeFreed[CurBuffer]; i++ ) {
00481 <font class="preprocessor">#ifndef PS2_LINUX</font>
00482       free( BuffersToBeFreed[CurBuffer][i] );
00483 <font class="preprocessor">#else</font>
00484       munmap(BuffersToBeFreed[CurBuffer][i], 1);
00485 <font class="preprocessor">#endif</font>
00486    }
00487 
00488    NumBuffersToBeFreed[CurBuffer] = 0;
00489 }
00490 
00491 <font class="comment">/********************************************</font>
00492  * ps2gl C interface
00493  */
00494 
<a name="l00496"></a><a class="code" href="glcontext_8cpp.html#a0">00496</a> <a class="code" href="classCGLContext.html">CGLContext</a> *pGLContext = NULL;
00497 
00522 <font class="keywordtype">int</font>
<a name="l00523"></a><a class="code" href="glcontext_8cpp.html#a13">00523</a> <a class="code" href="ps2gl_8h.html#a13">pglInit</a>( <font class="keywordtype">int</font> immBufferVertexSize, <font class="keywordtype">int</font> immDrawBufferQwordSize )<font class="keyword"></font>
00524 {
00525    ps2sInit();
00526    pGLContext = <font class="keyword">new</font> CGLContext(immBufferVertexSize, immDrawBufferQwordSize);
00527 
00528    <font class="keywordflow">return</font> <font class="keyword">true</font>;
00529 }
00530 
00535 <font class="keywordtype">int</font>
<a name="l00536"></a><a class="code" href="glcontext_8cpp.html#a14">00536</a> <a class="code" href="group__pgl__api.html#a4">pglHasLibraryBeenInitted</a>(<font class="keywordtype">void</font>)<font class="keyword"></font>
00537 {
00538    <font class="keywordflow">return</font> (pGLContext != NULL);
00539 }
00540 
00544 <font class="keywordtype">void</font>
<a name="l00545"></a><a class="code" href="glcontext_8cpp.html#a15">00545</a> <a class="code" href="group__pgl__api.html#a5">pglFinish</a>( <font class="keywordtype">void</font> )<font class="keyword"></font>
00546 {
00547    <font class="keywordflow">if</font> (pGLContext) <font class="keyword">delete</font> pGLContext;
00548    ps2sFinish();
00549 }
00550 
00551 <font class="preprocessor">#ifdef PS2_LINUX</font>
00552 <font class="comment">// this will have been defined by glut or the application when opening the</font>
00553 <font class="comment">// ps2stuff device</font>
00554 <font class="keyword">extern</font> <font class="keywordtype">int</font> <a class="code" href="linux__glut_8cpp.html#a0">Ps2stuffDeviceFd</a>;
00555 <font class="preprocessor">#endif</font>
00556 
00564 <font class="keywordtype">void</font>
<a name="l00565"></a><a class="code" href="glcontext_8cpp.html#a16">00565</a> <a class="code" href="group__pgl__api.html#a6">pglWaitForVU1</a>( <font class="keywordtype">void</font> )<font class="keyword"></font>
00566 {
00567 <font class="preprocessor">#ifndef PS2_LINUX</font>
00568    <font class="comment">// enable output to cop0 condition flag for vif1 channel</font>
00569    *D_PCR = 0x2;
00570    <font class="comment">// clear the vif1 cis</font>
00571    *D_STAT = 2;
00572 
00573    <font class="keyword">asm</font> <font class="keyword">volatile</font> (<font class="stringliteral">"sync.l"</font>);
00574    <font class="comment">// if vif1 is still transferring</font>
00575    <font class="keywordflow">if</font> ( *D1_CHCR &amp; 0x100 ) {
00576 
00577       <font class="keyword">asm</font> <font class="keyword">volatile</font> (
00578          <font class="stringliteral">".set  noreorder \n"</font>
00579 
00580          <font class="stringliteral">"0:            \n"</font>
00581 
00582          <font class="stringliteral">"nop           \n"</font>
00583          <font class="stringliteral">"nop           \n"</font>
00584 
00585          <font class="stringliteral">"nop           \n"</font>
00586          <font class="stringliteral">"nop           \n"</font>
00587 
00588          <font class="stringliteral">"nop           \n"</font>
00589          <font class="stringliteral">"nop           \n"</font>
00590 
00591          <font class="stringliteral">"nop           \n"</font>
00592          <font class="stringliteral">"nop           \n"</font>
00593 
00594          <font class="stringliteral">"bc0f  0b      \n"</font>
00595          <font class="stringliteral">"nop           \n"</font>
00596 
00597          <font class="stringliteral">".set  reorder \n"</font>
00598          );
00599    }
00600 <font class="preprocessor">#else</font>
00601    ioctl( <a class="code" href="linux__glut_8cpp.html#a0">Ps2stuffDeviceFd</a>, PS2STUFF_IOCTV1DMAW, 0 );
00602 <font class="preprocessor">#endif</font>
00603 }
00604 
00609 <font class="keywordtype">void</font>
<a name="l00610"></a><a class="code" href="glcontext_8cpp.html#a17">00610</a> <a class="code" href="group__pgl__api.html#a7">pglWaitForVSync</a>( <font class="keywordtype">void</font> )<font class="keyword"></font>
00611 {
00612    pGLContext-&gt;<a class="code" href="classCGLContext.html#a71">WaitForVSync</a>();
00613 }
00614 
00621 <font class="keywordtype">void</font>
<a name="l00622"></a><a class="code" href="glcontext_8cpp.html#a18">00622</a> <a class="code" href="group__pgl__api.html#a8">pglSwapBuffers</a>( <font class="keywordtype">void</font> )<font class="keyword"></font>
00623 {
00624    mErrorIf( pGLContext == NULL, <font class="stringliteral">"You need to call pglInit()"</font> );
00625 
00626    pGLContext-&gt;<a class="code" href="classCGLContext.html#a72">SwapBuffers</a>();
00627 }
00628 
00634 <font class="keywordtype">void</font>
<a name="l00635"></a><a class="code" href="glcontext_8cpp.html#a51">00635</a> <a class="code" href="ps2gl_8h.html#a51">pglSetRenderingFinishedCallback</a>( <font class="keywordtype">void</font> (*cb)(<font class="keywordtype">void</font>) )<font class="keyword"></font>
00636 {
00637    pGLContext-&gt;<a class="code" href="classCGLContext.html#d1">SetRenderingFinishedCallback</a>(cb);
00638 }
00639 
00640 <font class="comment">/********************************************</font>
00641  * immediate geometry
00642  */
00643 
00644 <font class="keywordtype">void</font>
<a name="l00645"></a><a class="code" href="glcontext_8cpp.html#a43">00645</a> <a class="code" href="group__pgl__api.html#a10">pglBeginImmediateGeometry</a>( <font class="keywordtype">void</font> )<font class="keyword"></font>
00646 {
00647    pGLContext-&gt;<a class="code" href="classCGLContext.html#a22">BeginImmediateGeometry</a>();
00648 }
00649 <font class="keywordtype">void</font>
<a name="l00650"></a><a class="code" href="glcontext_8cpp.html#a44">00650</a> <a class="code" href="group__pgl__api.html#a11">pglEndImmediateGeometry</a>( <font class="keywordtype">void</font> )<font class="keyword"></font>
00651 {
00652    pGLContext-&gt;<a class="code" href="classCGLContext.html#a23">EndImmediateGeometry</a>();
00653 }
00654 <font class="keywordtype">void</font>
<a name="l00655"></a><a class="code" href="glcontext_8cpp.html#a45">00655</a> <a class="code" href="group__pgl__api.html#a12">pglRenderImmediateGeometry</a>( <font class="keywordtype">void</font> )<font class="keyword"></font>
00656 {
00657    pGLContext-&gt;<a class="code" href="classCGLContext.html#a24">RenderImmediateGeometry</a>();
00658 }
00659 <font class="keywordtype">void</font>
<a name="l00660"></a><a class="code" href="glcontext_8cpp.html#a46">00660</a> <a class="code" href="ps2gl_8h.html#a46">pglFinishRenderingImmediateGeometry</a>( <font class="keywordtype">int</font> forceImmediateStop )<font class="keyword"></font>
00661 {
00662    pGLContext-&gt;<a class="code" href="classCGLContext.html#a25">FinishRenderingImmediateGeometry</a>( (<font class="keywordtype">bool</font>)forceImmediateStop );
00663 }
00664 
00665 <font class="comment">/********************************************</font>
00666  * normal geometry
00667  */
00668 
00669 <font class="keywordtype">void</font>
<a name="l00670"></a><a class="code" href="glcontext_8cpp.html#a47">00670</a> <a class="code" href="group__pgl__api.html#a14">pglBeginGeometry</a>( <font class="keywordtype">void</font> )<font class="keyword"></font>
00671 {
00672    pGLContext-&gt;<a class="code" href="classCGLContext.html#a26">BeginGeometry</a>();
00673 }
00674 <font class="keywordtype">void</font>
<a name="l00675"></a><a class="code" href="glcontext_8cpp.html#a48">00675</a> <a class="code" href="group__pgl__api.html#a15">pglEndGeometry</a>( <font class="keywordtype">void</font> )<font class="keyword"></font>
00676 {
00677    pGLContext-&gt;<a class="code" href="classCGLContext.html#a27">EndGeometry</a>();
00678 }
00679 <font class="keywordtype">void</font>
<a name="l00680"></a><a class="code" href="glcontext_8cpp.html#a49">00680</a> <a class="code" href="group__pgl__api.html#a16">pglRenderGeometry</a>( <font class="keywordtype">void</font> )<font class="keyword"></font>
00681 {
00682    pGLContext-&gt;<a class="code" href="classCGLContext.html#a28">RenderGeometry</a>();
00683 }
00684 <font class="keywordtype">void</font>
<a name="l00685"></a><a class="code" href="glcontext_8cpp.html#a50">00685</a> <a class="code" href="ps2gl_8h.html#a50">pglFinishRenderingGeometry</a>( <font class="keywordtype">int</font> forceImmediateStop )<font class="keyword"></font>
00686 {
00687    pGLContext-&gt;<a class="code" href="classCGLContext.html#a29">FinishRenderingGeometry</a>( (<font class="keywordtype">bool</font>)forceImmediateStop );
00688 }
00689 
00690 <font class="comment">/********************************************</font>
00691  * enable / disable
00692  */
00693 
00694 <font class="keywordtype">void</font>
<a name="l00695"></a><a class="code" href="glcontext_8cpp.html#a52">00695</a> <a class="code" href="ps2gl_8h.html#a52">pglEnable</a>( <a class="code" href="gl_8h.html#a687">GLenum</a> cap )<font class="keyword"></font>
00696 {
00697    <font class="keywordflow">switch</font> (cap) {
00698       <font class="keywordflow">case</font> <a class="code" href="ps2gl_8h.html#a0">PGL_CLIPPING</a>:
00699          pGLContext-&gt;<a class="code" href="classCGLContext.html#a15">GetDrawContext</a>().<a class="code" href="classCDrawContext.html#a2">SetDoClipping</a>(<font class="keyword">true</font>);
00700          <font class="keywordflow">break</font>;
00701       <font class="keywordflow">default</font>:
00702          mError( <font class="stringliteral">"Unknown option passed to pglEnable()"</font> );
00703    }
00704 }
00705 
00706 <font class="keywordtype">void</font>
<a name="l00707"></a><a class="code" href="glcontext_8cpp.html#a53">00707</a> <a class="code" href="ps2gl_8h.html#a53">pglDisable</a>( <a class="code" href="gl_8h.html#a687">GLenum</a> cap )<font class="keyword"></font>
00708 {
00709    <font class="keywordflow">switch</font> (cap) {
00710       <font class="keywordflow">case</font> <a class="code" href="ps2gl_8h.html#a0">PGL_CLIPPING</a>:
00711          pGLContext-&gt;<a class="code" href="classCGLContext.html#a15">GetDrawContext</a>().<a class="code" href="classCDrawContext.html#a2">SetDoClipping</a>(<font class="keyword">false</font>);
00712          <font class="keywordflow">break</font>;
00713       <font class="keywordflow">default</font>:
00714          mError( <font class="stringliteral">"Unknown option passed to pglDisable()"</font> );
00715    }
00716 }
00717 
00722 <font class="comment">/********************************************</font>
00723  * gl interface
00724  */
00725 
<a name="l00726"></a><a class="code" href="glcontext_8cpp.html#a726">00726</a> <font class="keywordtype">void</font> <a class="code" href="gl_8h.html#a726">glEnable</a>( <a class="code" href="gl_8h.html#a687">GLenum</a> cap )<font class="keyword"></font>
00727 {
00728    <a class="code" href="classCLighting.html">CLighting</a>&amp; lighting = pGLContext-&gt;<a class="code" href="classCGLContext.html#a6">GetLighting</a>();
00729    
00730    <font class="keywordflow">switch</font> (cap) {
00731       <font class="keywordflow">case</font> <a class="code" href="gl_8h.html#a119">GL_LIGHT0</a>:
00732       <font class="keywordflow">case</font> <a class="code" href="gl_8h.html#a120">GL_LIGHT1</a>:
00733       <font class="keywordflow">case</font> <a class="code" href="gl_8h.html#a121">GL_LIGHT2</a>:
00734       <font class="keywordflow">case</font> <a class="code" href="gl_8h.html#a122">GL_LIGHT3</a>:
00735       <font class="keywordflow">case</font> <a class="code" href="gl_8h.html#a123">GL_LIGHT4</a>:
00736       <font class="keywordflow">case</font> <a class="code" href="gl_8h.html#a124">GL_LIGHT5</a>:
00737       <font class="keywordflow">case</font> <a class="code" href="gl_8h.html#a125">GL_LIGHT6</a>:
00738       <font class="keywordflow">case</font> <a class="code" href="gl_8h.html#a126">GL_LIGHT7</a>:
00739          lighting.<a class="code" href="classCLighting.html#a1">GetLight</a>(0x7 &amp; cap).<a class="code" href="classCLight.html#a12">SetEnabled</a>(<font class="keyword">true</font>);
00740          <font class="keywordflow">break</font>;
00741       <font class="keywordflow">case</font> <a class="code" href="gl_8h.html#a118">GL_LIGHTING</a>:
00742          lighting.<a class="code" href="classCLighting.html#a2">SetLightingEnabled</a>(<font class="keyword">true</font>);
00743          <font class="keywordflow">break</font>;
00744 
00745       <font class="keywordflow">case</font> <a class="code" href="gl_8h.html#a171">GL_BLEND</a>:
00746          pGLContext-&gt;<a class="code" href="classCGLContext.html#a15">GetDrawContext</a>().<a class="code" href="classCDrawContext.html#a6">SetBlendEnabled</a>(<font class="keyword">true</font>);
00747          <font class="keywordflow">break</font>;
00748 
00749       <font class="keywordflow">case</font> <a class="code" href="gl_8h.html#a148">GL_COLOR_MATERIAL</a>:
00750          pGLContext-&gt;<a class="code" href="classCGLContext.html#a12">GetMaterialManager</a>().<a class="code" href="classCMaterialManager.html#a8">SetUseColorMaterial</a>(<font class="keyword">true</font>);
00751          <font class="keywordflow">break</font>;
00752       <font class="keywordflow">case</font> <a class="code" href="gl_8h.html#a519">GL_RESCALE_NORMAL</a>:
00753          pGLContext-&gt;<a class="code" href="classCGLContext.html#a15">GetDrawContext</a>().<a class="code" href="classCDrawContext.html#a5">SetRescaleNormals</a>(<font class="keyword">true</font>);
00754          <font class="keywordflow">break</font>;
00755 
00756       <font class="keywordflow">case</font> <a class="code" href="gl_8h.html#a418">GL_TEXTURE_2D</a>:
00757          pGLContext-&gt;<a class="code" href="classCGLContext.html#a14">GetTexManager</a>().<a class="code" href="classCTexManager.html#a2">SetTexEnabled</a>(<font class="keyword">true</font>);
00758          <font class="keywordflow">break</font>;
00759 
00760       <font class="keywordflow">case</font> <a class="code" href="gl_8h.html#a151">GL_NORMALIZE</a>:
00761          pGLContext-&gt;<a class="code" href="classCGLContext.html#a9">GetGeomManager</a>().<a class="code" href="classCGeomManager.html#a6">SetDoNormalize</a>(<font class="keyword">true</font>);
00762          <font class="keywordflow">break</font>;
00763 
00764       <font class="keywordflow">case</font> <a class="code" href="gl_8h.html#a90">GL_CULL_FACE</a>:
00765          pGLContext-&gt;<a class="code" href="classCGLContext.html#a15">GetDrawContext</a>().<a class="code" href="classCDrawContext.html#a3">SetDoCullFace</a>(<font class="keyword">true</font>);
00766          <font class="keywordflow">break</font>;
00767 
00768       <font class="keywordflow">case</font> <a class="code" href="gl_8h.html#a168">GL_ALPHA_TEST</a>:
00769          pGLContext-&gt;<a class="code" href="classCGLContext.html#a15">GetDrawContext</a>().<a class="code" href="classCDrawContext.html#a9">SetAlphaTestEnabled</a>(<font class="keyword">true</font>);
00770          <font class="keywordflow">break</font>;
00771           
00772       <font class="keywordflow">case</font> <a class="code" href="gl_8h.html#a111">GL_DEPTH_TEST</a>:
00773       <font class="keywordflow">default</font>:
00774          <a class="code" href="debug_8h.html#a1">mNotImplemented</a>( );
00775          <font class="keywordflow">break</font>;
00776    }
00777 }
00778 
<a name="l00779"></a><a class="code" href="glcontext_8cpp.html#a727">00779</a> <font class="keywordtype">void</font> <a class="code" href="gl_8h.html#a727">glDisable</a>( <a class="code" href="gl_8h.html#a687">GLenum</a> cap )<font class="keyword"></font>
00780 {
00781    <font class="keywordflow">switch</font> (cap) {
00782       <font class="keywordflow">case</font> <a class="code" href="gl_8h.html#a119">GL_LIGHT0</a>:
00783       <font class="keywordflow">case</font> <a class="code" href="gl_8h.html#a120">GL_LIGHT1</a>:
00784       <font class="keywordflow">case</font> <a class="code" href="gl_8h.html#a121">GL_LIGHT2</a>:
00785       <font class="keywordflow">case</font> <a class="code" href="gl_8h.html#a122">GL_LIGHT3</a>:
00786       <font class="keywordflow">case</font> <a class="code" href="gl_8h.html#a123">GL_LIGHT4</a>:
00787       <font class="keywordflow">case</font> <a class="code" href="gl_8h.html#a124">GL_LIGHT5</a>:
00788       <font class="keywordflow">case</font> <a class="code" href="gl_8h.html#a125">GL_LIGHT6</a>:
00789       <font class="keywordflow">case</font> <a class="code" href="gl_8h.html#a126">GL_LIGHT7</a>:
00790          pGLContext-&gt;<a class="code" href="classCGLContext.html#a6">GetLighting</a>().<a class="code" href="classCLighting.html#a1">GetLight</a>(0x7 &amp; cap).SetEnabled(<font class="keyword">false</font>);
00791          <font class="keywordflow">break</font>;
00792       <font class="keywordflow">case</font> <a class="code" href="gl_8h.html#a118">GL_LIGHTING</a>:
00793          pGLContext-&gt;<a class="code" href="classCGLContext.html#a6">GetLighting</a>().<a class="code" href="classCLighting.html#a2">SetLightingEnabled</a>(<font class="keyword">false</font>);
00794          <font class="keywordflow">break</font>;
00795 
00796       <font class="keywordflow">case</font> <a class="code" href="gl_8h.html#a171">GL_BLEND</a>:
00797          pGLContext-&gt;<a class="code" href="classCGLContext.html#a15">GetDrawContext</a>().<a class="code" href="classCDrawContext.html#a6">SetBlendEnabled</a>(<font class="keyword">false</font>);
00798          <font class="keywordflow">break</font>;
00799 
00800       <font class="keywordflow">case</font> <a class="code" href="gl_8h.html#a148">GL_COLOR_MATERIAL</a>:
00801          pGLContext-&gt;<a class="code" href="classCGLContext.html#a12">GetMaterialManager</a>().<a class="code" href="classCMaterialManager.html#a8">SetUseColorMaterial</a>(<font class="keyword">false</font>);
00802          <font class="keywordflow">break</font>;
00803       <font class="keywordflow">case</font> <a class="code" href="gl_8h.html#a519">GL_RESCALE_NORMAL</a>:
00804          pGLContext-&gt;<a class="code" href="classCGLContext.html#a15">GetDrawContext</a>().<a class="code" href="classCDrawContext.html#a5">SetRescaleNormals</a>(<font class="keyword">false</font>);
00805          <font class="keywordflow">break</font>;
00806 
00807       <font class="keywordflow">case</font> <a class="code" href="gl_8h.html#a418">GL_TEXTURE_2D</a>:
00808          pGLContext-&gt;<a class="code" href="classCGLContext.html#a14">GetTexManager</a>().<a class="code" href="classCTexManager.html#a2">SetTexEnabled</a>(<font class="keyword">false</font>);
00809          <font class="keywordflow">break</font>;
00810 
00811       <font class="keywordflow">case</font> <a class="code" href="gl_8h.html#a151">GL_NORMALIZE</a>:
00812          pGLContext-&gt;<a class="code" href="classCGLContext.html#a9">GetGeomManager</a>().<a class="code" href="classCGeomManager.html#a6">SetDoNormalize</a>(<font class="keyword">false</font>);
00813          <font class="keywordflow">break</font>;
00814 
00815       <font class="keywordflow">case</font> <a class="code" href="gl_8h.html#a90">GL_CULL_FACE</a>:
00816          pGLContext-&gt;<a class="code" href="classCGLContext.html#a15">GetDrawContext</a>().<a class="code" href="classCDrawContext.html#a3">SetDoCullFace</a>(<font class="keyword">false</font>);
00817          <font class="keywordflow">break</font>;
00818 
00819       <font class="keywordflow">case</font> <a class="code" href="gl_8h.html#a168">GL_ALPHA_TEST</a>:
00820          pGLContext-&gt;<a class="code" href="classCGLContext.html#a15">GetDrawContext</a>().<a class="code" href="classCDrawContext.html#a9">SetAlphaTestEnabled</a>(<font class="keyword">false</font>);
00821          <font class="keywordflow">break</font>;
00822           
00823       <font class="keywordflow">case</font> <a class="code" href="gl_8h.html#a111">GL_DEPTH_TEST</a>:
00824       <font class="keywordflow">default</font>:
00825          <a class="code" href="debug_8h.html#a1">mNotImplemented</a>( );
00826    }
00827 }
00828 
<a name="l00829"></a><a class="code" href="glcontext_8cpp.html#a744">00829</a> <font class="keywordtype">void</font> <a class="code" href="gl_8h.html#a744">glHint</a>( <a class="code" href="gl_8h.html#a687">GLenum</a> target, <a class="code" href="gl_8h.html#a687">GLenum</a> mode )<font class="keyword"></font>
00830 {
00831    <a class="code" href="debug_8h.html#a1">mNotImplemented</a>( );
00832 }
00833 
<a name="l00834"></a><a class="code" href="glcontext_8cpp.html#a733">00834</a> <font class="keywordtype">void</font> <a class="code" href="gl_8h.html#a733">glGetFloatv</a>( <a class="code" href="gl_8h.html#a687">GLenum</a> pname, <a class="code" href="gl_8h.html#a698">GLfloat</a> *params )<font class="keyword"></font>
00835 {
00836    <font class="keywordflow">switch</font> (pname) {
00837       <font class="keywordflow">case</font> <a class="code" href="gl_8h.html#a321">GL_MODELVIEW_MATRIX</a>:
00838          memcpy( params, &amp; (pGLContext-&gt;<a class="code" href="classCGLContext.html#a4">GetModelViewStack</a>().<a class="code" href="classCImmMatrixStack.html#a5">GetTop</a>()), 16 * 4 );
00839          <font class="keywordflow">break</font>;
00840       <font class="keywordflow">case</font> <a class="code" href="gl_8h.html#a324">GL_PROJECTION_MATRIX</a>:
00841          memcpy( params, &amp; (pGLContext-&gt;<a class="code" href="classCGLContext.html#a5">GetProjectionStack</a>().<a class="code" href="classCImmMatrixStack.html#a5">GetTop</a>()), 16 * 4 );
00842          <font class="keywordflow">break</font>;
00843       <font class="keywordflow">default</font>:
00844          <a class="code" href="debug_8h.html#a1">mNotImplemented</a>( <font class="stringliteral">"pname %d"</font>, pname );
00845          <font class="keywordflow">break</font>;
00846    }
00847 }
00848 
<a name="l00849"></a><a class="code" href="glcontext_8cpp.html#a22">00849</a> <font class="keywordtype">void</font> <a class="code" href="gl_8h.html#a734">glGetIntegerv</a>( <a class="code" href="gl_8h.html#a687">GLenum</a> pname, <font class="keywordtype">int</font> *params )<font class="keyword"></font>
00850 {
00851    <a class="code" href="debug_8h.html#a1">mNotImplemented</a>( );
00852 }
00853 
<a name="l00854"></a><a class="code" href="glcontext_8cpp.html#a740">00854</a> <a class="code" href="gl_8h.html#a687">GLenum</a> <a class="code" href="glcontext_8cpp.html#a23">glGetError</a>( <font class="keywordtype">void</font> )<font class="keyword"></font>
00855 {
00856    mWarn(<font class="stringliteral">"glGetError does nothing"</font>);
00857 
00858    <font class="keywordflow">return</font> 0;
00859 }
00860 
<a name="l00861"></a><a class="code" href="glcontext_8cpp.html#a741">00861</a> <font class="keyword">const</font> <a class="code" href="gl_8h.html#a694">GLubyte</a> *<a class="code" href="gl_8h.html#a741">glGetString</a>( <a class="code" href="gl_8h.html#a687">GLenum</a> name )<font class="keyword"></font>
00862 {
00863    <a class="code" href="debug_8h.html#a1">mNotImplemented</a>( );
00864    <font class="keywordflow">return</font> (<a class="code" href="gl_8h.html#a694">GLubyte</a>*)<font class="stringliteral">"not implemented"</font>;
00865 }
</pre></div><hr><address><small>ps2gl version cvs</small></address>
