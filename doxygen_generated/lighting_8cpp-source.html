<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>lighting.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body bgcolor="#ffffff">
<!-- Generated by Doxygen 1.2.11 -->
<center>
<a class="qindex" href="main.html">Main Page</a> &nbsp; <a class="qindex" href="modules.html">Modules</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>lighting.cpp</h1><a href="lighting_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <font class="comment">/*        Copyright (C) 2000,2001,2002  Sony Computer Entertainment America</font>
00002           
00003           This file is subject to the terms and conditions of the GNU Lesser
00004           General Public License Version 2.1. See the file "COPYING" in the
00005           main directory of this archive for more details.                             */
00006 
00007 <font class="preprocessor">#include "<a class="code" href="lighting_8h.html">ps2gl/lighting.h</a>"</font>
00008 <font class="preprocessor">#include "<a class="code" href="glcontext_8h.html">ps2gl/glcontext.h</a>"</font>
00009 <font class="preprocessor">#include "<a class="code" href="matrix_8h.html">ps2gl/matrix.h</a>"</font>
00010 <font class="preprocessor">#include "<a class="code" href="dlist_8h.html">ps2gl/dlist.h</a>"</font>
00011 <font class="preprocessor">#include "<a class="code" href="material_8h.html">ps2gl/material.h</a>"</font>
00012 
00013 <font class="comment">/********************************************</font>
00014  * CImmLight
00015  */
00016 
00017 <font class="comment">// static data</font>
00018 
00019 <font class="keywordtype">int</font> CImmLight::NumLights[3] = {0, 0, 0};
00020 
<a name="l00021"></a><a class="code" href="classCImmLight.html#a0">00021</a> <a class="code" href="classCImmLight.html#a0">CImmLight::CImmLight</a>( <a class="code" href="classCGLContext.html">CGLContext</a> &amp;context, <font class="keywordtype">int</font> lightNum )
00022    : <a class="code" href="classCLight.html">CLight</a>(context, lightNum),
00023      Ambient( 0.0f, 0.0f, 0.0f, 1.0f ),
00024      Diffuse( 0.0f, 0.0f, 0.0f, 0.0f ),
00025      Specular( 0.0f, 0.0f, 0.0f, 0.0f ),
00026      Position( 0.0f, 0.0f, 1.0f, 0.0f ),
00027      SpotDirection( 0.0f, 0.0f, -1.0f, 0.0f ),
00028      SpotCutoff(180.0f), SpotExponent(0.0f),
00029      ConstantAtten(1.0f), LinearAtten(0.0f), QuadAtten(0.0f),
00030      bIsEnabled(false),
00031      Type(<a class="code" href="renderermanager_8h.html#a3a0">kDirectional</a>)
00032 {
00033 }
00034 
00035 <font class="keywordtype">void</font>
00036 CImmLight::CheckTypeChange( <a class="code" href="renderermanager_8h.html#a3">tLightType</a> oldType )<font class="keyword"></font>
00037 {
00038    <font class="keywordflow">if</font> ( oldType != Type &amp;&amp; bIsEnabled ) {
00039       <a class="code" href="classCRendererManager.html">CRendererManager</a> &amp;rm = GLContext.GetImmGeomManager().GetRendererManager();
00040       NumLights[oldType]--;
00041       NumLights[Type]++;
00042       rm.<a class="code" href="classCRendererManager.html#a10">NumLightsChanged</a>( oldType, NumLights[oldType] );
00043       rm.<a class="code" href="classCRendererManager.html#a10">NumLightsChanged</a>( Type, NumLights[Type] );
00044    }
00045 }
00046 
00047 <font class="keywordtype">void</font>
<a name="l00048"></a><a class="code" href="classCImmLight.html#a12">00048</a> <a class="code" href="classCImmLight.html#a12">CImmLight::SetEnabled</a>( <font class="keywordtype">bool</font> enabled )<font class="keyword"></font>
00049 {
00050    <font class="keywordflow">if</font> ( bIsEnabled != enabled ) {
00051       bIsEnabled = enabled;
00052       <font class="keywordflow">if</font> (enabled) NumLights[Type]++;
00053       <font class="keywordflow">else</font> NumLights[Type]--;
00054 
00055       GLContext.GetImmLighting().SpecularChanged();
00056 
00057       <a class="code" href="classCRendererManager.html">CRendererManager</a> &amp;rm = GLContext.GetImmGeomManager().GetRendererManager();
00058       rm.<a class="code" href="classCRendererManager.html#a10">NumLightsChanged</a>( Type, NumLights[Type] );
00059    }
00060 }
00061 
00062 <font class="keywordtype">void</font>
<a name="l00063"></a><a class="code" href="classCImmLight.html#a3">00063</a> <a class="code" href="classCImmLight.html#a3">CImmLight::SetSpecular</a>( cpu_vec_xyzw specular )<font class="keyword"></font>
00064 {
00065    cpu_vec_4 zero(0,0,0,0);
00066    <font class="keywordflow">if</font> (specular == zero ^ Specular == zero) {
00067       Specular = specular;
00068       GLContext.GetImmLighting().SpecularChanged();
00069    }
00070    <font class="keywordflow">else</font>
00071       Specular = specular;
00072 
00073    TellRendererLightPropChanged();
00074 }
00075 
00076 <font class="keywordtype">void</font>
<a name="l00077"></a><a class="code" href="classCImmLight.html#a4">00077</a> <a class="code" href="classCImmLight.html#a4">CImmLight::SetPosition</a>( cpu_vec_xyzw position )<font class="keyword"></font>
00078 {
00079    <a class="code" href="classCImmMatrixStack.html">CImmMatrixStack</a> &amp;modelView = GLContext.GetModelViewStack();
00080    
00081    Position = modelView.<a class="code" href="classCImmMatrixStack.html#a5">GetTop</a>() * position;
00082    TellRendererLightPropChanged();
00083 
00084    <a class="code" href="renderermanager_8h.html#a3">tLightType</a> oldType = Type;
00085    Type = (SpotCutoff == 180.0f) ? <a class="code" href="renderermanager_8h.html#a3a1">kPoint</a> : <a class="code" href="renderermanager_8h.html#a3a2">kSpot</a>;
00086    CheckTypeChange(oldType);
00087 }
00088 
00089 <font class="keywordtype">void</font>
<a name="l00090"></a><a class="code" href="classCImmLight.html#a5">00090</a> <a class="code" href="classCImmLight.html#a5">CImmLight::SetDirection</a>( cpu_vec_xyzw direction )<font class="keyword"></font>
00091 {
00092    <a class="code" href="classCImmMatrixStack.html">CImmMatrixStack</a> &amp;modelView = GLContext.GetModelViewStack();
00093    
00094    Position = modelView.<a class="code" href="classCImmMatrixStack.html#a5">GetTop</a>() * direction.normalize();
00095    TellRendererLightPropChanged();
00096 
00097    <a class="code" href="renderermanager_8h.html#a3">tLightType</a> oldType = Type;
00098    Type = <a class="code" href="renderermanager_8h.html#a3a0">kDirectional</a>;
00099    CheckTypeChange(oldType);
00100 }
00101 
00102 <font class="comment">/********************************************</font>
00103  * CDListLight
00104  */
00105 
<a name="l00106"></a><a class="code" href="classCLightPropCmd.html">00106</a> <font class="keyword">class </font><a class="code" href="classCLightPropCmd.html">CLightPropCmd</a> : <font class="keyword">public</font> <a class="code" href="classCDListCmd.html">CDListCmd</a> {
00107       <a class="code" href="gl_8h.html#a687">GLenum</a>    LightNum, Property;
00108       cpu_vec_xyzw      Value;
00109    <font class="keyword">public</font>:
<a name="l00110"></a><a class="code" href="classCLightPropCmd.html#a0">00110</a>       <a class="code" href="classCLightPropCmd.html#a0">CLightPropCmd</a>( <a class="code" href="gl_8h.html#a687">GLenum</a> lightNum, <a class="code" href="gl_8h.html#a687">GLenum</a> prop, cpu_vec_xyzw value )
00111          : LightNum(lightNum), Property(prop), Value(value) {}
<a name="l00112"></a><a class="code" href="classCLightPropCmd.html#a1">00112</a>       <a class="code" href="classCDListCmd.html">CDListCmd</a>* <a class="code" href="classCDListCmd.html#a1">Play</a>()<font class="keyword"> </font>{
00113          <a class="code" href="gl_8h.html#a932">glLightfv</a>( LightNum, Property, reinterpret_cast&lt;float*&gt;(&amp;Value) );
00114          <font class="keywordflow">return</font> <a class="code" href="classCDListCmd.html#d1">CDListCmd::GetNextCmd</a>(<font class="keyword">this</font>);
00115       }
00116 };
00117 
00118 <font class="keywordtype">void</font>
<a name="l00119"></a><a class="code" href="classCDListLight.html#a1">00119</a> <a class="code" href="classCDListLight.html#a1">CDListLight::SetAmbient</a>( cpu_vec_xyzw ambient )<font class="keyword"></font>
00120 {
00121    GLContext.GetDListManager().GetOpenDList()
00122       += CLightPropCmd( <a class="code" href="gl_8h.html#a119">GL_LIGHT0</a> | LightNum, <a class="code" href="gl_8h.html#a132">GL_AMBIENT</a>, ambient );
00123    TellRendererLightPropChanged();
00124 }
00125 
00126 <font class="keywordtype">void</font>
<a name="l00127"></a><a class="code" href="classCDListLight.html#a2">00127</a> <a class="code" href="classCDListLight.html#a2">CDListLight::SetDiffuse</a>( cpu_vec_xyzw diffuse )<font class="keyword"></font>
00128 {
00129    GLContext.GetDListManager().GetOpenDList()
00130       += CLightPropCmd( <a class="code" href="gl_8h.html#a119">GL_LIGHT0</a> | LightNum, <a class="code" href="gl_8h.html#a133">GL_DIFFUSE</a>, diffuse );
00131    TellRendererLightPropChanged();
00132 }
00133 
00134 <font class="keywordtype">void</font>
<a name="l00135"></a><a class="code" href="classCDListLight.html#a3">00135</a> <a class="code" href="classCDListLight.html#a3">CDListLight::SetSpecular</a>( cpu_vec_xyzw specular )<font class="keyword"></font>
00136 {
00137    GLContext.GetDListManager().GetOpenDList()
00138       += CLightPropCmd( <a class="code" href="gl_8h.html#a119">GL_LIGHT0</a> | LightNum, <a class="code" href="gl_8h.html#a134">GL_SPECULAR</a>, specular );
00139    TellRendererLightPropChanged();
00140    GLContext.SpecularEnabledChanged(); <font class="comment">// maybe</font>
00141 }
00142 
00143 <font class="keywordtype">void</font>
<a name="l00144"></a><a class="code" href="classCDListLight.html#a4">00144</a> <a class="code" href="classCDListLight.html#a4">CDListLight::SetPosition</a>( cpu_vec_xyzw position )<font class="keyword"></font>
00145 {
00146    GLContext.GetDListManager().GetOpenDList()
00147       += CLightPropCmd( <a class="code" href="gl_8h.html#a119">GL_LIGHT0</a> | LightNum, <a class="code" href="gl_8h.html#a137">GL_POSITION</a>, position );
00148    TellRendererLightPropChanged();
00149 }
00150 
00151 <font class="keywordtype">void</font>
<a name="l00152"></a><a class="code" href="classCDListLight.html#a5">00152</a> <a class="code" href="classCDListLight.html#a5">CDListLight::SetDirection</a>( cpu_vec_xyzw direction )<font class="keyword"></font>
00153 {
00154    GLContext.GetDListManager().GetOpenDList()
00155       += CLightPropCmd( <a class="code" href="gl_8h.html#a119">GL_LIGHT0</a> | LightNum, <a class="code" href="gl_8h.html#a137">GL_POSITION</a>, direction );
00156    TellRendererLightPropChanged();
00157 }
00158 
00159 <font class="keywordtype">void</font>
<a name="l00160"></a><a class="code" href="classCDListLight.html#a6">00160</a> <a class="code" href="classCDListLight.html#a6">CDListLight::SetSpotDirection</a>( cpu_vec_xyzw dir )<font class="keyword"></font>
00161 {
00162    GLContext.GetDListManager().GetOpenDList()
00163       += CLightPropCmd( <a class="code" href="gl_8h.html#a119">GL_LIGHT0</a> | LightNum, <a class="code" href="gl_8h.html#a138">GL_SPOT_DIRECTION</a>, dir );
00164    TellRendererLightPropChanged();
00165 }
00166 
00167 <font class="keywordtype">void</font>
<a name="l00168"></a><a class="code" href="classCDListLight.html#a7">00168</a> <a class="code" href="classCDListLight.html#a7">CDListLight::SetSpotCutoff</a>( <font class="keywordtype">float</font> cutoff )<font class="keyword"></font>
00169 {
00170    GLContext.GetDListManager().GetOpenDList()
00171       += CLightPropCmd( <a class="code" href="gl_8h.html#a119">GL_LIGHT0</a> | LightNum, <a class="code" href="gl_8h.html#a128">GL_SPOT_CUTOFF</a>, cpu_vec_xyzw(cutoff, 0, 0, 0) );
00172    TellRendererLightPropChanged();
00173 }
00174 
00175 <font class="keywordtype">void</font>
<a name="l00176"></a><a class="code" href="classCDListLight.html#a8">00176</a> <a class="code" href="classCDListLight.html#a8">CDListLight::SetSpotExponent</a>( <font class="keywordtype">float</font> exp )<font class="keyword"></font>
00177 {
00178    GLContext.GetDListManager().GetOpenDList()
00179       += CLightPropCmd( <a class="code" href="gl_8h.html#a119">GL_LIGHT0</a> | LightNum, <a class="code" href="gl_8h.html#a132">GL_AMBIENT</a>, cpu_vec_xyzw(exp, 0, 0, 0) );
00180    TellRendererLightPropChanged();
00181 }
00182 
00183 <font class="keywordtype">void</font>
<a name="l00184"></a><a class="code" href="classCDListLight.html#a9">00184</a> <a class="code" href="classCDListLight.html#a9">CDListLight::SetConstantAtten</a>( <font class="keywordtype">float</font> atten )<font class="keyword"></font>
00185 {
00186    GLContext.GetDListManager().GetOpenDList()
00187       += CLightPropCmd( <a class="code" href="gl_8h.html#a119">GL_LIGHT0</a> | LightNum, <a class="code" href="gl_8h.html#a129">GL_CONSTANT_ATTENUATION</a>, cpu_vec_xyzw(atten, 0, 0, 0) );
00188    TellRendererLightPropChanged();
00189 }
00190 
00191 <font class="keywordtype">void</font>
<a name="l00192"></a><a class="code" href="classCDListLight.html#a10">00192</a> <a class="code" href="classCDListLight.html#a10">CDListLight::SetLinearAtten</a>( <font class="keywordtype">float</font> atten )<font class="keyword"></font>
00193 {
00194    GLContext.GetDListManager().GetOpenDList()
00195       += CLightPropCmd( <a class="code" href="gl_8h.html#a119">GL_LIGHT0</a> | LightNum, <a class="code" href="gl_8h.html#a130">GL_LINEAR_ATTENUATION</a>, cpu_vec_xyzw(atten, 0, 0, 0) );
00196    TellRendererLightPropChanged();
00197 }
00198 
00199 <font class="keywordtype">void</font>
<a name="l00200"></a><a class="code" href="classCDListLight.html#a11">00200</a> <a class="code" href="classCDListLight.html#a11">CDListLight::SetQuadAtten</a>( <font class="keywordtype">float</font> atten )<font class="keyword"></font>
00201 {
00202    GLContext.GetDListManager().GetOpenDList()
00203       += CLightPropCmd( <a class="code" href="gl_8h.html#a119">GL_LIGHT0</a> | LightNum, <a class="code" href="gl_8h.html#a131">GL_QUADRATIC_ATTENUATION</a>, cpu_vec_xyzw(atten, 0, 0, 0) );
00204    TellRendererLightPropChanged();
00205 }
00206 
00207 
00208 <font class="keywordtype">void</font>
<a name="l00209"></a><a class="code" href="classCDListLight.html#a12">00209</a> <a class="code" href="classCDListLight.html#a12">CDListLight::SetEnabled</a>( <font class="keywordtype">bool</font> yesNo )<font class="keyword"></font>
00210 {
00211    GLContext.GetDListManager().GetOpenDList()
00212       += CEnableCmd( <a class="code" href="gl_8h.html#a119">GL_LIGHT0</a> | LightNum );
00213    TellRendererLightsEnabledChanged();
00214 }
00215 
00216 
00217 <font class="comment">/********************************************</font>
00218  * CLighting
00219  */
00220 
<a name="l00221"></a><a class="code" href="classCImmLighting.html#a0">00221</a> <a class="code" href="classCImmLighting.html#a0">CImmLighting::CImmLighting</a>( <a class="code" href="classCGLContext.html">CGLContext</a> &amp;context )
00222    : <a class="code" href="classCLighting.html">CLighting</a>(context),
00223      CurrentColor( 0.0f, 0.0f, 0.0f, 0.0f ),
00224      GlobalAmbient( 0.0f, 0.0f, 0.0f, 0.0f ),
00225      Light0(context, 0), Light1(context, 1), Light2(context, 2), Light3(context, 3),
00226      Light4(context, 4), Light5(context, 5), Light6(context, 6), Light7(context, 7),
00227      IsEnabled(false),
00228      NumLightsWithNonzeroSpecular(0)
00229 {
00230    Lights[0] = &amp;Light0;
00231    Lights[1] = &amp;Light1;
00232    Lights[2] = &amp;Light2;
00233    Lights[3] = &amp;Light3;
00234    Lights[4] = &amp;Light4;
00235    Lights[5] = &amp;Light5;
00236    Lights[6] = &amp;Light6;
00237    Lights[7] = &amp;Light7;
00238 }
00239 
00240 <font class="keywordtype">void</font>
<a name="l00241"></a><a class="code" href="classCImmLighting.html#a7">00241</a> <a class="code" href="classCImmLighting.html#a7">CImmLighting::SpecularChanged</a>()<font class="keyword"></font>
00242 {
00243    <font class="keywordtype">int</font> count = 0;
00244    cpu_vec_4 zero(0,0,0,0);
00245    <font class="keywordflow">for</font> ( <font class="keywordtype">int</font> i = 0; i &lt; 8; i++ )
00246       <font class="keywordflow">if</font> ( Lights[i]-&gt;<a class="code" href="classCImmLight.html#a23">IsEnabled</a>() &amp;&amp; Lights[i]-&gt;<a class="code" href="classCImmLight.html#a15">GetSpecular</a>() != zero )
00247          count++;
00248 
00249    NumLightsWithNonzeroSpecular = count;
00250    <font class="keywordflow">if</font> ( NumLightsWithNonzeroSpecular == 0 ) {
00251       GLContext.SpecularEnabledChanged();
00252       GLContext.GetImmGeomManager().GetRendererManager().SpecularEnabledChanged(<font class="keyword">false</font>);
00253    }
00254    <font class="keywordflow">else</font>
00255       GLContext.GetMaterialManager().GetImmMaterial().LightsHaveSpecular();
00256 }
00257 
00258 <font class="keywordtype">void</font>
<a name="l00259"></a><a class="code" href="classCImmLighting.html#a8">00259</a> <a class="code" href="classCImmLighting.html#a8">CImmLighting::MaterialHasSpecular</a>()<font class="keyword"></font>
00260 {
00261    <font class="keywordflow">if</font> ( NumLightsWithNonzeroSpecular &gt; 0 ) {
00262       GLContext.SpecularEnabledChanged();
00263       GLContext.GetImmGeomManager().GetRendererManager().SpecularEnabledChanged(<font class="keyword">true</font>);
00264    }
00265 }
00266 
00267 
<a name="l00268"></a><a class="code" href="classCDListLighting.html#a0">00268</a> <a class="code" href="classCDListLighting.html#a0">CDListLighting::CDListLighting</a>( <a class="code" href="classCGLContext.html">CGLContext</a> &amp;context )
00269    : <a class="code" href="classCLighting.html">CLighting</a>(context),
00270      Light0(context, 0), Light1(context, 1), Light2(context, 2), Light3(context, 3),
00271      Light4(context, 4), Light5(context, 5), Light6(context, 6), Light7(context, 7)
00272 {
00273    Lights[0] = &amp;Light0;
00274    Lights[1] = &amp;Light1;
00275    Lights[2] = &amp;Light2;
00276    Lights[3] = &amp;Light3;
00277    Lights[4] = &amp;Light4;
00278    Lights[5] = &amp;Light5;
00279    Lights[6] = &amp;Light6;
00280    Lights[7] = &amp;Light7;
00281 }
00282 
<a name="l00283"></a><a class="code" href="classCSetLightingEnabledCmd.html">00283</a> <font class="keyword">class </font><a class="code" href="classCSetLightingEnabledCmd.html">CSetLightingEnabledCmd</a> : <font class="keyword">public</font> <a class="code" href="classCDListCmd.html">CDListCmd</a> {
00284       <font class="keywordtype">bool</font>      IsEnabled;
00285    <font class="keyword">public</font>:
<a name="l00286"></a><a class="code" href="classCSetLightingEnabledCmd.html#a0">00286</a>       <a class="code" href="classCSetLightingEnabledCmd.html#a0">CSetLightingEnabledCmd</a>( <font class="keywordtype">bool</font> enabled ) : IsEnabled(enabled) {}
<a name="l00287"></a><a class="code" href="classCSetLightingEnabledCmd.html#a1">00287</a>       <a class="code" href="classCDListCmd.html">CDListCmd</a>* <a class="code" href="classCDListCmd.html#a1">Play</a>()<font class="keyword"> </font>{
00288          pGLContext-&gt;GetImmLighting().SetLightingEnabled(IsEnabled);
00289          <font class="keywordflow">return</font> <a class="code" href="classCDListCmd.html#d1">CDListCmd::GetNextCmd</a>(<font class="keyword">this</font>);
00290       }
00291 };
00292 
00293 <font class="keywordtype">void</font>
<a name="l00294"></a><a class="code" href="classCDListLighting.html#a3">00294</a> <a class="code" href="classCDListLighting.html#a3">CDListLighting::SetLightingEnabled</a>( <font class="keywordtype">bool</font> enabled )<font class="keyword"></font>
00295 {
00296    GLContext.GetDListManager().GetOpenDList() += CSetLightingEnabledCmd(enabled);
00297    GLContext.LightingEnabledChanged();
00298 }
00299 
<a name="l00300"></a><a class="code" href="classCSetGlobalAmbientCmd.html">00300</a> <font class="keyword">class </font><a class="code" href="classCSetGlobalAmbientCmd.html">CSetGlobalAmbientCmd</a> : <font class="keyword">public</font> <a class="code" href="classCDListCmd.html">CDListCmd</a> {
00301       cpu_vec_xyzw      Ambient;
00302    <font class="keyword">public</font>:
<a name="l00303"></a><a class="code" href="classCSetGlobalAmbientCmd.html#a0">00303</a>       <a class="code" href="classCSetGlobalAmbientCmd.html#a0">CSetGlobalAmbientCmd</a>( cpu_vec_xyzw newAmb ) : Ambient(newAmb) {}
<a name="l00304"></a><a class="code" href="classCSetGlobalAmbientCmd.html#a1">00304</a>       <a class="code" href="classCDListCmd.html">CDListCmd</a>* <a class="code" href="classCDListCmd.html#a1">Play</a>()<font class="keyword"> </font>{
00305          pGLContext-&gt;GetImmLighting().SetGlobalAmbient( Ambient );
00306          <font class="keywordflow">return</font> <a class="code" href="classCDListCmd.html#d1">CDListCmd::GetNextCmd</a>(<font class="keyword">this</font>);
00307       }
00308 };
00309 
00310 <font class="keywordtype">void</font>
<a name="l00311"></a><a class="code" href="classCDListLighting.html#a4">00311</a> <a class="code" href="classCDListLighting.html#a4">CDListLighting::SetGlobalAmbient</a>( cpu_vec_xyzw newAmb )<font class="keyword"></font>
00312 {
00313    GLContext.GetDListManager().GetOpenDList() += CSetGlobalAmbientCmd(newAmb);
00314    TellRendererLightPropChanged();
00315 }
00316 
00317 <font class="comment">/********************************************</font>
00318  * gl interface
00319  */
00320 
00321 <font class="keywordtype">void</font>
<a name="l00322"></a><a class="code" href="lighting_8cpp.html#a0">00322</a> <a class="code" href="lighting_8cpp.html#a0">setPosition</a>( <a class="code" href="classCLight.html">CLight</a> &amp;light, <font class="keywordtype">float</font> x, <font class="keywordtype">float</font> y, <font class="keywordtype">float</font> z, <font class="keywordtype">float</font> w )<font class="keyword"></font>
00323 {
00324    cpu_vec_xyzw pos(x, y, z, w);
00325    <font class="keywordflow">if</font> ( w == 0.0f )
00326       light.<a class="code" href="classCLight.html#a5">SetDirection</a>( pos );
00327    <font class="keywordflow">else</font>
00328       light.<a class="code" href="classCLight.html#a4">SetPosition</a>( pos );
00329 }
00330 
<a name="l00331"></a><a class="code" href="lighting_8cpp.html#a932">00331</a> <font class="keywordtype">void</font> <a class="code" href="gl_8h.html#a932">glLightfv</a>( <a class="code" href="gl_8h.html#a687">GLenum</a> lightNum,
00332                 <a class="code" href="gl_8h.html#a687">GLenum</a> pname,
00333                 <font class="keyword">const</font> <a class="code" href="gl_8h.html#a698">GLfloat</a> *params )<font class="keyword"></font>
00334 {
00335    <a class="code" href="classCLighting.html">CLighting</a>&amp; lighting = pGLContext-&gt;GetLighting();
00336    <a class="code" href="classCLight.html">CLight</a>&amp; light = lighting.<a class="code" href="classCLighting.html#a1">GetLight</a>(0x7 &amp; lightNum);
00337 
00338    <font class="keywordflow">switch</font> (pname) {
00339       <font class="keywordflow">case</font> <a class="code" href="gl_8h.html#a132">GL_AMBIENT</a>:
00340          light.<a class="code" href="classCLight.html#a1">SetAmbient</a>( cpu_vec_xyzw(params[0], params[1], params[2], params[3]) );
00341          <font class="keywordflow">break</font>;
00342       <font class="keywordflow">case</font> <a class="code" href="gl_8h.html#a133">GL_DIFFUSE</a>:
00343          light.<a class="code" href="classCLight.html#a2">SetDiffuse</a>( cpu_vec_xyzw(params[0], params[1], params[2], params[3]) );
00344          <font class="keywordflow">break</font>;
00345       <font class="keywordflow">case</font> <a class="code" href="gl_8h.html#a134">GL_SPECULAR</a>:
00346          light.<a class="code" href="classCLight.html#a3">SetSpecular</a>( cpu_vec_xyzw(params[0], params[1], params[2], params[3]) );
00347          <font class="keywordflow">break</font>;
00348       <font class="keywordflow">case</font> <a class="code" href="gl_8h.html#a137">GL_POSITION</a>:
00349          <a class="code" href="lighting_8cpp.html#a0">setPosition</a>(light, params[0], params[1], params[2], params[3]);
00350          <font class="keywordflow">break</font>;
00351       <font class="keywordflow">case</font> <a class="code" href="gl_8h.html#a138">GL_SPOT_DIRECTION</a>:
00352          light.<a class="code" href="classCLight.html#a4">SetPosition</a>( cpu_vec_xyzw(params[0], params[1], params[2], 0.0f).normalize() );
00353          <font class="keywordflow">break</font>;
00354       <font class="keywordflow">case</font> <a class="code" href="gl_8h.html#a127">GL_SPOT_EXPONENT</a>:
00355          light.<a class="code" href="classCLight.html#a8">SetSpotExponent</a>( *params );
00356          <font class="keywordflow">break</font>;
00357       <font class="keywordflow">case</font> <a class="code" href="gl_8h.html#a128">GL_SPOT_CUTOFF</a>:
00358          light.<a class="code" href="classCLight.html#a7">SetSpotCutoff</a>( *params );
00359          <font class="keywordflow">break</font>;
00360       <font class="keywordflow">case</font> <a class="code" href="gl_8h.html#a129">GL_CONSTANT_ATTENUATION</a>:
00361          light.<a class="code" href="classCLight.html#a9">SetConstantAtten</a>( *params );
00362          <font class="keywordflow">break</font>;
00363       <font class="keywordflow">case</font> <a class="code" href="gl_8h.html#a130">GL_LINEAR_ATTENUATION</a>:
00364          light.<a class="code" href="classCLight.html#a10">SetLinearAtten</a>( *params );
00365          <font class="keywordflow">break</font>;
00366       <font class="keywordflow">case</font> <a class="code" href="gl_8h.html#a131">GL_QUADRATIC_ATTENUATION</a>:
00367          light.<a class="code" href="classCLight.html#a11">SetQuadAtten</a>( *params );
00368          <font class="keywordflow">break</font>;
00369       <font class="keywordflow">default</font>:
00370          mError(<font class="stringliteral">"Shouldn't get here."</font> );
00371    }
00372 }
00373 
<a name="l00374"></a><a class="code" href="lighting_8cpp.html#a930">00374</a> <font class="keywordtype">void</font> <a class="code" href="gl_8h.html#a930">glLightf</a>( <a class="code" href="gl_8h.html#a687">GLenum</a> lightNum, <a class="code" href="gl_8h.html#a687">GLenum</a> pname, <a class="code" href="gl_8h.html#a698">GLfloat</a> param )<font class="keyword"></font>
00375 {
00376    <a class="code" href="classCLighting.html">CLighting</a>&amp; lighting = pGLContext-&gt;GetLighting();
00377    <a class="code" href="classCLight.html">CLight</a>&amp; light = lighting.<a class="code" href="classCLighting.html#a1">GetLight</a>(0x7 &amp; lightNum);
00378 
00379    <font class="keywordflow">switch</font> (pname) {
00380       <font class="keywordflow">case</font> <a class="code" href="gl_8h.html#a127">GL_SPOT_EXPONENT</a>:
00381          light.<a class="code" href="classCLight.html#a8">SetSpotExponent</a>( param );
00382          <font class="keywordflow">break</font>;
00383       <font class="keywordflow">case</font> <a class="code" href="gl_8h.html#a128">GL_SPOT_CUTOFF</a>:
00384          light.<a class="code" href="classCLight.html#a7">SetSpotCutoff</a>( param );
00385          <font class="keywordflow">break</font>;
00386       <font class="keywordflow">case</font> <a class="code" href="gl_8h.html#a129">GL_CONSTANT_ATTENUATION</a>:
00387          light.<a class="code" href="classCLight.html#a9">SetConstantAtten</a>( param );
00388          <font class="keywordflow">break</font>;
00389       <font class="keywordflow">case</font> <a class="code" href="gl_8h.html#a130">GL_LINEAR_ATTENUATION</a>:
00390          light.<a class="code" href="classCLight.html#a10">SetLinearAtten</a>( param );
00391          <font class="keywordflow">break</font>;
00392       <font class="keywordflow">case</font> <a class="code" href="gl_8h.html#a131">GL_QUADRATIC_ATTENUATION</a>:
00393          light.<a class="code" href="classCLight.html#a11">SetQuadAtten</a>( param );
00394          <font class="keywordflow">break</font>;
00395       <font class="keywordflow">default</font>:
00396          mError(<font class="stringliteral">"Shouldn't get here."</font> );
00397    }   
00398 }
00399 
<a name="l00400"></a><a class="code" href="lighting_8cpp.html#a938">00400</a> <font class="keywordtype">void</font> <a class="code" href="gl_8h.html#a938">glLightModelfv</a>( <a class="code" href="gl_8h.html#a687">GLenum</a> pname, <font class="keyword">const</font> <a class="code" href="gl_8h.html#a698">GLfloat</a> *params )<font class="keyword"></font>
00401 {
00402    <font class="keywordflow">switch</font> (pname) {
00403       <font class="keywordflow">case</font> <a class="code" href="gl_8h.html#a143">GL_LIGHT_MODEL_AMBIENT</a>:
00404          pGLContext-&gt;GetLighting().SetGlobalAmbient( cpu_vec_xyzw( params[0],
00405                                                                    params[1],
00406                                                                    params[2],
00407                                                                    params[3] ) );
00408          <font class="keywordflow">break</font>;
00409       <font class="keywordflow">case</font> <a class="code" href="gl_8h.html#a537">GL_LIGHT_MODEL_COLOR_CONTROL</a>:
00410          <font class="keywordflow">if</font> ( (int)*params == <a class="code" href="gl_8h.html#a539">GL_SEPARATE_SPECULAR_COLOR</a> ) {
00411             <a class="code" href="debug_8h.html#a1">mNotImplemented</a>( <font class="stringliteral">"separate specular color computation"</font> );
00412          }
00413          <font class="keywordflow">break</font>;
00414       <font class="keywordflow">case</font> <a class="code" href="gl_8h.html#a142">GL_LIGHT_MODEL_LOCAL_VIEWER</a>:
00415          <font class="keywordflow">if</font> ( (int)*params != 0 ) {
00416             <a class="code" href="debug_8h.html#a1">mNotImplemented</a>( <font class="stringliteral">"local viewer"</font> );
00417          }
00418          <font class="keywordflow">break</font>;
00419       <font class="keywordflow">case</font> <a class="code" href="gl_8h.html#a141">GL_LIGHT_MODEL_TWO_SIDE</a>:
00420          <font class="keywordflow">if</font> ( (int)*params != 0 ) {
00421             <a class="code" href="debug_8h.html#a1">mNotImplemented</a>( <font class="stringliteral">"two-sided lighting"</font> );
00422          }
00423          <font class="keywordflow">break</font>;
00424       <font class="keywordflow">default</font>:
00425          mError(<font class="stringliteral">"shouldn't get here"</font>);
00426    }
00427 }
00428 
<a name="l00429"></a><a class="code" href="lighting_8cpp.html#a4">00429</a> <font class="keywordtype">void</font> <a class="code" href="gl_8h.html#a937">glLightModeli</a>( <a class="code" href="gl_8h.html#a687">GLenum</a> pname, <font class="keywordtype">int</font> param )<font class="keyword"></font>
00430 {
00431    <a class="code" href="debug_8h.html#a1">mNotImplemented</a>( );
00432 }
00433 
<a name="l00434"></a><a class="code" href="lighting_8cpp.html#a5">00434</a> <font class="keywordtype">void</font> <a class="code" href="gl_8h.html#a934">glGetLightfv</a>( <a class="code" href="gl_8h.html#a687">GLenum</a> light, <a class="code" href="gl_8h.html#a687">GLenum</a> pname, <font class="keywordtype">float</font> *params )<font class="keyword"></font>
00435 {
00436    <a class="code" href="debug_8h.html#a1">mNotImplemented</a>( );
00437 }
00438 
<a name="l00439"></a><a class="code" href="lighting_8cpp.html#a1027">00439</a> <font class="keywordtype">void</font> <a class="code" href="gl_8h.html#a1027">glFogf</a>( <a class="code" href="gl_8h.html#a687">GLenum</a> pname, <a class="code" href="gl_8h.html#a698">GLfloat</a> param )<font class="keyword"></font>
00440 {
00441    <a class="code" href="debug_8h.html#a1">mNotImplemented</a>( );
00442 }
00443 
<a name="l00444"></a><a class="code" href="lighting_8cpp.html#a1029">00444</a> <font class="keywordtype">void</font> <a class="code" href="gl_8h.html#a1029">glFogfv</a>( <a class="code" href="gl_8h.html#a687">GLenum</a> pname, <font class="keyword">const</font> <a class="code" href="gl_8h.html#a698">GLfloat</a> *params )<font class="keyword"></font>
00445 {
00446    <a class="code" href="debug_8h.html#a1">mNotImplemented</a>( );
00447 }
</pre></div><hr><address><small>ps2gl version cvs</small></address>
