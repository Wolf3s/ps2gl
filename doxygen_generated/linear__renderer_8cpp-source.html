<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>linear_renderer.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body bgcolor="#ffffff">
<!-- Generated by Doxygen 1.2.11 -->
<center>
<a class="qindex" href="main.html">Main Page</a> &nbsp; <a class="qindex" href="modules.html">Modules</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>linear_renderer.cpp</h1><a href="linear__renderer_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <font class="comment">/*        Copyright (C) 2000,2001,2002  Sony Computer Entertainment America</font>
00002           
00003           This file is subject to the terms and conditions of the GNU Lesser
00004           General Public License Version 2.1. See the file "COPYING" in the
00005           main directory of this archive for more details.                             */
00006 
00007 <font class="preprocessor">#include "ps2s/packet.h"</font>
00008 <font class="preprocessor">#include "ps2s/math.h"</font>
00009 <font class="preprocessor">#include "ps2s/cpu_matrix.h"</font>
00010 
00011 <font class="preprocessor">#include "<a class="code" href="linear__renderer_8h.html">ps2gl/linear_renderer.h</a>"</font>
00012 <font class="preprocessor">#include "<a class="code" href="glcontext_8h.html">ps2gl/glcontext.h</a>"</font>
00013 <font class="preprocessor">#include "<a class="code" href="metrics_8h.html">ps2gl/metrics.h</a>"</font>
00014 <font class="preprocessor">#include "<a class="code" href="immgmanager_8h.html">ps2gl/immgmanager.h</a>"</font>
00015 <font class="preprocessor">#include "<a class="code" href="lighting_8h.html">ps2gl/lighting.h</a>"</font>
00016 <font class="preprocessor">#include "<a class="code" href="material_8h.html">ps2gl/material.h</a>"</font>
00017 <font class="preprocessor">#include "<a class="code" href="matrix_8h.html">ps2gl/matrix.h</a>"</font>
00018 <font class="preprocessor">#include "<a class="code" href="texture_8h.html">ps2gl/texture.h</a>"</font>
00019 <font class="preprocessor">#include "<a class="code" href="drawcontext_8h.html">ps2gl/drawcontext.h</a>"</font>
00020 
00021 <font class="preprocessor">#include "vu1_mem_linear.h"</font>
00022 
00023 <font class="keywordtype">void</font>
<a name="l00024"></a><a class="code" href="classCLinearRenderer.html#a3">00024</a> <a class="code" href="classCLinearRenderer.html#a3">CLinearRenderer::DrawLinearArrays</a>( <a class="code" href="classCGeometryBlock.html">CGeometryBlock</a> &amp;block )<font class="keyword"></font>
00025 {
00026    <font class="keywordtype">int</font> wordsPerVert = block.<a class="code" href="classCGeometryBlock.html#a9">GetWordsPerVertex</a>();
00027    <font class="keywordtype">int</font> wordsPerNormal = (block.<a class="code" href="classCGeometryBlock.html#a6">GetNormalsAreValid</a>()) ? block.<a class="code" href="classCGeometryBlock.html#a10">GetWordsPerNormal</a>() : 0;
00028    <font class="keywordtype">int</font> wordsPerTex = (block.<a class="code" href="classCGeometryBlock.html#a7">GetTexCoordsAreValid</a>()) ? block.<a class="code" href="classCGeometryBlock.html#a11">GetWordsPerTexCoord</a>() : 0;
00029    <font class="keywordtype">int</font> wordsPerColor = (block.<a class="code" href="classCGeometryBlock.html#a8">GetColorsAreValid</a>()) ? block.<a class="code" href="classCGeometryBlock.html#a12">GetWordsPerColor</a>() : 0;
00030 
00031    CVifSCDmaPacket &amp;packet = pGLContext-&gt;GetVif1Packet();
00032    <a class="code" href="classCBaseRenderer.html#b4">InitXferBlock</a>( packet, wordsPerVert, wordsPerNormal, wordsPerTex, wordsPerColor );
00033    
00034    <font class="comment">// get max number of vertices per vu1 buffer</font>
00035 
00036    <font class="comment">// let's assume separate unpacks for vertices, normals, tex uvs..</font>
00037    <font class="keywordtype">int</font> maxUnpackVerts = 256;
00038    <font class="comment">// max number of vertex data in vu1 memory</font>
00039    <font class="keywordtype">int</font> vu1QuadsPerVert = InputQuadsPerVert;
00040    <font class="keywordtype">int</font> inputBufSize = InputGeomBufSize;
00041    <font class="keywordtype">int</font> maxVu1VertsPerBuffer = inputBufSize / vu1QuadsPerVert;
00042    <font class="comment">// max vertices per buffer</font>
00043    <font class="keywordtype">int</font> maxVertsPerBuffer = Math::Min( maxUnpackVerts, maxVu1VertsPerBuffer );
00044    maxVertsPerBuffer -= 3;
00045    <font class="comment">// make sure we don't end in the middle of a polygon</font>
00046    maxVertsPerBuffer -= maxVertsPerBuffer % block.<a class="code" href="classCGeometryBlock.html#a45">GetNumVertsPerPrim</a>();
00047 
00048    <font class="comment">// draw</font>
00049 
00050    <a class="code" href="classCLinearRenderer.html#b0">DrawBlock</a>( packet, block, maxVertsPerBuffer );
00051 }
00052 
00053 <font class="keywordtype">void</font>
<a name="l00054"></a><a class="code" href="classCLinearRenderer.html#a2">00054</a> <a class="code" href="classCLinearRenderer.html#a2">CLinearRenderer::InitContext</a>( <a class="code" href="gl_8h.html#a687">GLenum</a> primType, tU32 rcChanges, <font class="keywordtype">bool</font> userRcChanged )<font class="keyword"></font>
00055 {
00056    <a class="code" href="classCGLContext.html">CGLContext</a> &amp;glContext = *pGLContext;
00057    CVifSCDmaPacket &amp;packet = glContext.<a class="code" href="classCGLContext.html#a70">GetVif1Packet</a>();
00058 
00059    packet.Cnt();
00060    {
00061       <a class="code" href="classCBaseRenderer.html#b7">AddVu1RendererContext</a>( packet, primType, <a class="code" href="base__renderer_8cpp.html#a0">kContextStart</a> );
00062 
00063       packet.Mscal(0);
00064       packet.Flushe();
00065 
00066       packet.Base( kDoubleBufBase );
00067       packet.Offset( kDoubleBufOffset );
00068    }
00069    packet.CloseTag();
00070 
00071    <a class="code" href="classCBaseRenderer.html#b9">CacheRendererState</a>();
00072 }
00073 
00074 <font class="keywordtype">int</font>
<a name="l00075"></a><a class="code" href="classCLinearRenderer.html#a4">00075</a> <a class="code" href="classCLinearRenderer.html#a4">CLinearRenderer::GetPacketQwordSize</a>( <font class="keyword">const</font> <a class="code" href="classCGeometryBlock.html">CGeometryBlock</a> &amp;geometry )<font class="keyword"></font>
00076 {
00077    <font class="comment">// FIXME:  this is a pitiful hack for allocating enough memory</font>
00078    <font class="keywordflow">return</font> Math::Max(geometry.<a class="code" href="classCGeometryBlock.html#a39">GetTotalVertices</a>() / 70, 1) * 1000;
00079 }
00080 
00081 <a class="code" href="classCRendererProps.html">CRendererProps</a>
<a name="l00082"></a><a class="code" href="classCLinearRenderer.html#a5">00082</a> <a class="code" href="classCLinearRenderer.html#a5">CLinearRenderer::GetRenderContextDeps</a>()<font class="keyword"></font>
00083 {
00084    <a class="code" href="classCRendererProps.html">CRendererProps</a> deps;
00085    deps = (tU64)0;
00086    deps.<a class="code" href="classCRendererProps.html#m1">Lighting</a> = 1;
00087    deps.<a class="code" href="classCRendererProps.html#m4">Texture</a> = 1;
00088    deps.<a class="code" href="classCRendererProps.html#m6">PerVtxMaterial</a> = 1;
00089    
00090    <font class="keywordflow">return</font> deps;
00091 }
00092 
00093 <font class="keywordtype">bool</font>
<a name="l00094"></a><a class="code" href="classCLinearRenderer.html#a6">00094</a> <a class="code" href="classCLinearRenderer.html#a6">CLinearRenderer::GetCachePackets</a>( <font class="keyword">const</font> <a class="code" href="classCGeometryBlock.html">CGeometryBlock</a> &amp;geometry )<font class="keyword"></font>
00095 {
00096    <font class="keywordflow">return</font> !( pGLContext-&gt;GetImmLighting().GetLightingEnabled()
00097              &amp;&amp; ! geometry.<a class="code" href="classCGeometryBlock.html#a6">GetNormalsAreValid</a>() );
00098 }
00099 
00100 <font class="keywordtype">void</font>
<a name="l00101"></a><a class="code" href="classCLinearRenderer.html#b0">00101</a> <a class="code" href="classCLinearRenderer.html#b0">CLinearRenderer::DrawBlock</a>( CVifSCDmaPacket &amp;packet,
00102                             <a class="code" href="classCGeometryBlock.html">CGeometryBlock</a> &amp;block, <font class="keywordtype">int</font> maxVertsPerBuffer )<font class="keyword"></font>
00103 {
00104    mErrorIf( block.<a class="code" href="classCGeometryBlock.html#a9">GetWordsPerVertex</a>() == 2, <font class="stringliteral">"2 word vertices not supported"</font> );
00105 
00106    <font class="comment">// interleave the vertices, normals, tex coords, and colors using</font>
00107    <font class="comment">// "skipping write" vif mode on each block of data</font>
00108    <font class="comment">// (clobbered in XferBufferHeader())</font>
00109    packet.Cnt();
00110    {
00111       packet.Stcycl(1, InputQuadsPerVert);
00112       packet.Pad128();
00113    }
00114    packet.CloseTag();
00115 
00116    <font class="comment">// return;</font>
00117 
00118    <font class="comment">//</font>
00119    <font class="comment">// loop over the strips in this geometry block</font>
00120    <font class="comment">//</font>
00121 
00122    <font class="keywordtype">int</font> numVertsToRestart = block.<a class="code" href="classCGeometryBlock.html#a49">GetNumVertsToRestartStrip</a>();
00123    <font class="keywordtype">bool</font> stripsCanBeMerged = block.<a class="code" href="classCGeometryBlock.html#a50">GetStripsCanBeMerged</a>();
00124 
00125    <font class="keywordtype">int</font> numVertsXferred = 0;
00126    <font class="keywordtype">int</font> numStripsInBuffer = 0;
00127    <font class="keywordtype">unsigned</font> <font class="keywordtype">short</font> stripOffsets[16];
00128    <font class="keywordtype">bool</font> haveContinued = <font class="keyword">false</font>;
00129    <font class="keyword">const</font> <font class="keywordtype">void</font> *normals, *vertices, *texCoords, *colors;
00130    normals = vertices = texCoords = colors = NULL;
00131    <font class="keywordtype">int</font> vu1BufferOffset = 0, stripIndex = 0, vertsInBlock = 0;
00132    <font class="comment">// keep number of verts transferred in each full buffer in sync with</font>
00133    <font class="comment">// FindNumBuffers() below</font>
00134    <font class="keywordtype">int</font> adjMaxVertsPerBuffer =
00135       maxVertsPerBuffer - (Math::IsOdd(maxVertsPerBuffer - numVertsToRestart));
00136    <font class="keywordflow">for</font> ( <font class="keywordtype">int</font> curStrip = 0; curStrip &lt; block.<a class="code" href="classCGeometryBlock.html#a48">GetNumStrips</a>(); curStrip++ ) {
00137 
00138       <font class="comment">// find the number of vu1 buffers this strip will take</font>
00139       <font class="keywordtype">int</font> numVertsFirstBuffer, numVertsLastBuffer, numBuffers;
00140       <a class="code" href="classCLinearRenderer.html#b1">FindNumBuffers</a>( block.<a class="code" href="classCGeometryBlock.html#a51">GetStripLength</a>(curStrip),
00141                       numVertsToRestart, numVertsXferred, maxVertsPerBuffer,
00142                       numVertsFirstBuffer, numVertsLastBuffer, numBuffers );
00143 
00144       <font class="comment">//</font>
00145       <font class="comment">// loop over the buffers this strip will fill (usually one)</font>
00146       <font class="comment">//</font>
00147 
00148       <font class="keywordtype">int</font> numVertsThisBuffer;
00149       <font class="keywordtype">int</font> indexIntoStrip = 0;
00150       <font class="keywordtype">int</font> vu1QuadsPerVert = InputQuadsPerVert;
00151       <font class="keywordflow">for</font> ( <font class="keywordtype">int</font> curBuffer = 0;
00152             curBuffer &lt; numBuffers;
00153             curBuffer++, indexIntoStrip += numVertsThisBuffer - numVertsToRestart ) {
00154 
00155          <font class="comment">// how many verts in this vu1 buffer?</font>
00156          <font class="keywordflow">if</font> ( curBuffer == 0 )
00157             numVertsThisBuffer = numVertsFirstBuffer;
00158          <font class="keywordflow">else</font> <font class="keywordflow">if</font> ( curBuffer == numBuffers - 1 )
00159             numVertsThisBuffer = numVertsLastBuffer;
00160          <font class="keywordflow">else</font>
00161             numVertsThisBuffer = adjMaxVertsPerBuffer;
00162 
00163          <font class="comment">// xfer the list of primitives</font>
00164 
00165          <font class="keywordflow">if</font> ( ! haveContinued ) {
00166             vertices = (block.<a class="code" href="classCGeometryBlock.html#a5">GetVerticesAreValid</a>()) ? block.<a class="code" href="classCGeometryBlock.html#a23">GetVertices</a>(curStrip) : NULL;
00167             normals = (block.<a class="code" href="classCGeometryBlock.html#a6">GetNormalsAreValid</a>()) ? block.<a class="code" href="classCGeometryBlock.html#a24">GetNormals</a>(curStrip) : NULL;
00168             texCoords = (block.<a class="code" href="classCGeometryBlock.html#a7">GetTexCoordsAreValid</a>()) ? block.<a class="code" href="classCGeometryBlock.html#a25">GetTexCoords</a>(curStrip) : NULL;
00169             colors = (block.<a class="code" href="classCGeometryBlock.html#a8">GetColorsAreValid</a>()) ? block.<a class="code" href="classCGeometryBlock.html#a26">GetColors</a>(curStrip) : NULL;
00170             vu1BufferOffset = InputGeomOffset + numVertsXferred * vu1QuadsPerVert;
00171             stripIndex = indexIntoStrip;
00172             vertsInBlock = 0;
00173          }
00174 
00175          <font class="comment">// we only want to transfer the geometry data if:</font>
00176          <font class="comment">//   - the next strip is not adjacent in memory to this one (indicated by</font>
00177          <font class="comment">//     CGeometryBlock::StripIsContinued) and so cannot be combined into</font>
00178          <font class="comment">//     one transfer</font>
00179          <font class="comment">//   - this strip spills over into the next buffer (so it must be split</font>
00180          <font class="comment">//     into more than one transfer)</font>
00181          <font class="keywordflow">if</font> ( ! block.<a class="code" href="classCGeometryBlock.html#a52">StripIsContinued</a>(curStrip)
00182               || curBuffer &lt; numBuffers - 1 ) {
00183             <a class="code" href="classCBaseRenderer.html#b5">XferBlock</a>( packet,
00184                        vertices, normals, texCoords, colors,
00185                        vu1BufferOffset,
00186                        stripIndex, vertsInBlock + numVertsThisBuffer );
00187             haveContinued = <font class="keyword">false</font>;
00188          }
00189          <font class="keywordflow">else</font> {
00190             vertsInBlock += numVertsThisBuffer;
00191             haveContinued = <font class="keyword">true</font>;
00192          }
00193 
00194          stripOffsets[numStripsInBuffer++] = numVertsXferred;
00195          mErrorIf( numStripsInBuffer &gt; 16, <font class="stringliteral">"Too many strips in buffer.. this shouldn't happen"</font> );
00196          numVertsXferred += numVertsThisBuffer;
00197 
00198          <font class="comment">// if there are more buffers in this strip, render this buffer</font>
00199          <font class="keywordflow">if</font> ( curBuffer &lt; numBuffers - 1 ) {
00200             <a class="code" href="classCLinearRenderer.html#b2">FinishBuffer</a>( packet, numVertsToRestart, numVertsXferred, vu1QuadsPerVert,
00201                           numStripsInBuffer, stripOffsets );
00202             numStripsInBuffer = 0;
00203             numVertsXferred = 0;
00204          }
00205 
00206       } <font class="comment">// end buffer loop</font>
00207 
00208       <font class="comment">// finish this buffer if:</font>
00209       <font class="comment">//   - strips of this prim type cannot be merged into a single buffer/giftag</font>
00210       <font class="comment">//   - there is too little free space left</font>
00211       <font class="comment">//   - we have filled the max number of strips per buffer</font>
00212       <font class="comment">//   - or this is the last strip</font>
00213 
00214       <font class="comment">// test against 'numVertsToRestart + 1' because FindNumBuffers() might</font>
00215       <font class="comment">// clip off one vert for backface culling</font>
00216       <font class="comment">// (maybe this should be 'adjMaxVertsPerBuffer'?)</font>
00217       <font class="keywordflow">if</font> ( ! stripsCanBeMerged
00218            || ( (maxVertsPerBuffer - numVertsXferred) &lt;= numVertsToRestart + 1 )
00219            || numStripsInBuffer == 16
00220            || (curStrip == block.<a class="code" href="classCGeometryBlock.html#a48">GetNumStrips</a>() - 1) ) {
00221          <font class="keywordflow">if</font> ( haveContinued ) {
00222             <a class="code" href="classCBaseRenderer.html#b5">XferBlock</a>( packet,
00223                        vertices, normals, texCoords, colors,
00224                        vu1BufferOffset,
00225                        stripIndex, vertsInBlock );
00226             haveContinued = <font class="keyword">false</font>;
00227          }
00228 
00229          <a class="code" href="classCLinearRenderer.html#b2">FinishBuffer</a>( packet, numVertsToRestart, numVertsXferred, vu1QuadsPerVert,
00230                        numStripsInBuffer, stripOffsets );
00231          numStripsInBuffer = 0;
00232          numVertsXferred = 0;
00233       }
00234 
00235    } <font class="comment">// end strip loop</font>
00236 }
00237 
00238 <font class="keywordtype">void</font>
<a name="l00239"></a><a class="code" href="classCLinearRenderer.html#b2">00239</a> <a class="code" href="classCLinearRenderer.html#b2">CLinearRenderer::FinishBuffer</a>( CVifSCDmaPacket &amp;packet, <font class="keywordtype">int</font> numVertsToBreakStrip,
00240                                <font class="keywordtype">int</font> numVertsInBuffer, <font class="keywordtype">int</font> vu1QuadsPerVert,
00241                                <font class="keywordtype">int</font> numStripsInBuffer, <font class="keywordtype">unsigned</font> <font class="keywordtype">short</font> *stripOffsets )<font class="keyword"></font>
00242 {
00243    packet.Cnt();
00244    {
00245       <font class="comment">// going to start a new buffer, so finish this one</font>
00246       <font class="comment">// header (giftag, etc..)</font>
00247       <a class="code" href="classCLinearRenderer.html#b3">XferBufferHeader</a>( packet, numVertsToBreakStrip,
00248                         numVertsInBuffer,
00249                         numStripsInBuffer, stripOffsets );
00250 
00251       packet.Mscnt();
00252       packet.Pad128();
00253    }
00254    packet.CloseTag();
00255 }
00256 
00257 <font class="keywordtype">void</font>
<a name="l00258"></a><a class="code" href="classCLinearRenderer.html#b1">00258</a> <a class="code" href="classCLinearRenderer.html#b1">CLinearRenderer::FindNumBuffers</a>( <font class="keywordtype">int</font> numToAdd, <font class="keywordtype">int</font> numVertsToRestart,
00259                                  <font class="keywordtype">int</font> numVertsAlreadyInFirstBuffer, <font class="keywordtype">int</font> maxVertsPerBuffer,
00260                                  <font class="keywordtype">int</font> &amp;numVertsFirstBuffer, <font class="keywordtype">int</font> &amp;numVertsLastBuffer,
00261                                  <font class="keywordtype">int</font> &amp;numBuffers )<font class="keyword"></font>
00262 {
00263    <font class="comment">// find number of buffers (chunks that will fit into vu1 mem buffers/unpack)</font>
00264 
00265    <font class="comment">// deal with the first buffer</font>
00266    <font class="keywordtype">int</font> numLeftToAdd;
00267    <font class="keywordtype">int</font> freeVertsFirstBuffer = maxVertsPerBuffer - numVertsAlreadyInFirstBuffer;
00268    <font class="keywordflow">if</font> ( numToAdd &lt;= freeVertsFirstBuffer ) {
00269       numVertsFirstBuffer = numToAdd;
00270       numLeftToAdd = 0;
00271    }
00272    <font class="keywordflow">else</font> {
00273       <font class="comment">// we only want even numbers of vertices in tri strips that are spilled</font>
00274       <font class="comment">// across buffer boundaries so that the sense of the backfacing calculation</font>
00275       <font class="comment">// remains correct in the next buffer</font>
00276       numVertsFirstBuffer = freeVertsFirstBuffer - (int)Math::IsOdd(freeVertsFirstBuffer);
00277       numLeftToAdd = numToAdd - (numVertsFirstBuffer - numVertsToRestart);
00278    }
00279    <font class="comment">// if this doesn't make sense, try drawing it..</font>
00280    <font class="keywordtype">int</font> adjVertsPerBuffer = maxVertsPerBuffer - numVertsToRestart;
00281    adjVertsPerBuffer -= (int)Math::IsOdd(adjVertsPerBuffer);
00282    numBuffers = 1 + numLeftToAdd / adjVertsPerBuffer; <font class="comment">// 1 is first buffer</font>
00283    <font class="keywordflow">if</font> ( numLeftToAdd % adjVertsPerBuffer &gt; numVertsToRestart ) numBuffers++;
00284 
00285    numVertsLastBuffer =
00286       (numBuffers &gt; 1)
00287       ? numToAdd - ((numVertsFirstBuffer - numVertsToRestart)
00288                     + (numBuffers-2) * adjVertsPerBuffer)
00289       : numToAdd;
00290 }
00291 
00292 <font class="keywordtype">void</font>
<a name="l00293"></a><a class="code" href="classCLinearRenderer.html#b3">00293</a> <a class="code" href="classCLinearRenderer.html#b3">CLinearRenderer::XferBufferHeader</a>( CVifSCDmaPacket&amp; packet,
00294                                    <font class="keywordtype">int</font> numVertsToBreakStrip,
00295                                    <font class="keywordtype">int</font> numVerts,
00296                                    <font class="keywordtype">int</font> numStripsInBuffer, <font class="keywordtype">unsigned</font> <font class="keywordtype">short</font> *stripOffsets )<font class="keyword"></font>
00297 {
00298    <font class="keywordtype">int</font> vu1OutQuadsPerVert = OutputQuadsPerVert;
00299 
00300    <font class="comment">// xfer header info for strip</font>
00301    packet.Stcycl(4,4);
00302    packet.OpenUnpack( Vifs::UnpackModes::v4_32, 0, Packet::kDoubleBuff );
00303    {
00304       <font class="comment">// num vertices</font>
00305       packet += numVerts;
00306       packet += 0; packet += (tU64)0;
00307 
00308       <font class="comment">// adc bits for the beginning of strips.. 16 24-bit values of following format:</font>
00309       <font class="comment">//   bits 0-9     : offset into output geometry (not including giftag)</font>
00310       <font class="comment">//   bit 10       : stop bit</font>
00311       <font class="comment">//   bit 11       : ADC bit of second vertex starting at offset</font>
00312       <font class="comment">// these are converted to floats to do a right shift with a fp add on vu1</font>
00313       <font class="keywordtype">unsigned</font> <font class="keywordtype">int</font> adcBits = 0;
00314       <font class="keywordflow">if</font> ( numVertsToBreakStrip == 0 )
00315          numStripsInBuffer = 0;
00316       <font class="keywordflow">else</font> <font class="keywordflow">if</font> ( numVertsToBreakStrip == 2 )
00317          adcBits = 0x800;
00318          
00319       <font class="keywordtype">float</font> adc;
00320       <font class="keywordtype">unsigned</font> <font class="keywordtype">int</font> stopBit = 0x400;
00321       <font class="keywordflow">for</font> ( <font class="keywordtype">int</font> i = 0; i &lt; 16; i++ ) {
00322          <font class="keywordflow">if</font> ( i &lt; numStripsInBuffer )
00323             adc = (float)(adcBits |
00324                           (<font class="keywordtype">unsigned</font> <font class="keywordtype">int</font>)stripOffsets[i] * vu1OutQuadsPerVert );
00325          <font class="keywordflow">else</font> <font class="keywordflow">if</font> ( i == numStripsInBuffer )
00326             adc = (float)stopBit;
00327          <font class="keywordflow">else</font>
00328             adc = (float)0;
00329          packet += adc;
00330       }
00331    }
00332    packet.CloseUnpack();
00333 
00334    <font class="comment">// restore the write cycle</font>
00335    packet.Stcycl(1, InputQuadsPerVert);
00336 }
00337 
00338 
</pre></div><hr><address><small>ps2gl version cvs</small></address>
