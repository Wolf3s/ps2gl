<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>dlgmanager.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body bgcolor="#ffffff">
<!-- Generated by Doxygen 1.2.11 -->
<center>
<a class="qindex" href="main.html">Main Page</a> &nbsp; <a class="qindex" href="modules.html">Modules</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>dlgmanager.cpp</h1><a href="dlgmanager_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <font class="comment">/*        Copyright (C) 2000,2001,2002  Sony Computer Entertainment America</font>
00002           
00003           This file is subject to the terms and conditions of the GNU Lesser
00004           General Public License Version 2.1. See the file "COPYING" in the
00005           main directory of this archive for more details.                             */
00006 
00007 <font class="preprocessor">#include "ps2s/packet.h"</font>
00008 <font class="preprocessor">#include "ps2s/math.h"</font>
00009 
00010 <font class="preprocessor">#include "<a class="code" href="dlgmanager_8h.html">ps2gl/dlgmanager.h</a>"</font>
00011 <font class="preprocessor">#include "<a class="code" href="immgmanager_8h.html">ps2gl/immgmanager.h</a>"</font>
00012 <font class="preprocessor">#include "<a class="code" href="glcontext_8h.html">ps2gl/glcontext.h</a>"</font>
00013 <font class="preprocessor">#include "<a class="code" href="dlist_8h.html">ps2gl/dlist.h</a>"</font>
00014 <font class="preprocessor">#include "<a class="code" href="texture_8h.html">ps2gl/texture.h</a>"</font>
00015 <font class="preprocessor">#include "<a class="code" href="lighting_8h.html">ps2gl/lighting.h</a>"</font>
00016 <font class="preprocessor">#include "<a class="code" href="material_8h.html">ps2gl/material.h</a>"</font>
00017 <font class="preprocessor">#include "<a class="code" href="renderer_8h.html">ps2gl/renderer.h</a>"</font>
00018 
00019 <font class="keyword">using</font> <font class="keyword">namespace </font>ArrayType;
00020 
00021 <font class="comment">/********************************************</font>
00022  * methods
00023  */
00024 
<a name="l00025"></a><a class="code" href="classCDListGeomManager.html#a0">00025</a> <a class="code" href="classCDListGeomManager.html#a0">CDListGeomManager::CDListGeomManager</a>( <a class="code" href="classCGLContext.html">CGLContext</a> &amp;context )
00026    : <a class="code" href="classCGeomManager.html">CGeomManager</a>(context),
00027      CurDList(NULL),
00028      RendererMayHaveChanged(false)
00029 {
00030 }
00031 
00032 <font class="keywordtype">void</font>
<a name="l00033"></a><a class="code" href="classCDListGeomManager.html#a6">00033</a> <a class="code" href="classCDListGeomManager.html#a6">CDListGeomManager::BeginDListDef</a>()<font class="keyword"></font>
00034 {
00035    Prim = <a class="code" href="gl_8h.html#a513">GL_INVALID_VALUE</a>;
00036    Geometry.<a class="code" href="classCGeometryBlock.html#a58">Reset</a>();
00037 
00038    <a class="code" href="classCDList.html">CDList</a> &amp;dlist = GLContext.GetDListManager().GetOpenDList();
00039    CurDList = &amp; dlist;
00040 
00041    LastArrayAccessIsValid = <font class="keyword">false</font>;
00042 }
00043 
00044 <font class="keywordtype">void</font>
<a name="l00045"></a><a class="code" href="classCDListGeomManager.html#a7">00045</a> <a class="code" href="classCDListGeomManager.html#a7">CDListGeomManager::EndDListDef</a>()<font class="keyword"></font>
00046 {
00047    <a class="code" href="classCDListGeomManager.html#a16">Flush</a>();
00048 
00049    CurNormalBuf = NULL;
00050    CurVertexBuf = NULL;
00051    CurTexCoordBuf = NULL;
00052    CurColorBuf = NULL;
00053 
00054    CurDList = NULL;
00055 }
00056 
00057 <font class="keywordtype">void</font>
<a name="l00058"></a><a class="code" href="classCDListGeomManager.html#a16">00058</a> <a class="code" href="classCDListGeomManager.html#a16">CDListGeomManager::Flush</a>()<font class="keyword"></font>
00059 {
00060    <font class="keywordflow">if</font> ( Geometry.<a class="code" href="classCGeometryBlock.html#a59">IsPending</a>() ) {
00061       DrawBlock( Geometry );
00062       Geometry.<a class="code" href="classCGeometryBlock.html#a58">Reset</a>();
00063    }
00064 }
00065 
00066 <font class="comment">/********************************************</font>
00067  * glBegin/glEnd
00068  */
00069 
00070 <font class="keywordtype">void</font>
<a name="l00071"></a><a class="code" href="classCDListGeomManager.html#a8">00071</a> <a class="code" href="classCDListGeomManager.html#a8">CDListGeomManager::BeginGeom</a>( <a class="code" href="gl_8h.html#a687">GLenum</a> mode )<font class="keyword"></font>
00072 {
00073    <font class="keywordflow">if</font> ( Prim != mode ) <a class="code" href="classCDListGeomManager.html#a2">PrimChanged</a>(mode);
00074 
00075    <a class="code" href="classCDList.html">CDList</a> &amp;dlist = GLContext.GetDListManager().GetOpenDList();
00076    CurNormalBuf = &amp; dlist.<a class="code" href="classCDList.html#a8">GetNormalBuf</a>();
00077    CurVertexBuf = &amp; dlist.<a class="code" href="classCDList.html#a7">GetVertexBuf</a>();
00078    CurTexCoordBuf = &amp; dlist.<a class="code" href="classCDList.html#a9">GetTexCoordBuf</a>();
00079    CurColorBuf = &amp; dlist.<a class="code" href="classCDList.html#a10">GetColorBuf</a>();
00080 
00081    Geometry.<a class="code" href="classCGeometryBlock.html#a34">SetPrimType</a>( mode );
00082    Geometry.<a class="code" href="classCGeometryBlock.html#a17">SetArrayType</a>(kLinear);
00083    Geometry.<a class="code" href="classCGeometryBlock.html#a30">SetNormals</a>( CurNormalBuf-&gt;GetNextPtr() );
00084    Geometry.<a class="code" href="classCGeometryBlock.html#a29">SetVertices</a>( CurVertexBuf-&gt;GetNextPtr() );
00085    Geometry.<a class="code" href="classCGeometryBlock.html#a31">SetTexCoords</a>( CurTexCoordBuf-&gt;GetNextPtr() );
00086    Geometry.<a class="code" href="classCGeometryBlock.html#a32">SetColors</a>( CurColorBuf-&gt;GetNextPtr() );
00087 
00088    InsideBeginEnd = <font class="keyword">true</font>;
00089 }
00090 
00091 <font class="keywordtype">void</font>
<a name="l00092"></a><a class="code" href="classCDListGeomManager.html#a9">00092</a> <a class="code" href="classCDListGeomManager.html#a9">CDListGeomManager::Vertex</a>( cpu_vec_xyzw newVert )<font class="keyword"></font>
00093 {
00094    *CurVertexBuf += newVert;
00095 
00096    Geometry.<a class="code" href="classCGeometryBlock.html#a40">AddVertices</a>();
00097 }
00098 
<a name="l00099"></a><a class="code" href="classCSetNormalCmd.html">00099</a> <font class="keyword">class </font><a class="code" href="classCSetNormalCmd.html">CSetNormalCmd</a> : <font class="keyword">public</font> <a class="code" href="classCDListCmd.html">CDListCmd</a> {
00100       cpu_vec_xyz       Normal;
00101    <font class="keyword">public</font>:
<a name="l00102"></a><a class="code" href="classCSetNormalCmd.html#a0">00102</a>       <a class="code" href="classCSetNormalCmd.html#a0">CSetNormalCmd</a>( cpu_vec_xyz normal ) : Normal(normal) {}
<a name="l00103"></a><a class="code" href="classCSetNormalCmd.html#a1">00103</a>       <a class="code" href="classCDListCmd.html">CDListCmd</a>* <a class="code" href="classCDListCmd.html#a1">Play</a>()<font class="keyword"> </font>{
00104          pGLContext-&gt;GetImmGeomManager().Normal(Normal);
00105          <font class="keywordflow">return</font> <a class="code" href="classCDListCmd.html#d1">CDListCmd::GetNextCmd</a>( <font class="keyword">this</font> );
00106       }
00107 };
00108 
00109 <font class="keywordtype">void</font>
<a name="l00110"></a><a class="code" href="classCDListGeomManager.html#a10">00110</a> <a class="code" href="classCDListGeomManager.html#a10">CDListGeomManager::Normal</a>( cpu_vec_xyz normal )<font class="keyword"></font>
00111 {
00112    <font class="keywordflow">if</font> ( DoNormalize ) normal.normalize();
00113 
00114    <font class="keywordflow">if</font> ( InsideBeginEnd ) {
00115       CurNormal = normal;
00116 
00117       *CurNormalBuf += normal(0);
00118       *CurNormalBuf += normal(1);
00119       *CurNormalBuf += normal(2);
00120 
00121       Geometry.<a class="code" href="classCGeometryBlock.html#a41">AddNormals</a>();
00122    }
00123    <font class="keywordflow">else</font> {
00124       <font class="comment">// make sure we don't set this normal before any pending</font>
00125       <font class="comment">// geometry that depends on the current normal (the one before</font>
00126       <font class="comment">// setting this one)</font>
00127       <a class="code" href="classCDListGeomManager.html#a16">Flush</a>();
00128       *CurDList += CSetNormalCmd( normal );
00129    }
00130 }
00131 
<a name="l00132"></a><a class="code" href="classCColorCmd.html">00132</a> <font class="keyword">class </font><a class="code" href="classCColorCmd.html">CColorCmd</a> : <font class="keyword">public</font> <a class="code" href="classCDListCmd.html">CDListCmd</a> {
00133       cpu_vec_xyzw      CurColor;
00134    <font class="keyword">public</font>:
<a name="l00135"></a><a class="code" href="classCColorCmd.html#a0">00135</a>       <a class="code" href="classCColorCmd.html#a0">CColorCmd</a>( cpu_vec_xyzw color ) : CurColor(color) {}
<a name="l00136"></a><a class="code" href="classCColorCmd.html#a1">00136</a>       <a class="code" href="classCDListCmd.html">CDListCmd</a>* <a class="code" href="classCDListCmd.html#a1">Play</a>()<font class="keyword"> </font>{
00137          pGLContext-&gt;GetMaterialManager().Color(CurColor);
00138          <font class="keywordflow">return</font> <a class="code" href="classCDListCmd.html#d1">CDListCmd::GetNextCmd</a>(<font class="keyword">this</font>);
00139       }
00140 };
00141 
00142 <font class="keywordtype">void</font>
<a name="l00143"></a><a class="code" href="classCDListGeomManager.html#a12">00143</a> <a class="code" href="classCDListGeomManager.html#a12">CDListGeomManager::Color</a>( cpu_vec_xyzw color )<font class="keyword"></font>
00144 {
00145    <font class="keywordflow">if</font> ( InsideBeginEnd ) {
00146       *CurColorBuf += color;
00147 
00148       Geometry.<a class="code" href="classCGeometryBlock.html#a43">AddColors</a>();
00149    }
00150    <font class="keywordflow">else</font> {
00151       <a class="code" href="classCDList.html">CDList</a> &amp;dlist = GLContext.GetDListManager().GetOpenDList();
00152       dlist += CColorCmd( color );
00153       GLContext.CurMaterialChanged();
00154    }
00155 }
00156 
<a name="l00157"></a><a class="code" href="classCSetTexCoordCmd.html">00157</a> <font class="keyword">class </font><a class="code" href="classCSetTexCoordCmd.html">CSetTexCoordCmd</a> : <font class="keyword">public</font> <a class="code" href="classCDListCmd.html">CDListCmd</a> {
00158       <font class="keywordtype">float</font>     U, V;
00159    <font class="keyword">public</font>:
<a name="l00160"></a><a class="code" href="classCSetTexCoordCmd.html#a0">00160</a>       <a class="code" href="classCSetTexCoordCmd.html#a0">CSetTexCoordCmd</a>( <font class="keywordtype">float</font> u, <font class="keywordtype">float</font> v ) : U(u), V(v) {}
<a name="l00161"></a><a class="code" href="classCSetTexCoordCmd.html#a1">00161</a>       <a class="code" href="classCDListCmd.html">CDListCmd</a>* <a class="code" href="classCDListCmd.html#a1">Play</a>()<font class="keyword"> </font>{
00162          pGLContext-&gt;GetImmGeomManager().TexCoord(U,V);
00163          <font class="keywordflow">return</font> <a class="code" href="classCDListCmd.html#d1">CDListCmd::GetNextCmd</a>( <font class="keyword">this</font> );
00164       }
00165 };
00166 
00167 <font class="keywordtype">void</font>
<a name="l00168"></a><a class="code" href="classCDListGeomManager.html#a11">00168</a> <a class="code" href="classCDListGeomManager.html#a11">CDListGeomManager::TexCoord</a>( <font class="keywordtype">float</font> u, <font class="keywordtype">float</font> v )<font class="keyword"></font>
00169 {
00170    <font class="keywordflow">if</font> ( InsideBeginEnd ) {
00171       CurTexCoord[0] = u; CurTexCoord[1] = v;
00172 
00173       *CurTexCoordBuf += u;
00174       *CurTexCoordBuf += v;
00175 
00176       Geometry.<a class="code" href="classCGeometryBlock.html#a42">AddTexCoords</a>();
00177    }
00178    <font class="keywordflow">else</font> {
00179       <a class="code" href="classCDListGeomManager.html#a16">Flush</a>(); <font class="comment">// see note for Normal</font>
00180       *CurDList += CSetTexCoordCmd( u, v );
00181    }
00182 }
00183 
00184 <font class="keywordtype">void</font>
<a name="l00185"></a><a class="code" href="classCDListGeomManager.html#a13">00185</a> <a class="code" href="classCDListGeomManager.html#a13">CDListGeomManager::EndGeom</a>()<font class="keyword"></font>
00186 {
00187    InsideBeginEnd = <font class="keyword">false</font>;
00188 
00189    Geometry.<a class="code" href="classCGeometryBlock.html#a13">SetWordsPerVertex</a>(4);
00190    Geometry.<a class="code" href="classCGeometryBlock.html#a14">SetWordsPerNormal</a>(3);
00191    Geometry.<a class="code" href="classCGeometryBlock.html#a15">SetWordsPerTexCoord</a>(2);
00192    Geometry.<a class="code" href="classCGeometryBlock.html#a16">SetWordsPerColor</a>(4);
00193 
00194    Geometry.<a class="code" href="classCGeometryBlock.html#a1">SetVerticesAreValid</a>(<font class="keyword">true</font>);
00195 
00196    <font class="comment">// if no normals were added use whatever the current normal is at list execution,</font>
00197    <font class="comment">// if 1 normal was added, set that as the current normal,</font>
00198    <font class="comment">// if more than one normal was added, assume there was one normal per vertex, and</font>
00199    <font class="comment">// set the last to be the current normal</font>
00200    Geometry.<a class="code" href="classCGeometryBlock.html#a2">SetNormalsAreValid</a>(<font class="keyword">false</font>);
00201    <font class="keywordflow">if</font> ( Geometry.<a class="code" href="classCGeometryBlock.html#a36">GetNumNewNormals</a>() &gt; 0 ) {
00202       <font class="comment">// make last normal current</font>
00203       *CurDList += CSetNormalCmd( CurNormal );
00204 
00205       <font class="keywordflow">if</font> ( Geometry.<a class="code" href="classCGeometryBlock.html#a36">GetNumNewNormals</a>() &gt; 1 ) {
00206          mErrorIf( Geometry.<a class="code" href="classCGeometryBlock.html#a35">GetNumNewVertices</a>() != Geometry.<a class="code" href="classCGeometryBlock.html#a36">GetNumNewNormals</a>(),
00207                    <font class="stringliteral">"Sorry, but in display lists you need to specify either one normal, "</font>
00208                    <font class="stringliteral">"or a normal for each vertex given."</font> );
00209          Geometry.<a class="code" href="classCGeometryBlock.html#a2">SetNormalsAreValid</a>(<font class="keyword">true</font>);
00210       }
00211    }
00212 
00213    <font class="comment">// tex coord data</font>
00214    Geometry.<a class="code" href="classCGeometryBlock.html#a3">SetTexCoordsAreValid</a>(<font class="keyword">false</font>);
00215    <font class="keywordflow">if</font> ( Geometry.<a class="code" href="classCGeometryBlock.html#a37">GetNumNewTexCoords</a>() &gt; 0 ) {
00216       <font class="comment">// make last tex coord current</font>
00217       *CurDList += CSetTexCoordCmd( CurTexCoord[0], CurTexCoord[1] );
00218 
00219       mErrorIf( Geometry.<a class="code" href="classCGeometryBlock.html#a35">GetNumNewVertices</a>() != Geometry.<a class="code" href="classCGeometryBlock.html#a37">GetNumNewTexCoords</a>(),
00220                 <font class="stringliteral">"Sorry, but in display lists you need to specify either one "</font>
00221                 <font class="stringliteral">"texture coord for each vertex given, or zero."</font> );
00222       Geometry.<a class="code" href="classCGeometryBlock.html#a3">SetTexCoordsAreValid</a>(<font class="keyword">true</font>);
00223    }
00224 
00225    <font class="comment">// colors</font>
00226    <font class="keywordflow">if</font> ( Geometry.<a class="code" href="classCGeometryBlock.html#a38">GetNumNewColors</a>() &gt; 0 ) {
00227       mErrorIf( Geometry.<a class="code" href="classCGeometryBlock.html#a35">GetNumNewVertices</a>() != Geometry.<a class="code" href="classCGeometryBlock.html#a38">GetNumNewColors</a>(),
00228                 <font class="stringliteral">"Sorry, but in display lists inside glBegin/glEnd you need "</font>
00229                 <font class="stringliteral">"to specify either one color for each vertex given, or none."</font> );
00230       Geometry.<a class="code" href="classCGeometryBlock.html#a4">SetColorsAreValid</a>(<font class="keyword">true</font>);
00231    }
00232    <font class="keywordflow">else</font> {
00233       Geometry.<a class="code" href="classCGeometryBlock.html#a4">SetColorsAreValid</a>(<font class="keyword">false</font>);
00234       Geometry.<a class="code" href="classCGeometryBlock.html#a32">SetColors</a>(NULL);
00235    }
00236 
00237    CommitNewGeom();
00238 }
00239 
00240 <font class="comment">/********************************************</font>
00241  * DrawArrays
00242  */
00243 
00244 <font class="keywordtype">void</font>
<a name="l00245"></a><a class="code" href="classCDListGeomManager.html#a14">00245</a> <a class="code" href="classCDListGeomManager.html#a14">CDListGeomManager::DrawArrays</a>( <a class="code" href="gl_8h.html#a687">GLenum</a> mode, <font class="keywordtype">int</font> first, <font class="keywordtype">int</font> count )<font class="keyword"></font>
00246 {
00247    <font class="keywordflow">if</font> ( Prim != mode ) <a class="code" href="classCDListGeomManager.html#a2">PrimChanged</a>(mode);
00248 
00249    Geometry.<a class="code" href="classCGeometryBlock.html#a34">SetPrimType</a>(mode);
00250    Geometry.<a class="code" href="classCGeometryBlock.html#a17">SetArrayType</a>(kLinear);
00251 
00252    Geometry.<a class="code" href="classCGeometryBlock.html#a29">SetVertices</a>( VertArray-&gt;GetVertices() );
00253    Geometry.<a class="code" href="classCGeometryBlock.html#a30">SetNormals</a>( VertArray-&gt;GetNormals() );
00254    Geometry.<a class="code" href="classCGeometryBlock.html#a31">SetTexCoords</a>( VertArray-&gt;GetTexCoords() );
00255    Geometry.<a class="code" href="classCGeometryBlock.html#a32">SetColors</a>( VertArray-&gt;GetColors() );
00256 
00257    Geometry.<a class="code" href="classCGeometryBlock.html#a1">SetVerticesAreValid</a>( VertArray-&gt;GetVerticesAreValid() );
00258    Geometry.<a class="code" href="classCGeometryBlock.html#a2">SetNormalsAreValid</a>( VertArray-&gt;GetNormalsAreValid() );
00259    Geometry.<a class="code" href="classCGeometryBlock.html#a3">SetTexCoordsAreValid</a>( VertArray-&gt;GetTexCoordsAreValid() );
00260    Geometry.<a class="code" href="classCGeometryBlock.html#a4">SetColorsAreValid</a>( VertArray-&gt;GetColorsAreValid() );
00261 
00262    Geometry.<a class="code" href="classCGeometryBlock.html#a13">SetWordsPerVertex</a>( VertArray-&gt;GetWordsPerVertex() );
00263    Geometry.<a class="code" href="classCGeometryBlock.html#a14">SetWordsPerNormal</a>( VertArray-&gt;GetWordsPerNormal() );
00264    Geometry.<a class="code" href="classCGeometryBlock.html#a15">SetWordsPerTexCoord</a>( VertArray-&gt;GetWordsPerTexCoord() );
00265    Geometry.<a class="code" href="classCGeometryBlock.html#a16">SetWordsPerColor</a>( VertArray-&gt;GetWordsPerColor() );
00266 
00267    Geometry.<a class="code" href="classCGeometryBlock.html#a40">AddVertices</a>(count);
00268    Geometry.<a class="code" href="classCGeometryBlock.html#a41">AddNormals</a>(count);
00269    Geometry.<a class="code" href="classCGeometryBlock.html#a42">AddTexCoords</a>(count);
00270    Geometry.<a class="code" href="classCGeometryBlock.html#a43">AddColors</a>(count);
00271 
00272    Geometry.<a class="code" href="classCGeometryBlock.html#a62">AdjustNewGeomPtrs</a>( first );
00273 
00274    CommitNewGeom();
00275 }
00276 
00277 <font class="keywordtype">void</font>
<a name="l00278"></a><a class="code" href="classCDListGeomManager.html#a15">00278</a> <a class="code" href="classCDListGeomManager.html#a15">CDListGeomManager::DrawIndexedArrays</a>( <a class="code" href="gl_8h.html#a687">GLenum</a> primType,
00279                                       <font class="keywordtype">int</font> numIndices, <font class="keyword">const</font> <font class="keywordtype">unsigned</font> <font class="keywordtype">char</font>* indices,
00280                                       <font class="keywordtype">int</font> numVertices )<font class="keyword"></font>
00281 {
00282    <font class="keywordflow">if</font> ( Prim != primType ) <a class="code" href="classCDListGeomManager.html#a2">PrimChanged</a>(primType);
00283 
00284    Geometry.<a class="code" href="classCGeometryBlock.html#a34">SetPrimType</a>(primType);
00285    Geometry.<a class="code" href="classCGeometryBlock.html#a17">SetArrayType</a>(kIndexed);
00286 
00287    Geometry.<a class="code" href="classCGeometryBlock.html#a29">SetVertices</a>( VertArray-&gt;GetVertices() );
00288    Geometry.<a class="code" href="classCGeometryBlock.html#a30">SetNormals</a>( VertArray-&gt;GetNormals() );
00289    Geometry.<a class="code" href="classCGeometryBlock.html#a31">SetTexCoords</a>( VertArray-&gt;GetTexCoords() );
00290    Geometry.<a class="code" href="classCGeometryBlock.html#a32">SetColors</a>( VertArray-&gt;GetColors() );
00291 
00292    Geometry.<a class="code" href="classCGeometryBlock.html#a1">SetVerticesAreValid</a>( VertArray-&gt;GetVerticesAreValid() );
00293    Geometry.<a class="code" href="classCGeometryBlock.html#a2">SetNormalsAreValid</a>( VertArray-&gt;GetNormalsAreValid() );
00294    Geometry.<a class="code" href="classCGeometryBlock.html#a3">SetTexCoordsAreValid</a>( VertArray-&gt;GetTexCoordsAreValid() );
00295    Geometry.<a class="code" href="classCGeometryBlock.html#a4">SetColorsAreValid</a>( VertArray-&gt;GetColorsAreValid() );
00296 
00297    Geometry.<a class="code" href="classCGeometryBlock.html#a13">SetWordsPerVertex</a>( VertArray-&gt;GetWordsPerVertex() );
00298    Geometry.<a class="code" href="classCGeometryBlock.html#a14">SetWordsPerNormal</a>( VertArray-&gt;GetWordsPerNormal() );
00299    Geometry.<a class="code" href="classCGeometryBlock.html#a15">SetWordsPerTexCoord</a>( VertArray-&gt;GetWordsPerTexCoord() );
00300    Geometry.<a class="code" href="classCGeometryBlock.html#a16">SetWordsPerColor</a>( VertArray-&gt;GetWordsPerColor() );
00301 
00302    Geometry.<a class="code" href="classCGeometryBlock.html#a40">AddVertices</a>(numVertices);
00303    Geometry.<a class="code" href="classCGeometryBlock.html#a41">AddNormals</a>(numVertices);
00304    Geometry.<a class="code" href="classCGeometryBlock.html#a42">AddTexCoords</a>(numVertices);
00305    Geometry.<a class="code" href="classCGeometryBlock.html#a43">AddColors</a>(numVertices);
00306 
00307    Geometry.<a class="code" href="classCGeometryBlock.html#a20">SetNumIndices</a>(numIndices);
00308    Geometry.<a class="code" href="classCGeometryBlock.html#a21">SetIndices</a>(indices);
00309    Geometry.<a class="code" href="classCGeometryBlock.html#a22">SetIStripLengths</a>(NULL);
00310 
00311    CommitNewGeom();
00312 }
00313 
00314 <font class="comment">/********************************************</font>
00315  * methods / dlist commands that update state
00316  */
00317 
<a name="l00318"></a><a class="code" href="classCUpdateRendererContextCmd.html">00318</a> <font class="keyword">class </font><a class="code" href="classCUpdateRendererContextCmd.html">CUpdateRendererContextCmd</a> : <font class="keyword">public</font> <a class="code" href="classCDListCmd.html">CDListCmd</a> {
00319       <a class="code" href="gl_8h.html#a687">GLenum</a> PrimType;
00320    <font class="keyword">public</font>:
<a name="l00321"></a><a class="code" href="classCUpdateRendererContextCmd.html#a0">00321</a>       <a class="code" href="classCUpdateRendererContextCmd.html#a0">CUpdateRendererContextCmd</a>( <a class="code" href="gl_8h.html#a687">GLenum</a> type ) : PrimType(type) {}
<a name="l00322"></a><a class="code" href="classCUpdateRendererContextCmd.html#a1">00322</a>       <a class="code" href="classCDListCmd.html">CDListCmd</a>* <a class="code" href="classCDListCmd.html#a1">Play</a>()<font class="keyword"> </font>{
00323          <a class="code" href="classCImmGeomManager.html">CImmGeomManager</a> &amp;gmanager = pGLContext-&gt;GetImmGeomManager();
00324          gmanager.<a class="code" href="classCImmGeomManager.html#a5">SyncRendererContext</a>(PrimType);
00325          <font class="keywordflow">return</font> <a class="code" href="classCDListCmd.html#d1">CDListCmd::GetNextCmd</a>(<font class="keyword">this</font>);
00326       }
00327 };
00328 
<a name="l00329"></a><a class="code" href="classCUpdatePrimCmd.html">00329</a> <font class="keyword">class </font><a class="code" href="classCUpdatePrimCmd.html">CUpdatePrimCmd</a> : <font class="keyword">public</font> <a class="code" href="classCDListCmd.html">CDListCmd</a> {
00330       <font class="keywordtype">unsigned</font> <font class="keywordtype">char</font>     Prim;
00331    <font class="keyword">public</font>:
<a name="l00332"></a><a class="code" href="classCUpdatePrimCmd.html#a0">00332</a>       <a class="code" href="classCUpdatePrimCmd.html#a0">CUpdatePrimCmd</a>( <font class="keywordtype">unsigned</font> <font class="keywordtype">char</font> prim ) : Prim(prim) {}
<a name="l00333"></a><a class="code" href="classCUpdatePrimCmd.html#a1">00333</a>       <a class="code" href="classCDListCmd.html">CDListCmd</a>* <a class="code" href="classCDListCmd.html#a1">Play</a>()<font class="keyword"> </font>{
00334          pGLContext-&gt;GetImmGeomManager().GetRendererManager().PrimChanged(Prim);
00335          <font class="keywordflow">return</font> <a class="code" href="classCDListCmd.html#d1">CDListCmd::GetNextCmd</a>(<font class="keyword">this</font>);
00336       }
00337 };
00338 
00339 <font class="keywordtype">void</font>
<a name="l00340"></a><a class="code" href="classCDListGeomManager.html#a2">00340</a> <a class="code" href="classCDListGeomManager.html#a2">CDListGeomManager::PrimChanged</a>( <font class="keywordtype">unsigned</font> <font class="keywordtype">char</font> prim )<font class="keyword"></font>
00341 {
00342    GLContext.PrimChanged();
00343    GLContext.GetDListManager().GetOpenDList() += CUpdatePrimCmd(prim);
00344 }
00345 
<a name="l00346"></a><a class="code" href="classCUpdateRendererCmd.html">00346</a> <font class="keyword">class </font><a class="code" href="classCUpdateRendererCmd.html">CUpdateRendererCmd</a> : <font class="keyword">public</font> <a class="code" href="classCDListCmd.html">CDListCmd</a> {
00347       <font class="keywordtype">bool</font>              PerVtxColors;
00348       <a class="code" href="namespaceArrayType.html#a3">tArrayType</a>        ArrayType;
00349    <font class="keyword">public</font>:
<a name="l00350"></a><a class="code" href="classCUpdateRendererCmd.html#a0">00350</a>       <a class="code" href="classCUpdateRendererCmd.html#a0">CUpdateRendererCmd</a>( <font class="keywordtype">bool</font> pvColors, <a class="code" href="namespaceArrayType.html#a3">tArrayType</a> type )
00351          : PerVtxColors(pvColors), ArrayType(type) {}
<a name="l00352"></a><a class="code" href="classCUpdateRendererCmd.html#a1">00352</a>       <a class="code" href="classCDListCmd.html">CDListCmd</a>* <a class="code" href="classCDListCmd.html#a1">Play</a>()<font class="keyword"> </font>{
00353          <a class="code" href="classCImmGeomManager.html">CImmGeomManager</a> &amp;gmanager = pGLContext-&gt;GetImmGeomManager();
00354          gmanager.<a class="code" href="classCImmGeomManager.html#a8">SyncColorMaterial</a>(PerVtxColors);
00355          gmanager.<a class="code" href="classCImmGeomManager.html#a11">SyncArrayType</a>(ArrayType);
00356          gmanager.<a class="code" href="classCImmGeomManager.html#a6">SyncRenderer</a>();
00357          <font class="keywordflow">return</font> <a class="code" href="classCDListCmd.html#d1">CDListCmd::GetNextCmd</a>(<font class="keyword">this</font>);
00358       }
00359 };
00360 
<a name="l00361"></a><a class="code" href="classCUpdateGsContextCmd.html">00361</a> <font class="keyword">class </font><a class="code" href="classCUpdateGsContextCmd.html">CUpdateGsContextCmd</a> : <font class="keyword">public</font> <a class="code" href="classCDListCmd.html">CDListCmd</a> {
00362    <font class="keyword">public</font>:
<a name="l00363"></a><a class="code" href="classCUpdateGsContextCmd.html#a0">00363</a>       <a class="code" href="classCDListCmd.html">CDListCmd</a>* <a class="code" href="classCDListCmd.html#a1">Play</a>()<font class="keyword"> </font>{
00364          pGLContext-&gt;GetImmGeomManager().SyncGsContext();
00365          <font class="keywordflow">return</font> <a class="code" href="classCDListCmd.html#d1">CDListCmd::GetNextCmd</a>(<font class="keyword">this</font>);
00366       }
00367 };
00368 
00369 <font class="comment">/********************************************</font>
00370  * render-related methods/commands
00371  */
00372 
00373 <font class="keywordtype">void</font>
00374 CDListGeomManager::DrawingLinearArray()<font class="keyword"></font>
00375 {
00376    <font class="keywordflow">if</font> ( ! LastArrayAccessIsValid || LastArrayAccessWasIndexed ) {
00377       GLContext.ArrayAccessChanged();
00378       LastArrayAccessIsValid = <font class="keyword">true</font>;
00379    }
00380    LastArrayAccessWasIndexed = <font class="keyword">false</font>;
00381 }
00382 
00383 <font class="keywordtype">void</font>
00384 CDListGeomManager::DrawingIndexedArray()<font class="keyword"></font>
00385 {
00386    <font class="keywordflow">if</font> ( ! LastArrayAccessIsValid || ! LastArrayAccessWasIndexed ) {
00387       GLContext.ArrayAccessChanged();
00388       LastArrayAccessIsValid = <font class="keyword">true</font>;
00389    }
00390    LastArrayAccessWasIndexed = <font class="keyword">true</font>;
00391 }
00392 
00393 <font class="keywordtype">void</font>
00394 CDListGeomManager::CommitNewGeom()<font class="keyword"></font>
00395 {
00396    <font class="comment">// do this before updating the renderer</font>
00397    <font class="keywordflow">if</font> ( Geometry.GetNewArrayType() == kLinear )
00398       DrawingLinearArray();
00399    <font class="keywordflow">else</font>
00400       DrawingIndexedArray();
00401 
00402    <font class="keywordtype">bool</font> doReset = <font class="keyword">true</font>;
00403 
00404    <font class="keywordflow">if</font> ( Geometry.IsPending() ) {
00405       <font class="comment">// if the context hasn't changed, try to merge the new geometry</font>
00406       <font class="comment">// into the current block</font>
00407       <font class="keywordflow">if</font> ( GLContext.GetRendererContextChanged() == 0
00408            &amp;&amp; GLContext.GetGsContextChanged() == 0
00409            &amp;&amp; ! UserRenderContextChanged
00410            &amp;&amp; GLContext.GetRendererPropsChanged() == 0
00411            &amp;&amp; Geometry.MergeNew() )
00412          doReset = <font class="keyword">false</font>;
00413       <font class="comment">// couldn't merge; draw the old geometry so we can reset and start a new block</font>
00414       <font class="keywordflow">else</font> {
00415          DrawBlock( Geometry );
00416       }
00417    }
00418 
00419    <font class="keywordflow">if</font> ( doReset ) {
00420       Geometry.MakeNewValuesCurrent();
00421       Geometry.ResetNew(); <font class="comment">// if we don't do this counts will keep accumulating</font>
00422 
00423       <font class="keywordflow">if</font> ( GLContext.GetRendererPropsChanged() ) {
00424          *CurDList += CUpdateRendererCmd(Geometry.GetColorsAreValid(), Geometry.GetArrayType());
00425          GLContext.SetRendererPropsChanged(<font class="keyword">false</font>);
00426          GLContext.SetRendererContextChanged(<font class="keyword">true</font>);
00427       }
00428       <font class="keywordflow">if</font> ( GLContext.GetRendererContextChanged() ) {
00429          *CurDList += CUpdateRendererContextCmd(Geometry.GetPrimType());
00430          GLContext.SetRendererContextChanged(<font class="keyword">false</font>);
00431          Prim = Geometry.GetPrimType();
00432       }
00433       <font class="keywordflow">if</font> ( GLContext.GetGsContextChanged() ) {
00434          *CurDList += CUpdateGsContextCmd();
00435          GLContext.SetGsContextChanged(<font class="keyword">false</font>);
00436       }
00437       <font class="keywordflow">if</font> ( UserRenderContextChanged ) {
00438          <font class="comment">// not much point in adding this into the dl since there's no way now of</font>
00439          <font class="comment">// adding the user context change into the dl..</font>
00440          <font class="comment">// might be useful to break things up, though..</font>
00441          UserRenderContextChanged = <font class="keyword">false</font>;
00442       }
00443 
00444    }
00445 }
00446 
<a name="l00447"></a><a class="code" href="classCDrawArraysCmd.html">00447</a> <font class="keyword">class </font><a class="code" href="classCDrawArraysCmd.html">CDrawArraysCmd</a> : <font class="keyword">public</font> <a class="code" href="classCDListCmd.html">CDListCmd</a> {
00448       <a class="code" href="classCGeometryBlock.html">CGeometryBlock</a>    Geometry;
00449       <font class="keywordtype">bool</font>              IsCached;
00450       <a class="code" href="classCDList.html">CDList</a>            &amp;DList;
00451       CVifSCDmaPacket   *RenderPacket;
00452       tU64              RenderContextDependencies, RenderContextDepMask;
00453    <font class="keyword">public</font>:
<a name="l00454"></a><a class="code" href="classCDrawArraysCmd.html#a0">00454</a>       <a class="code" href="classCDrawArraysCmd.html#a0">CDrawArraysCmd</a>( <a class="code" href="classCGeometryBlock.html">CGeometryBlock</a> &amp;block, <a class="code" href="classCDList.html">CDList</a> &amp;dlist )
00455          : Geometry(block), IsCached(false), DList(dlist), RenderPacket(NULL)
00456       {}
00457 
<a name="l00458"></a><a class="code" href="classCDrawArraysCmd.html#a1">00458</a>       <a class="code" href="classCDListCmd.html">CDListCmd</a>* <a class="code" href="classCDListCmd.html#a1">Play</a>()<font class="keyword"> </font>{
00459 
00460          <font class="comment">// ** do not ** update the renderer context here; it will have</font>
00461          <font class="comment">// been taken care of by other dlist commands</font>
00462 
00463          <font class="comment">// first, check to see if the packet needs to be rebuilt.  This decision</font>
00464          <font class="comment">// is based on what the renderer tells us that it cares about.  The</font>
00465          <font class="comment">// default renderers, for example, will generate packets that embed</font>
00466          <font class="comment">// whether texture mapping is enabled and so will need to be rebuilt if</font>
00467          <font class="comment">// the packet is called in a context different from that in which it was</font>
00468          <font class="comment">// first created.</font>
00469 
00470          tU64 curRenderContext = (tU64)pGLContext-&gt;GetImmGeomManager().GetRendererManager().GetRendererReqs();
00471          tU64 curRenderContextDeps = curRenderContext &amp; RenderContextDepMask;
00472          <font class="keywordtype">bool</font> rebuildPacket = ( curRenderContextDeps != RenderContextDependencies );
00473 
00474          <font class="comment">// [re]build cached dma packet</font>
00475 
00476          <font class="keywordflow">if</font> ( ! IsCached || rebuildPacket ) {
00477 
00478             <font class="comment">// we need to build the packet to render this array</font>
00479 
00480             <font class="comment">// first, can it be built once and reused?</font>
00481             <a class="code" href="classCImmGeomManager.html">CImmGeomManager</a> &amp;gmanager = pGLContext-&gt;GetImmGeomManager();
00482             <a class="code" href="classCRenderer.html">CRenderer</a> &amp;renderer = gmanager.<a class="code" href="classCImmGeomManager.html#a2">GetRendererManager</a>().<a class="code" href="classCRendererManager.html#a5">GetCurRenderer</a>();
00483             <font class="keywordtype">bool</font> cachePacket = renderer.<a class="code" href="classCRenderer.html#a6">GetCachePackets</a>(Geometry);
00484 
00485             <font class="comment">// next, under what conditions does the packet we're about to build remain valid?</font>
00486             RenderContextDepMask = renderer.<a class="code" href="classCRenderer.html#a7">GetRenderContextDeps</a>();
00487             RenderContextDependencies = RenderContextDepMask &amp; curRenderContext;
00488 
00489             <font class="keywordflow">if</font> ( cachePacket ) {        
00490                <font class="comment">// allocate memory for the new packet</font>
00491 
00492                <font class="comment">// ask the renderer how much memory to allocate for the packet</font>
00493                <font class="keywordtype">int</font> qwords = renderer.<a class="code" href="classCRenderer.html#a8">GetPacketQwordSize</a>(Geometry);
00494 
00495                <font class="keywordflow">if</font> ( ! RenderPacket ) {
00496                   RenderPacket = <font class="keyword">new</font> CVifSCDmaPacket( qwords, DMAC::Channels::vif1,
00497                                                       Packet::kXferTags,
00498                                                       Core::MemMappings::UncachedAccl );
00499                   DList.<a class="code" href="classCDList.html#a11">RegisterNewPacket</a>(RenderPacket);
00500                }
00501 
00502                <font class="comment">// if this is not the first time creating the packet, we need to</font>
00503                <font class="comment">// delete the old packet, but not immediately</font>
00504                <font class="comment">// because it may take up to two frames to be dma'ed</font>
00505                <font class="keywordflow">if</font> ( IsCached ) {
00506                   <font class="keywordtype">void</font> *newBuf = CDmaPacket::AllocBuffer( qwords,
00507                                                           Core::MemMappings::UncachedAccl );
00508                   <font class="keywordtype">void</font> *oldBuf = RenderPacket-&gt;SwapOutBuffer( newBuf );
00509                   pGLContext-&gt;AddBufferToBeFreed( Core::MakePtrNormal(oldBuf) );
00510                }
00511 
00512                RenderPacket-&gt;Reset();
00513 
00514                IsCached = <font class="keyword">true</font>;
00515             }
00516             <font class="keywordflow">else</font> {
00517                <font class="comment">// don't cache the packet..  use the main dma packet</font>
00518                RenderPacket = &amp; pGLContext-&gt;GetVif1Packet();
00519             }
00520 
00521             pGLContext-&gt;PushVif1Packet();
00522             {
00523                pGLContext-&gt;SetVif1Packet( *RenderPacket );
00524                renderer.<a class="code" href="classCRenderer.html#a4">DrawLinearArrays</a>( Geometry );
00525             }
00526             pGLContext-&gt;PopVif1Packet();
00527 
00528             <font class="comment">// terminate cached packets with a Ret() so they can be Call()ed</font>
00529             <font class="keywordflow">if</font> ( cachePacket ) {
00530                RenderPacket-&gt;Ret();
00531                RenderPacket-&gt;Pad128();
00532                RenderPacket-&gt;CloseTag();
00533             }
00534          }
00535 
00536          <font class="comment">// if the packet was cached, call() it from the vif1 dma chain</font>
00537          <font class="keywordflow">if</font> ( IsCached ) {
00538             pGLContext-&gt;GetVif1Packet().Call( *RenderPacket );
00539             pGLContext-&gt;GetVif1Packet().Pad128();
00540             pGLContext-&gt;GetVif1Packet().CloseTag();
00541          }
00542          <font class="keywordflow">else</font> {
00543             <font class="comment">// not really necessary</font>
00544             RenderPacket = NULL;
00545          }
00546 
00547          <font class="keywordflow">return</font> <a class="code" href="classCDListCmd.html#d1">CDListCmd::GetNextCmd</a>( <font class="keyword">this</font> );
00548       }
00549 };
00550 
<a name="l00551"></a><a class="code" href="classCDrawIndexedArraysCmd.html">00551</a> <font class="keyword">class </font><a class="code" href="classCDrawIndexedArraysCmd.html">CDrawIndexedArraysCmd</a> : <font class="keyword">public</font> <a class="code" href="classCDListCmd.html">CDListCmd</a> {
00552       <a class="code" href="classCGeometryBlock.html">CGeometryBlock</a>    Geometry;
00553       <font class="keywordtype">bool</font>              IsCached;
00554       <a class="code" href="classCDList.html">CDList</a>            &amp;DList;
00555       CVifSCDmaPacket   *RenderPacket;
00556       <font class="keywordtype">bool</font>              IsTexEnabled, IsLightingEnabled;
00557    <font class="keyword">public</font>:
<a name="l00558"></a><a class="code" href="classCDrawIndexedArraysCmd.html#a0">00558</a>       <a class="code" href="classCDrawIndexedArraysCmd.html#a0">CDrawIndexedArraysCmd</a>( <a class="code" href="classCGeometryBlock.html">CGeometryBlock</a> &amp;block, <a class="code" href="classCDList.html">CDList</a> &amp;dlist )
00559          : Geometry(block), IsCached(false), DList(dlist), RenderPacket(NULL)
00560       {}
00561 
<a name="l00562"></a><a class="code" href="classCDrawIndexedArraysCmd.html#a1">00562</a>       <a class="code" href="classCDListCmd.html">CDListCmd</a>* <a class="code" href="classCDListCmd.html#a1">Play</a>()<font class="keyword"> </font>{
00563 
00564          <font class="comment">// ** do not ** update the renderer context here; it will have</font>
00565          <font class="comment">// been taken care by other dlist commands</font>
00566 
00567          <font class="keywordtype">bool</font> texEnabled = pGLContext-&gt;GetTexManager().GetTexEnabled();
00568          <font class="keywordtype">bool</font> lEnabled = pGLContext-&gt;GetImmLighting().GetLightingEnabled();
00569 
00570          <font class="comment">// don't cache the packet if it depends on the current normal</font>
00571          <font class="keywordtype">bool</font> dontCache = ( lEnabled &amp;&amp; ! Geometry.<a class="code" href="classCGeometryBlock.html#a6">GetNormalsAreValid</a>() );
00572 
00573          <font class="comment">// [re]build cached dma packet</font>
00574          <font class="keywordflow">if</font> ( ! IsCached
00575               || texEnabled != IsTexEnabled
00576               || lEnabled != IsLightingEnabled ) {
00577 
00578             <font class="keywordflow">if</font> ( ! dontCache ) {
00579 
00580                <font class="comment">// allocate packet</font>
00581                <font class="keywordflow">if</font> ( ! RenderPacket ) {
00582                   <font class="comment">// FIXME:  this is a pitiful hack for allocating enough memory</font>
00583                   <font class="comment">// change below, too</font>
00584                   <font class="keywordtype">int</font> qwords = Math::Max(Geometry.<a class="code" href="classCGeometryBlock.html#a53">GetNumArrays</a>(), 1) * 100;
00585                   RenderPacket = <font class="keyword">new</font> CVifSCDmaPacket( qwords, DMAC::Channels::vif1,
00586                                                       Packet::kXferTags,
00587                                                       Core::MemMappings::UncachedAccl );
00588                   DList.<a class="code" href="classCDList.html#a11">RegisterNewPacket</a>(RenderPacket);
00589                }
00590 
00591                <font class="comment">// if this is not the first time creating the packet, we need to</font>
00592                <font class="comment">// delete the old packet, but not immediately</font>
00593                <font class="comment">// because it may take up to two frames to be dma'ed</font>
00594                <font class="keywordflow">if</font> ( IsCached ) {
00595                   <font class="keywordtype">int</font> qwords = Math::Max(Geometry.<a class="code" href="classCGeometryBlock.html#a53">GetNumArrays</a>(), 1) * 100;
00596                   <font class="keywordtype">void</font> *newBuf = CDmaPacket::AllocBuffer( qwords,
00597                                                           Core::MemMappings::UncachedAccl );
00598                   <font class="keywordtype">void</font> *oldBuf = RenderPacket-&gt;SwapOutBuffer( newBuf );
00599                   pGLContext-&gt;AddBufferToBeFreed( oldBuf );
00600                }
00601 
00602                RenderPacket-&gt;Reset();
00603 
00604                IsCached = <font class="keyword">true</font>;
00605             }
00606             <font class="keywordflow">else</font> {
00607                <font class="comment">// don't cache the packet..  use the main dma packet</font>
00608                RenderPacket = &amp; pGLContext-&gt;GetVif1Packet();
00609             }
00610 
00611             IsTexEnabled = texEnabled; IsLightingEnabled = lEnabled;
00612 
00613             pGLContext-&gt;PushVif1Packet();
00614             {
00615                pGLContext-&gt;SetVif1Packet( *RenderPacket );
00616                <a class="code" href="classCImmGeomManager.html">CImmGeomManager</a> &amp;gmanager = pGLContext-&gt;GetImmGeomManager();
00617                <a class="code" href="classCRenderer.html">CRenderer</a> &amp;renderer = gmanager.<a class="code" href="classCImmGeomManager.html#a2">GetRendererManager</a>().<a class="code" href="classCRendererManager.html#a5">GetCurRenderer</a>();
00618                renderer.<a class="code" href="classCRenderer.html#a5">DrawIndexedArrays</a>( Geometry );
00619             }
00620             pGLContext-&gt;PopVif1Packet();
00621 
00622             <font class="keywordflow">if</font> ( ! dontCache ) {
00623                RenderPacket-&gt;Ret();
00624                RenderPacket-&gt;Pad128();
00625                RenderPacket-&gt;CloseTag();
00626             }
00627          }
00628 
00629          <font class="keywordflow">if</font> ( ! dontCache ) {
00630             pGLContext-&gt;GetVif1Packet().Call( *RenderPacket );
00631             pGLContext-&gt;GetVif1Packet().Pad128();
00632             pGLContext-&gt;GetVif1Packet().CloseTag();
00633          }
00634          <font class="keywordflow">else</font> {
00635             RenderPacket = NULL;
00636          }
00637 
00638          <font class="keywordflow">return</font> <a class="code" href="classCDListCmd.html#d1">CDListCmd::GetNextCmd</a>( <font class="keyword">this</font> );
00639       }
00640 };
00641 
00642 <font class="keywordtype">void</font>
00643 CDListGeomManager::DrawBlock( <a class="code" href="classCGeometryBlock.html">CGeometryBlock</a> &amp;block )<font class="keyword"></font>
00644 {
00645    <font class="keywordflow">if</font> ( block.<a class="code" href="classCGeometryBlock.html#a19">GetArrayType</a>() == kLinear )
00646       *CurDList += CDrawArraysCmd( block, *CurDList );
00647    <font class="keywordflow">else</font>
00648       *CurDList += <a class="code" href="classCDrawIndexedArraysCmd.html#a0">CDrawIndexedArraysCmd</a>( block, *CurDList );
00649 }
00650 
<a name="l00651"></a><a class="code" href="classCEnableCustomCmd.html">00651</a> <font class="keyword">class </font><a class="code" href="classCEnableCustomCmd.html">CEnableCustomCmd</a> : <font class="keyword">public</font> <a class="code" href="classCDListCmd.html">CDListCmd</a> {
00652       tU64      Flag;
00653    <font class="keyword">public</font>:
<a name="l00654"></a><a class="code" href="classCEnableCustomCmd.html#a0">00654</a>       <a class="code" href="classCEnableCustomCmd.html#a0">CEnableCustomCmd</a>( tU64 flag ) : Flag(flag) {}
<a name="l00655"></a><a class="code" href="classCEnableCustomCmd.html#a1">00655</a>       <a class="code" href="classCDListCmd.html">CDListCmd</a>* <a class="code" href="classCDListCmd.html#a1">Play</a>()<font class="keyword"> </font>{
00656          pGLContext-&gt;GetImmGeomManager().GetRendererManager().EnableCustom(Flag);
00657          <font class="keywordflow">return</font> <a class="code" href="classCDListCmd.html#d1">CDListCmd::GetNextCmd</a>(<font class="keyword">this</font>);
00658       }
00659 };
00660 
00661 <font class="keywordtype">void</font>
<a name="l00662"></a><a class="code" href="classCDListGeomManager.html#a3">00662</a> <a class="code" href="classCDListGeomManager.html#a3">CDListGeomManager::EnableCustom</a>( tU64 flag )<font class="keyword"></font>
00663 {
00664    *CurDList += CEnableCustomCmd(flag);
00665 }
00666 
<a name="l00667"></a><a class="code" href="classCDisableCustomCmd.html">00667</a> <font class="keyword">class </font><a class="code" href="classCDisableCustomCmd.html">CDisableCustomCmd</a> : <font class="keyword">public</font> <a class="code" href="classCDListCmd.html">CDListCmd</a> {
00668       tU64      Flag;
00669    <font class="keyword">public</font>:
<a name="l00670"></a><a class="code" href="classCDisableCustomCmd.html#a0">00670</a>       <a class="code" href="classCDisableCustomCmd.html#a0">CDisableCustomCmd</a>( tU64 flag ) : Flag(flag) {}
<a name="l00671"></a><a class="code" href="classCDisableCustomCmd.html#a1">00671</a>       <a class="code" href="classCDListCmd.html">CDListCmd</a>* <a class="code" href="classCDListCmd.html#a1">Play</a>()<font class="keyword"> </font>{
00672          pGLContext-&gt;GetImmGeomManager().GetRendererManager().DisableCustom(Flag);
00673          <font class="keywordflow">return</font> <a class="code" href="classCDListCmd.html#d1">CDListCmd::GetNextCmd</a>(<font class="keyword">this</font>);
00674       }
00675 };
00676 
00677 <font class="keywordtype">void</font>
<a name="l00678"></a><a class="code" href="classCDListGeomManager.html#a4">00678</a> <a class="code" href="classCDListGeomManager.html#a4">CDListGeomManager::DisableCustom</a>( tU64 flag )<font class="keyword"></font>
00679 {
00680    *CurDList += CDisableCustomCmd(flag);
00681 }
</pre></div><hr><address><small>ps2gl version cvs</small></address>
