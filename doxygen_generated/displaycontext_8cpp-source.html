<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>displaycontext.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body bgcolor="#ffffff">
<!-- Generated by Doxygen 1.2.11 -->
<center>
<a class="qindex" href="main.html">Main Page</a> &nbsp; <a class="qindex" href="modules.html">Modules</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>displaycontext.cpp</h1><a href="displaycontext_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <font class="comment">/*        Copyright (C) 2000,2001,2002  Sony Computer Entertainment America</font>
00002           
00003           This file is subject to the terms and conditions of the GNU Lesser
00004           General Public License Version 2.1. See the file "COPYING" in the
00005           main directory of this archive for more details.                             */
00006 
00007 <font class="preprocessor">#include "<a class="code" href="ps2gl_8h.html">GL/ps2gl.h</a>"</font>
00008 
00009 <font class="preprocessor">#include "<a class="code" href="displaycontext_8h.html">ps2gl/displaycontext.h</a>"</font>
00010 <font class="preprocessor">#include "<a class="code" href="dlist_8h.html">ps2gl/dlist.h</a>"</font>
00011 
00012 <font class="preprocessor">#include "ps2s/displayenv.h"</font>
00013 
<a name="l00014"></a><a class="code" href="classCDisplayContext.html#a0">00014</a> <a class="code" href="classCDisplayContext.html#a0">CDisplayContext::CDisplayContext</a>( <a class="code" href="classCGLContext.html">CGLContext</a> &amp;context )
00015    : GLContext(context),
00016      Frame0Mem(NULL), Frame1Mem(NULL),
00017      CurFrameMem(NULL), LastFrameMem(NULL),
00018      DisplayEnv(NULL),
00019      DisplayIsDblBuffered(true),
00020      DisplayIsInterlaced(true)
00021 {
00022    DisplayEnv = <font class="keyword">new</font> GS::CDisplayEnv;
00023 }
00024 
<a name="l00025"></a><a class="code" href="classCDisplayContext.html#a1">00025</a> <a class="code" href="classCDisplayContext.html#a1">CDisplayContext::~CDisplayContext</a>()<font class="keyword"></font>
00026 {
00027    <font class="comment">// don't delete the frame mem areas -- they are created/destroyed by</font>
00028    <font class="comment">// the app</font>
00029 
00030    <font class="keyword">delete</font> DisplayEnv;
00031 }
00032      
00033 <font class="keywordtype">void</font>
<a name="l00034"></a><a class="code" href="classCDisplayContext.html#a3">00034</a> <a class="code" href="classCDisplayContext.html#a3">CDisplayContext::SetDisplayBuffers</a>( <font class="keywordtype">bool</font> interlaced,
00035                                     GS::CMemArea *frame0Mem, GS::CMemArea *frame1Mem )<font class="keyword"></font>
00036 {
00037    Frame0Mem = frame0Mem;
00038    Frame1Mem = frame1Mem;
00039 
00040    DisplayIsDblBuffered = ( frame0Mem &amp;&amp; frame1Mem );
00041    DisplayIsInterlaced = interlaced;
00042 
00043    <font class="comment">// "current" means the frame being drawn to by the loop of code executing on the core</font>
00044    <font class="comment">// "last" will be the frame being displayed if drawing immediately, or the frame not</font>
00045    <font class="comment">// displayed now if building up a packet to be sent next frame.</font>
00046    CurFrameMem = Frame0Mem;
00047    LastFrameMem = Frame1Mem;
00048 
00049    <font class="keywordtype">int</font> width = frame0Mem-&gt;GetWidth(), height = frame0Mem-&gt;GetHeight();
00050    <font class="keywordtype">int</font> displayHeight = (DisplayIsInterlaced) ? height * 2 : height;
00051 
00052 <font class="preprocessor">#ifndef PS2_LINUX</font>
00053    DisplayEnv-&gt;SetFB2( frame0Mem-&gt;GetWordAddr(), width, 0, 0, frame0Mem-&gt;GetPixFormat() );
00054    DisplayEnv-&gt;SetDisplay2( width, displayHeight );
00055 <font class="preprocessor">#else</font>
00056    DisplayEnv-&gt;SetFB1( frame0Mem-&gt;GetWordAddr(), width,
00057                        0, 0, <font class="comment">/* offsets in buffer */</font>
00058                        frame0Mem-&gt;GetPixFormat() );
00059    DisplayEnv-&gt;SetFB2( frame0Mem-&gt;GetWordAddr(), width,
00060                        0, 0, <font class="comment">/* offsets in buffer */</font>
00061                        frame0Mem-&gt;GetPixFormat() );
00062    <font class="comment">// DisplayEnv-&gt;SetDisplay2( width, height * 2 );</font>
00063    DisplayEnv-&gt;SetBGColor( 0, 0, 0 );
00064    DisplayEnv-&gt;BlendUsingConstAlpha( 0x0 );
00065    DisplayEnv-&gt;SetDisplay2( width, displayHeight );
00066 <font class="preprocessor">#endif</font>
00067    DisplayEnv-&gt;SendSettings();
00068 }
00069 
00070 <font class="keywordtype">void</font>
<a name="l00071"></a><a class="code" href="classCDisplayContext.html#a4">00071</a> <a class="code" href="classCDisplayContext.html#a4">CDisplayContext::SwapBuffers</a>()<font class="keyword"></font>
00072 {
00073    <font class="comment">// flip frame buffer ptrs</font>
00074    <font class="keywordflow">if</font> ( DisplayIsDblBuffered ) {
00075       GS::CMemArea* temp = CurFrameMem;
00076       CurFrameMem = LastFrameMem;
00077       LastFrameMem = temp;
00078 
00079       <font class="comment">// display the last completed frame (which is frame n-2 because we're not</font>
00080       <font class="comment">// drawing immediately but building up a packet)</font>
00081       <font class="comment">// remember this is immediately sent, not delayed through a packet</font>
00082 <font class="preprocessor">#ifndef PS2_LINUX</font>
00083       DisplayEnv-&gt;SetFB2Addr( CurFrameMem-&gt;GetWordAddr() );
00084 <font class="preprocessor">#else</font>
00085       DisplayEnv-&gt;SetFB2Addr( CurFrameMem-&gt;GetWordAddr() );
00086 <font class="preprocessor">#endif</font>
00087       DisplayEnv-&gt;SendSettings();
00088    }
00089 }
00090 
00091 <font class="comment">/********************************************</font>
00092  * ps2gl C interface
00093  */
00094 
00106 <font class="keywordtype">void</font>
<a name="l00107"></a><a class="code" href="displaycontext_8cpp.html#a36">00107</a> <a class="code" href="ps2gl_8h.html#a36">pglSetDisplayBuffers</a>( <font class="keywordtype">int</font> interlaced, <a class="code" href="ps2gl_8h.html#a12">pgl_area_handle_t</a> frame0_mem, <a class="code" href="ps2gl_8h.html#a12">pgl_area_handle_t</a> frame1_mem )<font class="keyword"></font>
00108 {
00109    pGLContext-&gt;GetDisplayContext().SetDisplayBuffers( interlaced,
00110                                                       reinterpret_cast&lt;GS::CMemArea*&gt;(frame0_mem),
00111                                                       reinterpret_cast&lt;GS::CMemArea*&gt;(frame1_mem) );
00112 }
00113  <font class="comment">// pgl_api</font>
00115 
00116 <font class="comment">/********************************************</font>
00117  * gl api
00118  */
00119 
<a name="l00120"></a><a class="code" href="displaycontext_8cpp.html#a1">00120</a> <font class="keywordtype">void</font> <a class="code" href="gl_8h.html#a949">glPixelStorei</a>( <a class="code" href="gl_8h.html#a687">GLenum</a> pname, <font class="keywordtype">int</font> param )<font class="keyword"></font>
00121 {
00122    <a class="code" href="debug_8h.html#a1">mNotImplemented</a>( );
00123 }
00124 
<a name="l00125"></a><a class="code" href="displaycontext_8cpp.html#a2">00125</a> <font class="keywordtype">void</font> <a class="code" href="gl_8h.html#a959">glReadPixels</a>( <font class="keywordtype">int</font> x, <font class="keywordtype">int</font> y, <font class="keywordtype">int</font> width, <font class="keywordtype">int</font> height,
00126                    <a class="code" href="gl_8h.html#a687">GLenum</a> format, <a class="code" href="gl_8h.html#a687">GLenum</a> type, <font class="keywordtype">void</font> *pixels )<font class="keyword"></font>
00127 {
00128    <a class="code" href="debug_8h.html#a1">mNotImplemented</a>( );
00129 }
00130 
<a name="l00131"></a><a class="code" href="displaycontext_8cpp.html#a754">00131</a> <font class="keywordtype">void</font> <a class="code" href="gl_8h.html#a754">glViewport</a>( <a class="code" href="gl_8h.html#a693">GLint</a> x, <a class="code" href="gl_8h.html#a693">GLint</a> y,
00132                        <a class="code" href="gl_8h.html#a697">GLsizei</a> width, <a class="code" href="gl_8h.html#a697">GLsizei</a> height )<font class="keyword"></font>
00133 {
00134    <a class="code" href="debug_8h.html#a1">mNotImplemented</a>( );
00135 }
00136 
</pre></div><hr><address><small>ps2gl version cvs</small></address>
