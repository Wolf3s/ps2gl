<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>inverse.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body bgcolor="#ffffff">
<!-- Generated by Doxygen 1.2.11 -->
<center>
<a class="qindex" href="main.html">Main Page</a> &nbsp; <a class="qindex" href="modules.html">Modules</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>inverse.cpp</h1><a href="inverse_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <font class="comment">// I grabbed this from somewhere that I've now forgotten...</font>
00002 <font class="comment">// it badly needs to be replaced, in any case</font>
00003 
00004 <font class="comment">/************************************************************</font>
00005  *
00006  * input:
00007  * mat - pointer to array of 16 floats (source matrix)
00008  * output:
00009  * dst - pointer to array of 16 floats (invert matrix)
00010  * *************************************************************/
00011 
<a name="l00012"></a><a class="code" href="inverse_8cpp.html#a4">00012</a> <font class="keywordtype">void</font> <a class="code" href="matrix_8cpp.html#a4">Invert2</a>( <font class="keywordtype">float</font> *mat, <font class="keywordtype">float</font> *dst)<font class="keyword"></font>
00013 {
00014    <font class="keywordtype">float</font> tmp[12]; <font class="comment">/* temp array for pairs */</font>
00015    <font class="keywordtype">float</font> src[16]; <font class="comment">/* array of transpose source matrix */</font>
00016    <font class="keywordtype">float</font> det; <font class="comment">/* determinant*/</font>
00017 
00018    <font class="comment">/* transpose matrix */</font>
00019    <font class="keywordflow">for</font> ( <font class="keywordtype">int</font> i = 0; i &lt; 4; i++) {
00020       src[i] = mat[i*4];
00021       src[i + 4] = mat[i*4 + 1];
00022       src[i + 8] = mat[i*4 + 2];
00023       src[i + 12] = mat[i*4 + 3];
00024    }
00025 
00026    <font class="comment">/* calculate pairs for first 8 elements (cofactors) */</font>
00027    tmp[0] = src[10] * src[15];
00028    tmp[1] = src[11] * src[14];
00029    tmp[2] = src[9] * src[15];
00030    tmp[3] = src[11] * src[13];
00031    tmp[4] = src[9] * src[14];
00032    tmp[5] = src[10] * src[13];
00033    tmp[6] = src[8] * src[15];
00034    tmp[7] = src[11] * src[12];
00035    tmp[8] = src[8] * src[14];
00036    tmp[9] = src[10] * src[12];
00037    tmp[10] = src[8] * src[13];
00038    tmp[11] = src[9] * src[12];
00039 
00040    <font class="comment">/* calculate first 8 elements (cofactors) */</font>
00041    dst[0] = tmp[0]*src[5] + tmp[3]*src[6] + tmp[4]*src[7];
00042    dst[0] -= tmp[1]*src[5] + tmp[2]*src[6] + tmp[5]*src[7];
00043    dst[1] = tmp[1]*src[4] + tmp[6]*src[6] + tmp[9]*src[7];
00044    dst[1] -= tmp[0]*src[4] + tmp[7]*src[6] + tmp[8]*src[7];
00045    dst[2] = tmp[2]*src[4] + tmp[7]*src[5] + tmp[10]*src[7];
00046    dst[2] -= tmp[3]*src[4] + tmp[6]*src[5] + tmp[11]*src[7];
00047    dst[3] = tmp[5]*src[4] + tmp[8]*src[5] + tmp[11]*src[6];
00048    dst[3] -= tmp[4]*src[4] + tmp[9]*src[5] + tmp[10]*src[6];
00049    dst[4] = tmp[1]*src[1] + tmp[2]*src[2] + tmp[5]*src[3];
00050    dst[4] -= tmp[0]*src[1] + tmp[3]*src[2] + tmp[4]*src[3];
00051    dst[5] = tmp[0]*src[0] + tmp[7]*src[2] + tmp[8]*src[3];
00052    dst[5] -= tmp[1]*src[0] + tmp[6]*src[2] + tmp[9]*src[3];
00053    dst[6] = tmp[3]*src[0] + tmp[6]*src[1] + tmp[11]*src[3];
00054    dst[6] -= tmp[2]*src[0] + tmp[7]*src[1] + tmp[10]*src[3];
00055    dst[7] = tmp[4]*src[0] + tmp[9]*src[1] + tmp[10]*src[2];
00056    dst[7] -= tmp[5]*src[0] + tmp[8]*src[1] + tmp[11]*src[2];
00057 
00058    <font class="comment">/* calculate pairs for second 8 elements (cofactors) */</font>
00059    tmp[0] = src[2]*src[7];
00060    tmp[1] = src[3]*src[6];
00061    tmp[2] = src[1]*src[7];
00062    tmp[3] = src[3]*src[5];
00063    tmp[4] = src[1]*src[6];
00064    tmp[5] = src[2]*src[5];
00065    tmp[6] = src[0]*src[7];
00066    tmp[7] = src[3]*src[4];
00067    tmp[8] = src[0]*src[6];
00068    tmp[9] = src[2]*src[4];
00069    tmp[10] = src[0]*src[5];
00070    tmp[11] = src[1]*src[4];
00071 
00072    <font class="comment">/* calculate second 8 elements (cofactors) */</font>
00073    dst[8] = tmp[0]*src[13] + tmp[3]*src[14] + tmp[4]*src[15];
00074    dst[8] -= tmp[1]*src[13] + tmp[2]*src[14] + tmp[5]*src[15];
00075    dst[9] = tmp[1]*src[12] + tmp[6]*src[14] + tmp[9]*src[15];
00076    dst[9] -= tmp[0]*src[12] + tmp[7]*src[14] + tmp[8]*src[15];
00077    dst[10] = tmp[2]*src[12] + tmp[7]*src[13] + tmp[10]*src[15];
00078    dst[10]-= tmp[3]*src[12] + tmp[6]*src[13] + tmp[11]*src[15];
00079    dst[11] = tmp[5]*src[12] + tmp[8]*src[13] + tmp[11]*src[14];
00080    dst[11]-= tmp[4]*src[12] + tmp[9]*src[13] + tmp[10]*src[14];
00081    dst[12] = tmp[2]*src[10] + tmp[5]*src[11] + tmp[1]*src[9];
00082    dst[12]-= tmp[4]*src[11] + tmp[0]*src[9] + tmp[3]*src[10];
00083    dst[13] = tmp[8]*src[11] + tmp[0]*src[8] + tmp[7]*src[10];
00084    dst[13]-= tmp[6]*src[10] + tmp[9]*src[11] + tmp[1]*src[8];
00085    dst[14] = tmp[6]*src[9] + tmp[11]*src[11] + tmp[3]*src[8];
00086    dst[14]-= tmp[10]*src[11] + tmp[2]*src[8] + tmp[7]*src[9];
00087    dst[15] = tmp[10]*src[10] + tmp[4]*src[8] + tmp[9]*src[9];
00088    dst[15]-= tmp[8]*src[9] + tmp[11]*src[10] + tmp[5]*src[8];
00089 
00090    <font class="comment">/* calculate determinant */</font>
00091    det=src[0]*dst[0]+src[1]*dst[1]+src[2]*dst[2]+src[3]*dst[3];
00092 
00093    <font class="comment">/* calculate matrix inverse */</font>
00094    det = 1/det;
00095    <font class="keywordflow">for</font> ( <font class="keywordtype">int</font> j = 0; j &lt; 16; j++)
00096       dst[j] *= det;
00097 }
</pre></div><hr><address><small>ps2gl version cvs</small></address>
