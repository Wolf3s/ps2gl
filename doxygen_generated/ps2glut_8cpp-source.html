<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>ps2glut.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body bgcolor="#ffffff">
<!-- Generated by Doxygen 1.2.11 -->
<center>
<a class="qindex" href="main.html">Main Page</a> &nbsp; <a class="qindex" href="modules.html">Modules</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>ps2glut.cpp</h1><a href="ps2glut_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <font class="comment">/*        Copyright (C) 2000,2001,2002  Sony Computer Entertainment America</font>
00002           
00003           This file is subject to the terms and conditions of the GNU Lesser
00004           General Public License Version 2.1. See the file "COPYING" in the
00005           main directory of this archive for more details.                             */
00006 
00007 <font class="preprocessor">#include &lt;stdlib.h&gt;</font>
00008 <font class="preprocessor">#include &lt;stdio.h&gt;</font>
00009 
00010 <font class="preprocessor">#include "libgraph.h"</font>
00011 <font class="preprocessor">#include "libdev.h"</font>
00012 <font class="preprocessor">#include "sifdev.h"</font>
00013 
00014 <font class="preprocessor">#include "<a class="code" href="glut_8h.html">GL/glut.h</a>"</font>
00015 <font class="preprocessor">#include "<a class="code" href="ps2gl_8h.html">GL/ps2gl.h</a>"</font>
00016 
00017 <font class="preprocessor">#include "ps2s/timer.h"</font>
00018 <font class="preprocessor">#include "ps2s/gs.h"</font>
00019 <font class="preprocessor">#include "ps2s/drawenv.h"</font>
00020 <font class="preprocessor">#include "ps2s/displayenv.h"</font>
00021 <font class="preprocessor">#include "ps2s/core.h"</font>
00022 
00023 <font class="preprocessor">#include "<a class="code" href="glcontext_8h.html">ps2gl/glcontext.h</a>"</font>
00024 <font class="preprocessor">#include "<a class="code" href="displaycontext_8h.html">ps2gl/displaycontext.h</a>"</font>
00025 <font class="preprocessor">#include "<a class="code" href="drawcontext_8h.html">ps2gl/drawcontext.h</a>"</font>
00026 <font class="preprocessor">#include "<a class="code" href="debug_8h.html">ps2gl/debug.h</a>"</font>
00027 
00028 <font class="preprocessor">#include "<a class="code" href="pads_8h.html">pads.h</a>"</font>
00029 
00030 <font class="comment">/********************************************</font>
00031  * some function pointer types
00032  */
00033 
<a name="l00034"></a><a class="code" href="ps2glut_8cpp.html#a0">00034</a> <font class="keyword">typedef</font> void (* tFunctionPtr_ii)        (<font class="keywordtype">int</font>, <font class="keywordtype">int</font>);
<a name="l00035"></a><a class="code" href="ps2glut_8cpp.html#a1">00035</a> <font class="keyword">typedef</font> void (* tFunctionPtr_ucii)      (<font class="keywordtype">unsigned</font> <font class="keywordtype">char</font>, <font class="keywordtype">int</font>, <font class="keywordtype">int</font>);
<a name="l00036"></a><a class="code" href="ps2glut_8cpp.html#a2">00036</a> <font class="keyword">typedef</font> void (* tFunctionPtr_iii)       (<font class="keywordtype">int</font>, <font class="keywordtype">int</font>, <font class="keywordtype">int</font>);
<a name="l00037"></a><a class="code" href="ps2glut_8cpp.html#a3">00037</a> <font class="keyword">typedef</font> void (* tFunctionPtr)           (<font class="keywordtype">void</font>);
<a name="l00038"></a><a class="code" href="ps2glut_8cpp.html#a4">00038</a> <font class="keyword">typedef</font> void (* tFunctionPtr_i)         (<font class="keywordtype">int</font>);
00039 
00040 <font class="comment">/********************************************</font>
00041  * function prototypes
00042  */
00043 
00044 <font class="keyword">static</font> <font class="keywordtype">void</font> parse_cl( <font class="keywordtype">int</font> *argcp, <font class="keywordtype">char</font> **argv );
00045 <font class="keyword">static</font> <font class="keywordtype">void</font> normal_main_loop();
00046 <font class="keyword">static</font> <font class="keywordtype">void</font> initGsMemory();
00047 <font class="keyword">static</font> <font class="keywordtype">void</font> do_keys();
00048 
00049 <font class="comment">/********************************************</font>
00050  * local data
00051  */
00052 
<a name="l00053"></a><a class="code" href="ps2glut_8cpp.html#a5">00053</a> tFunctionPtr DisplayFunc = NULL;
<a name="l00054"></a><a class="code" href="ps2glut_8cpp.html#a6">00054</a> tFunctionPtr_ii ReshapeFunc = NULL;
<a name="l00055"></a><a class="code" href="ps2glut_8cpp.html#a7">00055</a> tFunctionPtr_ucii KeyboardFunc = NULL;
<a name="l00056"></a><a class="code" href="ps2glut_8cpp.html#a8">00056</a> tFunctionPtr_i VisibilityFunc = NULL;
<a name="l00057"></a><a class="code" href="ps2glut_8cpp.html#a9">00057</a> tFunctionPtr IdleFunc = NULL;
<a name="l00058"></a><a class="code" href="ps2glut_8cpp.html#a10">00058</a> tFunctionPtr_iii SpecialFunc = NULL;
00059 
00060 <font class="keyword">static</font> CEETimer *Timer0;
00061 <font class="keyword">static</font> <font class="keywordtype">char</font> default_module_path[] = <font class="stringliteral">"host0:/usr/local/sce/iop/modules"</font>;
00062 <font class="keyword">static</font> <font class="keywordtype">char</font> *module_path = <font class="charliteral">'\0'</font>;
00063 
00064 <font class="keyword">static</font> <font class="keywordtype">bool</font> printTimes = <font class="keyword">false</font>;
00065 
00066 <font class="comment">/********************************************</font>
00067  * macros
00068  */
00069 
00070 <font class="comment">/********************************************</font>
00071  * glut implementation (loosely speaking..)
00072  */
00073 
<a name="l00106"></a><a class="code" href="group__glut__api.html#a19">00106</a> <font class="keywordtype">void</font> <a class="code" href="group__glut__api.html#a19">glutInit</a>(<font class="keywordtype">int</font> *argcp, <font class="keywordtype">char</font> **argv)<font class="keyword"></font>
00107 {
00108    parse_cl( argcp, argv );
00109 
00110    <font class="comment">// get the iop module path and initialize the pads</font>
00111    <font class="comment">// this is before ps2gl initialization because the sifInitRPC in</font>
00112    <font class="comment">// Pads::Init needs to happen before the dtv init</font>
00113 
00114    <font class="keywordflow">if</font> ( module_path == NULL ) {
00115       mWarn(<font class="stringliteral">"No iop module path specified!  Using %s."</font>, default_module_path);
00116       module_path = default_module_path;
00117    }
00118    <a class="code" href="namespacePads.html#a16">Pads::Init</a>(module_path);
00119 
00120    <font class="comment">// does the ps2gl library need to be initialized?</font>
00121 
00122    <font class="keywordflow">if</font> ( ! <a class="code" href="group__pgl__api.html#a4">pglHasLibraryBeenInitted</a>() )<font class="keyword"> </font>{
00123       <font class="comment">// reset the machine</font>
00124       sceDevVif0Reset();
00125       sceDevVu0Reset();
00126       sceDmaReset(1);    
00127       sceGsResetPath();
00128 
00129       sceGsResetGraph(0, SCE_GS_INTERLACE, SCE_GS_NTSC, SCE_GS_FRAME);
00130 
00131       mWarn( <font class="stringliteral">"ps2gl library has not been initialized by the user; using default values."</font> );
00132       <font class="keywordtype">int</font> immBufferVertexSize = 64 * 1024;
00133       <a class="code" href="ps2gl_8h.html#a13">pglInit</a>( immBufferVertexSize, 1000 );
00134    }
00135 
00136    <font class="comment">// does gs memory need to be initialized?</font>
00137 
00138    <font class="keywordflow">if</font> ( ! <a class="code" href="group__gs__mem.html#a1">pglHasGsMemBeenInitted</a>() )<font class="keyword"> </font>{
00139       mWarn(<font class="stringliteral">"GS memory has not been allocated by the user; using default values."</font>);
00140       initGsMemory();
00141    }
00142 }
00143 
<a name="l00147"></a><a class="code" href="group__glut__api.html#a20">00147</a> <font class="keywordtype">void</font> <a class="code" href="group__glut__api.html#a20">glutDisplayFunc</a>(<font class="keywordtype">void</font> (*func)(<font class="keywordtype">void</font>))<font class="keyword"></font>
00148 {
00149    DisplayFunc = func;
00150 }
00151 
<a name="l00157"></a><a class="code" href="group__glut__api.html#a21">00157</a> <font class="keywordtype">void</font> <a class="code" href="group__glut__api.html#a21">glutReshapeFunc</a>(<font class="keywordtype">void</font> (*func)(<font class="keywordtype">int</font> width, <font class="keywordtype">int</font> height))<font class="keyword"></font>
00158 {
00159    ReshapeFunc = func;
00160 }
00161 
<a name="l00167"></a><a class="code" href="group__glut__api.html#a22">00167</a> <font class="keywordtype">void</font> <a class="code" href="group__glut__api.html#a22">glutKeyboardFunc</a>(<font class="keywordtype">void</font> (*func)(<font class="keywordtype">unsigned</font> <font class="keywordtype">char</font> key, <font class="keywordtype">int</font> x, <font class="keywordtype">int</font> y))<font class="keyword"></font>
00168 {
00169    KeyboardFunc = func;
00170 }
00171 
<a name="l00177"></a><a class="code" href="group__glut__api.html#a23">00177</a> <font class="keywordtype">void</font> <a class="code" href="group__glut__api.html#a23">glutVisibilityFunc</a>(<font class="keywordtype">void</font> (*func)(<font class="keywordtype">int</font> state))<font class="keyword"></font>
00178 {
00179    VisibilityFunc = func;
00180 }
00181 
<a name="l00186"></a><a class="code" href="group__glut__api.html#a24">00186</a> <font class="keywordtype">void</font> <a class="code" href="group__glut__api.html#a24">glutIdleFunc</a>(<font class="keywordtype">void</font> (*func)(<font class="keywordtype">void</font>))<font class="keyword"></font>
00187 {
00188    IdleFunc = func;
00189 }
00190 
<a name="l00196"></a><a class="code" href="group__glut__api.html#a25">00196</a> <font class="keywordtype">void</font> <a class="code" href="group__glut__api.html#a25">glutSpecialFunc</a>(<font class="keywordtype">void</font> (*func)(<font class="keywordtype">int</font> key, <font class="keywordtype">int</font> x, <font class="keywordtype">int</font> y))<font class="keyword"></font>
00197 {
00198    SpecialFunc = func;
00199 }
00200 
<a name="l00205"></a><a class="code" href="group__glut__api.html#a26">00205</a> <font class="keywordtype">void</font> <a class="code" href="group__glut__api.html#a47">glutMainLoop</a>( <font class="keywordtype">void</font> )<font class="keyword"></font>
00206 {
00207    mErrorIf( DisplayFunc == NULL, <font class="stringliteral">"ps2glut:  No display function!"</font> );
00208 
00209    <font class="keywordflow">if</font> ( VisibilityFunc )
00210       <a class="code" href="ps2glut_8cpp.html#a8">VisibilityFunc</a>( GLUT_VISIBLE );
00211 
00212    normal_main_loop();
00213 }
00214  <font class="comment">// glut_api</font>
00216 
<a name="l00217"></a><a class="code" href="ps2glut_8cpp.html#a27">00217</a> <font class="keywordtype">void</font> <a class="code" href="ps2glut_8cpp.html#a27">glutInitDisplayMode</a>(<font class="keywordtype">unsigned</font> <font class="keywordtype">int</font> mode)<font class="keyword"></font>
00218 {
00219    <a class="code" href="debug_8h.html#a1">mNotImplemented</a>( );
00220 }
00221 
<a name="l00222"></a><a class="code" href="ps2glut_8cpp.html#a28">00222</a> <font class="keywordtype">void</font> <a class="code" href="ps2glut_8cpp.html#a28">glutInitWindowPosition</a>( <font class="keywordtype">int</font> x, <font class="keywordtype">int</font> y )<font class="keyword"></font>
00223 {
00224    <a class="code" href="debug_8h.html#a1">mNotImplemented</a>( );
00225 }
00226 
<a name="l00227"></a><a class="code" href="ps2glut_8cpp.html#a29">00227</a> <font class="keywordtype">void</font> <a class="code" href="ps2glut_8cpp.html#a29">glutInitWindowSize</a>( <font class="keywordtype">int</font> x, <font class="keywordtype">int</font> y )<font class="keyword"></font>
00228 {
00229    <a class="code" href="debug_8h.html#a1">mNotImplemented</a>( );
00230 }
00231 
<a name="l00232"></a><a class="code" href="ps2glut_8cpp.html#a30">00232</a> <font class="keywordtype">int</font> <a class="code" href="ps2glut_8cpp.html#a30">glutCreateWindow</a>(<font class="keyword">const</font> <font class="keywordtype">char</font> *title)<font class="keyword"></font>
00233 {
00234    <a class="code" href="debug_8h.html#a1">mNotImplemented</a>( );
00235 
00236    <font class="keywordflow">return</font> 1;
00237 }
00238 
<a name="l00239"></a><a class="code" href="ps2glut_8cpp.html#a31">00239</a> <font class="keywordtype">void</font> <a class="code" href="glut_8h.html#a48">glutPostRedisplay</a>(<font class="keywordtype">void</font>)<font class="keyword"></font>
00240 {
00241    <font class="comment">// mNotImplemented( );</font>
00242 }
00243 
<a name="l00244"></a><a class="code" href="ps2glut_8cpp.html#a32">00244</a> <font class="keywordtype">void</font> <a class="code" href="glut_8h.html#a49">glutSwapBuffers</a>( <font class="keywordtype">void</font> )<font class="keyword"></font>
00245 {
00246 }
00247 
<a name="l00248"></a><a class="code" href="ps2glut_8cpp.html#a33">00248</a> <font class="keywordtype">int</font> <a class="code" href="ps2glut_8cpp.html#a33">glutGet</a>(<a class="code" href="gl_8h.html#a687">GLenum</a> type)<font class="keyword"></font>
00249 {
00250    <a class="code" href="debug_8h.html#a1">mNotImplemented</a>( );
00251    <font class="keywordflow">return</font> 0;
00252 }
00253 
00254 <font class="keywordtype">void</font>*
<a name="l00255"></a><a class="code" href="ps2glut_8cpp.html#a34">00255</a> <a class="code" href="ps2glut_8cpp.html#a34">pglutAllocDmaMem</a>( <font class="keywordtype">unsigned</font> <font class="keywordtype">int</font> num_bytes )<font class="keyword"></font>
00256 {
00257    <font class="comment">// don't really need memalign, but it's clearer..</font>
00258    <font class="keywordflow">return</font> memalign( 16, num_bytes );
00259 }
00260 
00261 <font class="keywordtype">void</font>
<a name="l00262"></a><a class="code" href="ps2glut_8cpp.html#a35">00262</a> <a class="code" href="ps2glut_8cpp.html#a35">pglutFreeDmaMem</a>( <font class="keywordtype">void</font> *mem )<font class="keyword"></font>
00263 {
00264    free( mem );
00265 }
00266 
00267 <font class="comment">/********************************************</font>
00268  * local function definitions
00269  */
00270 
00271 <font class="keywordtype">void</font> normal_main_loop()<font class="keyword"></font>
00272 {
00273    <font class="keywordtype">bool</font> firstTime = <font class="keyword">true</font>;
00274 
00275    <font class="comment">// init the timing system</font>
00276 
00277    Timer0 = <font class="keyword">new</font> CEETimer( CEETimer::Timer0 );
00278    mInitTimers( Timer0, CEETimer::BusClock_256th );
00279 
00280    <font class="keywordflow">if</font> ( ReshapeFunc )
00281       <a class="code" href="ps2glut_8cpp.html#a6">ReshapeFunc</a>( 640, 448 );
00282 
00283    <font class="keywordflow">while</font>(1) {
00284       mUpdateTimers();
00285 
00286       mStartTimer(<font class="stringliteral">"frame time"</font>);
00287 
00288       <a class="code" href="namespacePads.html#a17">Pads::Read</a>();
00289 
00290       <font class="keywordflow">if</font> ( Pad0.WasPushed(Pads::kStart) )
00291          printTimes = <font class="keyword">true</font>;
00292 
00293       do_keys();
00294 
00295       <font class="keywordflow">if</font> ( DisplayFunc ) {
00296          mStartTimer(<font class="stringliteral">"DisplayFunc()"</font>);
00297          <a class="code" href="group__pgl__api.html#a14">pglBeginGeometry</a>();
00298          <a class="code" href="ps2glut_8cpp.html#a5">DisplayFunc</a>();
00299          <a class="code" href="group__pgl__api.html#a15">pglEndGeometry</a>();
00300          mStopTimer(<font class="stringliteral">"DisplayFunc()"</font>);
00301       }
00302 
00303       <font class="keywordflow">if</font> ( IdleFunc ) {
00304          mStartTimer(<font class="stringliteral">"IdleFunc()"</font>);
00305          <a class="code" href="ps2glut_8cpp.html#a9">IdleFunc</a>();
00306          mStopTimer(<font class="stringliteral">"IdleFunc()"</font>);
00307       }
00308 
00309       mStartTimer(<font class="stringliteral">"wait for vu1"</font>);
00310       <font class="keywordflow">if</font> ( ! firstTime )
00311          <a class="code" href="ps2gl_8h.html#a50">pglFinishRenderingGeometry</a>( <a class="code" href="ps2gl_8h.html#a2">PGL_DONT_FORCE_IMMEDIATE_STOP</a> );
00312       <font class="keywordflow">else</font>
00313          firstTime = <font class="keyword">false</font>;
00314       mStopTimer(<font class="stringliteral">"wait for vu1"</font>);
00315 
00316       mStopTimer(<font class="stringliteral">"frame time"</font>);
00317 
00318       <font class="keywordflow">if</font> ( printTimes ) {
00319          mDisplayTimers();
00320          printTimes = <font class="keyword">false</font>;
00321 
00322          <font class="comment">// pglPrintGsMemAllocation();</font>
00323       }
00324 
00325       <a class="code" href="group__pgl__api.html#a7">pglWaitForVSync</a>();
00326       <a class="code" href="group__pgl__api.html#a8">pglSwapBuffers</a>();
00327       <a class="code" href="group__pgl__api.html#a16">pglRenderGeometry</a>();
00328    }
00329 }
00330 
00331 <font class="keywordtype">void</font>
00332 parse_cl( <font class="keywordtype">int</font> *argcp, <font class="keywordtype">char</font> **argv )<font class="keyword"></font>
00333 {
00334    <font class="keywordflow">for</font> ( <font class="keywordtype">int</font> i = 0; i &lt; *argcp; i++ ) {
00335       <font class="keywordtype">bool</font> found = <font class="keyword">false</font>;
00336 
00337       <font class="keywordflow">if</font> ( strstr(argv[i], <font class="stringliteral">"iop_module_path="</font>) == argv[i] )<font class="keyword"> </font>{
00338          module_path = &amp;argv[i][strlen(<font class="stringliteral">"iop_module_path="</font>)];
00339          found = <font class="keyword">true</font>;
00340       }
00341 
00342       <font class="keywordflow">if</font> ( found ) argv[i] = NULL;
00343    }
00344 
00345    <font class="comment">// fix up argv</font>
00346 
00347    <font class="keywordtype">int</font> numArgs = *argcp;
00348    <font class="keywordflow">for</font> ( <font class="keywordtype">int</font> i = 0; i &lt; numArgs; i++ )<font class="keyword"> </font>{
00349       <font class="keywordflow">if</font> ( argv[i] == NULL ) {
00350          <font class="comment">// move everything after left one</font>
00351          <font class="keywordflow">for</font> ( <font class="keywordtype">int</font> j = i; j &lt; numArgs - 1; j++ )
00352             argv[j] = argv[j+1];
00353          *argcp -= 1;
00354       }
00355    }
00356 }
00357 
00358 <font class="keywordtype">void</font>
00359 do_keys()<font class="keyword"></font>
00360 {
00361    <font class="keyword">static</font> <font class="keywordtype">int</font> frameCount = 0;
00362 
00363    <font class="keywordflow">if</font> ( SpecialFunc ) {
00364       <font class="keywordflow">if</font> ( Pad0.WasPushed(Pads::kLeftUp) ) {
00365          <a class="code" href="ps2glut_8cpp.html#a10">SpecialFunc</a>( GLUT_KEY_UP, 0, 0 );
00366          frameCount = 0;
00367       }
00368       <font class="keywordflow">if</font> ( Pad0.WasPushed(Pads::kLeftDown) ) {
00369          <a class="code" href="ps2glut_8cpp.html#a10">SpecialFunc</a>( GLUT_KEY_DOWN, 0, 0 );
00370          frameCount = 0;
00371       }
00372       <font class="keywordflow">if</font> ( Pad0.WasPushed(Pads::kLeftRight) ) {
00373          <a class="code" href="ps2glut_8cpp.html#a10">SpecialFunc</a>( GLUT_KEY_RIGHT, 0, 0 );
00374          frameCount = 0;
00375       }
00376       <font class="keywordflow">if</font> ( Pad0.WasPushed(Pads::kLeftLeft) ) {
00377          <a class="code" href="ps2glut_8cpp.html#a10">SpecialFunc</a>( GLUT_KEY_LEFT, 0, 0 );
00378          frameCount = 0;
00379       }
00380 
00381       <font class="keywordflow">if</font> ( Pad0.WasPushed(Pads::kL1 ) ) {
00382          <a class="code" href="ps2glut_8cpp.html#a10">SpecialFunc</a>( GLUT_KEY_HOME, 0, 0 );
00383          frameCount = 0;
00384       }
00385       <font class="keywordflow">if</font> ( Pad0.WasPushed(Pads::kL2 ) ) {
00386          <a class="code" href="ps2glut_8cpp.html#a10">SpecialFunc</a>( GLUT_KEY_END, 0, 0 );
00387          frameCount = 0;
00388       }
00389 
00390       <font class="keywordflow">if</font> ( Pad0.WasPushed(Pads::kR1) ) {
00391          <a class="code" href="ps2glut_8cpp.html#a10">SpecialFunc</a>( GLUT_KEY_PAGE_UP, 0, 0 );
00392          frameCount = 0;
00393       }
00394       <font class="keywordflow">if</font> ( Pad0.WasPushed(Pads::kR2) ) {
00395          <a class="code" href="ps2glut_8cpp.html#a10">SpecialFunc</a>( GLUT_KEY_PAGE_DOWN, 0, 0 );
00396          frameCount = 0;
00397       }
00398    }
00399 
00400    <font class="keywordflow">if</font> ( KeyboardFunc ) {
00401       <font class="keywordflow">if</font> ( Pad0.IsDown(Pads::kRightUp) ) {
00402          <a class="code" href="ps2glut_8cpp.html#a7">KeyboardFunc</a>( <font class="charliteral">'8'</font>, 0, 0 );
00403          frameCount = 0;
00404       }
00405       <font class="keywordflow">if</font> ( Pad0.IsDown(Pads::kRightDown) ) {
00406          <a class="code" href="ps2glut_8cpp.html#a7">KeyboardFunc</a>( <font class="charliteral">'2'</font>, 0, 0 );
00407          frameCount = 0;
00408       }
00409       <font class="keywordflow">if</font> ( Pad0.IsDown(Pads::kRightLeft) ) {
00410          <a class="code" href="ps2glut_8cpp.html#a7">KeyboardFunc</a>( <font class="charliteral">'4'</font>, 0, 0 );
00411          frameCount = 0;
00412       }
00413       <font class="keywordflow">if</font> ( Pad0.IsDown(Pads::kRightRight) ) {
00414          <a class="code" href="ps2glut_8cpp.html#a7">KeyboardFunc</a>( <font class="charliteral">'6'</font>, 0, 0 );
00415          frameCount = 0;
00416       }
00417    }
00418 
00419    <font class="keywordflow">if</font> ( frameCount &gt; 40 &amp;&amp; frameCount % 3 == 0 ) {
00420 
00421       <font class="keywordflow">if</font> ( SpecialFunc ) {
00422          <font class="keywordflow">if</font> ( Pad0.IsDown(Pads::kLeftUp) ) {
00423             <a class="code" href="ps2glut_8cpp.html#a10">SpecialFunc</a>( GLUT_KEY_UP, 0, 0 );
00424          }
00425          <font class="keywordflow">if</font> ( Pad0.IsDown(Pads::kLeftDown) ) {
00426             <a class="code" href="ps2glut_8cpp.html#a10">SpecialFunc</a>( GLUT_KEY_DOWN, 0, 0 );
00427          }
00428          <font class="keywordflow">if</font> ( Pad0.IsDown(Pads::kLeftRight) ) {
00429             <a class="code" href="ps2glut_8cpp.html#a10">SpecialFunc</a>( GLUT_KEY_RIGHT, 0, 0 );
00430          }
00431          <font class="keywordflow">if</font> ( Pad0.IsDown(Pads::kLeftLeft) ) {
00432             <a class="code" href="ps2glut_8cpp.html#a10">SpecialFunc</a>( GLUT_KEY_LEFT, 0, 0 );
00433          }
00434 
00435          <font class="keywordflow">if</font> ( Pad0.IsDown(Pads::kL1 ) ) {
00436             <a class="code" href="ps2glut_8cpp.html#a10">SpecialFunc</a>( GLUT_KEY_HOME, 0, 0 );
00437          }
00438          <font class="keywordflow">if</font> ( Pad0.IsDown(Pads::kL2 ) ) {
00439             <a class="code" href="ps2glut_8cpp.html#a10">SpecialFunc</a>( GLUT_KEY_END, 0, 0 );
00440          }
00441 
00442          <font class="keywordflow">if</font> ( Pad0.IsDown(Pads::kR1) ) {
00443             <a class="code" href="ps2glut_8cpp.html#a10">SpecialFunc</a>( GLUT_KEY_PAGE_UP, 0, 0 );
00444          }
00445          <font class="keywordflow">if</font> ( Pad0.IsDown(Pads::kR2) ) {
00446             <a class="code" href="ps2glut_8cpp.html#a10">SpecialFunc</a>( GLUT_KEY_PAGE_DOWN, 0, 0 );
00447          }
00448       }
00449 
00450       <font class="keywordflow">if</font> ( KeyboardFunc ) {
00451          <font class="keywordflow">if</font> ( Pad0.IsDown(Pads::kRightUp) ) {
00452             <a class="code" href="ps2glut_8cpp.html#a7">KeyboardFunc</a>( <font class="charliteral">'8'</font>, 0, 0 );
00453          }
00454          <font class="keywordflow">if</font> ( Pad0.IsDown(Pads::kRightDown) ) {
00455             <a class="code" href="ps2glut_8cpp.html#a7">KeyboardFunc</a>( <font class="charliteral">'2'</font>, 0, 0 );
00456          }
00457          <font class="keywordflow">if</font> ( Pad0.IsDown(Pads::kRightLeft) ) {
00458             <a class="code" href="ps2glut_8cpp.html#a7">KeyboardFunc</a>( <font class="charliteral">'4'</font>, 0, 0 );
00459          }
00460          <font class="keywordflow">if</font> ( Pad0.IsDown(Pads::kRightRight) ) {
00461             <a class="code" href="ps2glut_8cpp.html#a7">KeyboardFunc</a>( <font class="charliteral">'6'</font>, 0, 0 );
00462          }
00463       }
00464    }
00465 
00466    frameCount++;
00467 }
00468 
00469 <font class="keyword">static</font> <font class="keywordtype">void</font>
00470 initGsMemory()<font class="keyword"></font>
00471 {
00472    <font class="comment">// frame and depth buffer</font>
00473    <a class="code" href="ps2gl_8h.html#a11">pgl_slot_handle_t</a> frame_slot_0, frame_slot_1, depth_slot;
00474    frame_slot_0 = <a class="code" href="group__gs__mem__slots.html#a21">pglAddGsMemSlot</a>( 0, 70, GS::kPsm32 );
00475    frame_slot_1 = <a class="code" href="group__gs__mem__slots.html#a21">pglAddGsMemSlot</a>( 70, 70, GS::kPsm32 );
00476    depth_slot = <a class="code" href="group__gs__mem__slots.html#a21">pglAddGsMemSlot</a>( 140, 70, GS::kPsmz24 );
00477    <font class="comment">// lock these slots so that they aren't allocated by the memory manager</font>
00478    <a class="code" href="group__gs__mem__slots.html#a22">pglLockGsMemSlot</a>( frame_slot_0 );
00479    <a class="code" href="group__gs__mem__slots.html#a22">pglLockGsMemSlot</a>( frame_slot_1 );
00480    <a class="code" href="group__gs__mem__slots.html#a22">pglLockGsMemSlot</a>( depth_slot );
00481 
00482    <font class="comment">// create gs memory area objects to use for frame and depth buffers</font>
00483    <a class="code" href="ps2gl_8h.html#a12">pgl_area_handle_t</a> frame_area_0, frame_area_1, depth_area;
00484    frame_area_0 = <a class="code" href="group__gs__mem__areas.html#a25">pglCreateGsMemArea</a>( 640, 224, GS::kPsm24 );
00485    frame_area_1 = <a class="code" href="group__gs__mem__areas.html#a25">pglCreateGsMemArea</a>( 640, 224, GS::kPsm24 );
00486    depth_area = <a class="code" href="group__gs__mem__areas.html#a25">pglCreateGsMemArea</a>( 640, 224, GS::kPsmz24 );
00487    <font class="comment">// bind the areas to the slots we created above</font>
00488    <a class="code" href="group__gs__mem__areas.html#a30">pglBindGsMemAreaToSlot</a>( frame_area_0, frame_slot_0 );
00489    <a class="code" href="group__gs__mem__areas.html#a30">pglBindGsMemAreaToSlot</a>( frame_area_1, frame_slot_1 );
00490    <a class="code" href="group__gs__mem__areas.html#a30">pglBindGsMemAreaToSlot</a>( depth_area, depth_slot );
00491 
00492    <font class="comment">// draw to the new areas...</font>
00493    <a class="code" href="ps2gl_8h.html#a37">pglSetDrawBuffers</a>( <a class="code" href="ps2gl_8h.html#a4">PGL_INTERLACED</a>, frame_area_0, frame_area_1, depth_area );
00494    <font class="comment">// ...and display from them</font>
00495    <a class="code" href="ps2gl_8h.html#a36">pglSetDisplayBuffers</a>( <a class="code" href="ps2gl_8h.html#a4">PGL_INTERLACED</a>, frame_area_0, frame_area_1 );
00496 
00497    <font class="comment">// 32 bit</font>
00498 
00499    <font class="comment">// a slot for fonts (probably)</font>
00500    <a class="code" href="group__gs__mem__slots.html#a21">pglAddGsMemSlot</a>( 210, 2, GS::kPsm8 );
00501 
00502    <font class="comment">// 64x32</font>
00503    <a class="code" href="group__gs__mem__slots.html#a21">pglAddGsMemSlot</a>( 212, 1, GS::kPsm32 );
00504    <a class="code" href="group__gs__mem__slots.html#a21">pglAddGsMemSlot</a>( 213, 1, GS::kPsm32 );
00505    <font class="comment">// 64x64</font>
00506    <a class="code" href="group__gs__mem__slots.html#a21">pglAddGsMemSlot</a>( 214, 2, GS::kPsm32 );
00507    <a class="code" href="group__gs__mem__slots.html#a21">pglAddGsMemSlot</a>( 216, 2, GS::kPsm32 );
00508    <a class="code" href="group__gs__mem__slots.html#a21">pglAddGsMemSlot</a>( 218, 2, GS::kPsm32 );
00509    <a class="code" href="group__gs__mem__slots.html#a21">pglAddGsMemSlot</a>( 220, 2, GS::kPsm32 );
00510    <font class="comment">// 128x128</font>
00511    <a class="code" href="group__gs__mem__slots.html#a21">pglAddGsMemSlot</a>( 222, 8, GS::kPsm32 );
00512    <a class="code" href="group__gs__mem__slots.html#a21">pglAddGsMemSlot</a>( 230, 8, GS::kPsm32 );
00513    <font class="comment">// 256x256</font>
00514    <a class="code" href="group__gs__mem__slots.html#a21">pglAddGsMemSlot</a>( 238, 32, GS::kPsm32 );
00515    <a class="code" href="group__gs__mem__slots.html#a21">pglAddGsMemSlot</a>( 270, 32, GS::kPsm32 );
00516    <font class="comment">// 512x256</font>
00517    <a class="code" href="group__gs__mem__slots.html#a21">pglAddGsMemSlot</a>( 302, 64, GS::kPsm32 );
00518    <a class="code" href="group__gs__mem__slots.html#a21">pglAddGsMemSlot</a>( 366, 64, GS::kPsm32 );
00519 
00520    <a class="code" href="group__gs__mem.html#a0">pglPrintGsMemAllocation</a>();
00521 }
00522 
</pre></div><hr><address><small>ps2gl version cvs</small></address>
